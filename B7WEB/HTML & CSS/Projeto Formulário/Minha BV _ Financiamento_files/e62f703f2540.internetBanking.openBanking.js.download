!function(){"use strict";function a(a,b,c,d){function e(){g.openBankingDatalayer=b.$on("open-banking-datalayer",function(a,b){console.log("open-banking-datalayer",b),f(b,{})}),c.$on("$destroy",g.openBankingDatalayer)}function f(b,c){function e(){return{home:"BV|AL|open-banking|confirmacao-compartilhamento",transmission:a("translate")("@SITE-DATALAYER-OPEN-BANKING-TRANSMISSION")+"|detalhes",resume:a("translate")("@SITE-DATALAYER-OPEN-BANKING-RESUME"),cancelled:a("translate")("@SITE-DATALAYER-OPEN-BANKING-CANCELLED"),redirect:a("translate")("@SITE-DATALAYER-OPEN-BANKING-REDIRECT"),notallowedcpf:a("translate")("@SITE-DATALAYER-OPEN-BANKING-NOTALLOWEDCPF"),noproducts:a("translate")("@SITE-DATALAYER-OPEN-BANKING-NOPRODUCTS")}}var f=e()[b];d.customPageView({pageName:f||a("translate")("@SITE-DATALAYER-OPEN-BANKING-TRANSMISSION")+"|"+b})}var g=this;e()}a.$inject=["$filter","$rootScope","$scope","dataLayerFactory"],angular.module("internetBanking.openBanking").controller("HomeOpenBankingController",a)}(),function(){"use strict";function a(){function a(a){var b=""+a;return b.length>11?b.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g,"$1.$2.$3/$4-$5"):11===b.length?b.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g,"$1.$2.$3-$4"):b}function b(a){var b;switch(a){case"CUSTOMERS_DATA":b={icon:"icon-user-dark-bd",name:"Dados cadastrais"};break;case"FINANCINGS_READ":case"FINANCINGS":b={icon:"bvopen-personal-credit",name:"Financiamentos"};break;case"LOANS_READ":case"LOANS":b={icon:"bvopen-personal-credit",name:"Dados de empréstimo"};break;case"CREDITS_READ":case"CREDITS":b={icon:"bvopen-personal-credit",name:"Dados de operações de crédito"};break;case"CREDIT_CARD_ACCOUNTS":b={icon:"bvopen-card",name:"Cartão de crédito"};break;default:b={icon:"bvopen-account",name:a||"Dados"}}return b}function c(a){function b(b){return a.dataExpiracao&&a.dataExpiracao.length>9?moment(a.dataExpiracao,"YYYY-MM-DD").diff(moment(a.dataCriacao,"YYYY-MM-DD"),b):-1}var c=a.dataExpiracao?"Até o dia "+moment(a.dataExpiracao,"YYYY-MM-DD").format("DD/MM/YYYY"):"";return b("month")+" meses | "+c}return{getDocument:a,getUntilDateSharing:c,getPermissionName:b}}angular.module("internetBanking.openBanking").factory("openbankingFactory",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(){E.solicitationForm={},E.isLoaded=!0,a.errorConsentData?C(!0):m(),x(),a.$emit("initOpenBankingMenu")}function m(){function f(a,c){b.transitionTo(b.current.name,{idInteracao:a,options:c},{notify:!1})}function g(){try{D=E.consendData.usuarioLogado.documento.numero.match(/\d+/g).join(""),E.documentType=E.consendData.usuarioLogado.documento.tipo}catch(a){}}C(!1);var k=d.get("bvSiteCache").get("openbanking"),l=k&&k.consentData,m=k&&k.idInteracao||c.idInteracao,p=i.getInteractionId();if(l)E.consendData=l,g(),o(),k&&d.get("bvSiteCache").remove("openbanking");else{if(m||p)return E.isLoaded=!1,f(m||p,void 0),e.getConsentData(m||p).then(function(c){E.consendData=c.data,g(),j.getUserCPF().then(function(c){var d=(""+c.name).match(/\d+/g).join("");if(angular.equals(d,D))return o();E.statusConsentment="notallowedcpf",b.go(h.NOTALLOWEDCPF),a.$emit("open-banking-datalayer","notallowedcpf")})}).catch(function(){C(!0),f(m||p,"algo-deu-errado"),a.$emit("open-banking-datalayer","erro-dados-consentimento")}).finally(function(){E.isLoaded=!0});n()}}function n(){E.statusConsentment="noproducts",b.go(h.NOPRODUCTS),a.$emit("open-banking-datalayer","noproducts")}function o(){return e.getModalities(E.consendData).then(function(b){if(E.modalities=b.data,E.statusConsentment="initial",E.indexActiveItem=0,!E.modalities||0===E.modalities.length||_.find(E.modalities,{objeto:"CREDIT_CARD_ACCOUNTS"})&&(!_.find(E.modalities,"contasCartao")||0===_.find(E.modalities,"contasCartao").contasCartao.length))return void n();E.modalities.map(function(a){a.agrupamentos&&a.agrupamentos.length||delete a.objeto;for(var b=0;b<a.modalidades&&a.modalidades.length;b++)a.modalidades[b].selected=!1;for(var c=0;c<a.contasCartao&&a.contasCartao.length;c++)a.contasCartao[c].selected=!1;angular.merge(a,g.getPermissionName(a.objeto))}),E.hasModalities=!!_.find(E.modalities,"modalidades"),E.hasContasCartao=!!_.find(E.modalities,"contasCartao"),E.modalitiesSelected=E.hasModalities?y():-1,E.contaCartaoSelected=E.hasContasCartao?z():-1,E.totalSelectedCount=E.hasModalities||E.hasContasCartao?0:-1,a.$emit("open-banking-datalayer","transmission")}).catch(function(){C(!0),a.$emit("open-banking-datalayer","lightbox-erro-modalidade")}).finally(function(){E.isLoaded=!0})}function p(a){a&&(a.isOpened=!a.isOpened)}function q(a,b){b.selected=a&&a.target&&a.target.checked,E.totalSelectedCount=y().length+z().length||0,E.modalitiesSelected=E.hasModalities?y():-1,E.contaCartaoSelected=E.hasContasCartao?z():-1}function r(){if(E.modalitiesSelected=E.hasModalities?y():-1,E.contaCartaoSelected=E.hasContasCartao?z():-1,0===E.totalSelectedCount||E.hasModalities&&0===E.modalitiesSelected.length||E.hasContasCartao&&0===E.contaCartaoSelected.length)return u("emptyList"),void a.$emit("open-banking-datalayer","lightbox-nenhuma-modalidade-selecionada");E.username=k.user.user||k.user.nameUser,E.username||j.getUsername().then(function(a){E.username=a.nomeCliente,s(E.username,D)}),s(E.username,D),E.statusConsentment="resume",b.go(h.RESUME,{consentData:E})}function s(a,b){E.dataConsent=[{label:"Identificação",value:a},{label:E.documentType?E.documentType:b.length>11?"CNPJ":"CPF",value:g.getDocument(b||"-")},{label:"Instituição de destino",value:E.consendData.nomeMarcaReceptora||E.consendData.nomeMarca||"-"},{label:"Prazo do compartilhamento",value:g.getUntilDateSharing(E.consendData)}]}function t(){u("desistConsentment"),a.$emit("open-banking-datalayer","lightbox-desistencia-compartilhamento")}function u(a){x(),E.modalConfig[a]={open:!0}}function v(){E.errorTransmissionRejection=!1,E.loadingDesistConsentment=!0,a.$emit(f.SPINNING_START),e.postTransmissionRejection(E.consendData.idConsentimento).then(function(){E.statusConsentment="cancelled",b.go(h.CANCELLED,{consentData:E,complement:E.consendData.nomeMarca}),w(),a.$emit("open-banking-datalayer","cancelled")}).catch(function(){E.errorTransmissionRejection=!0,u("error"),a.$emit("open-banking-datalayer","lightbox-erro-sistemico")}).finally(function(){E.loadingDesistConsentment=!1,a.$emit(f.SPINNING_STOP)})}function w(){x()}function x(){E.modalConfig={desistConsentment:{open:!1},error:{open:!1},errorRedirect:{open:!1},emptyList:{open:!1},exit:{open:!1},sessionExpired:{open:!1}}}function y(){return E.modalitiesSelected=[],E.modalities.map(function(a){if(a.modalidades)return a.modalidades.map(function(a){if(a.selected)return a.codigoModalidade})}).join(",").split(",").map(function(a){a&&a.length&&E.modalitiesSelected.push(parseInt(a))}),E.modalitiesSelected}function z(){var a=[];return E.modalities.map(function(b){_.filter(b.contasCartao,function(a){return!0===a.selected}).map(function(b){return a.push(b),b})}),a}function A(){b.go("app.navigation.user.openBankingManagement")}function B(){b.go("app.navigation.user.openBankingManagement")}function C(b){a.errorConsentData=E.errorConsentData=b}var D,E=this;E.btnNoProducts=B,E.checkIt=q,E.closeModal=w,E.confirmConsentment=r,E.desistConsentment=t,E.exit=A,E.genericModal=u,E.getConsentData=m,E.modalBtnDesistConsentment=v,E.toggleGroup=p,l()}a.$inject=["$rootScope","$state","$stateParams","CacheFactory","bvOpenService","commonEvents","openbankingFactory","openBankingRoutes","openBankingInteractionService","userService","userInfoService"],angular.module("internetBanking.openBanking").controller("TransmissionController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){n.solicitationForm={},n.$parent=b.$parent.vm,n.dataConsent=n.$parent.dataConsent,n.loadingSecondConfirmConsentment=!1,a.$emit("open-banking-datalayer","resume")}function j(){n.$parent.genericModal("desistConsentment")}function k(){function b(a){j(a,"error","lightbox-erro-sistemico")}function i(a){j(a,"errorRedirect","lightbox-erro-redirecionamento")}function j(b,c,d){n.hasClickedAccept=!1,n.errorTransmissionConfirmation=!0,b&&b.data&&400===b.data.code?n.$parent.genericModal("sessionExpired"):n.$parent.genericModal(c),a.$emit("open-banking-datalayer",d)}if(!n.loadingSecondConfirmConsentment){n.errorTransmissionConfirmation=!1,n.loadingSecondConfirmConsentment=!0,a.$emit(f.SPINNING_START);var k={contasCartao:n.$parent.contaCartaoSelected.map(function(a){return{contaCartao:a.contaCartao,correlativo:a.correlativo,emissor:a.emissor,filial:a.filial,produto:a.produto}})||[],modalidades:n.$parent.modalitiesSelected||[]};a.isOpenBankingRedirected=!1;var l=n.$parent.consendData.idConsentimento,m=g.getInteractionId();n.hasClickedAccept=!0,d.postTransmissionConfirmation(l,k,m).then(function(){d.getRedirection(l,m).then(function(a){n.$parent.redirectData=a.data,n.$parent.statusConsentment="redirect",c.go(h.REDIRECT,{destination:a.data.nomeMarcaReceptora}).then(function(){e.get("bvSiteCache").get("openbanking")&&e.get("bvSiteCache").remove("openbanking")})}).catch(i).finally(function(){a.$emit(f.SPINNING_STOP)})}).catch(b).finally(function(){n.loadingSecondConfirmConsentment=!1,a.$emit(f.SPINNING_STOP)})}}function l(){n.errorTransmissionRejection=!1,n.loadingDesistConsentment=!0,a.$emit(f.SPINNING_START),d.postTransmissionRejection(n.$parent.consendData.idConsentimento).then(function(){n.statusConsentment="cancelled",m(),a.$emit("open-banking-datalayer","cancelled")}).catch(function(){n.errorTransmissionRejection=!0,n.$parent.genericModal("error"),a.$emit("open-banking-datalayer","lightbox-erro-sistemico")}).finally(function(){n.loadingDesistConsentment=!1,a.$emit(f.SPINNING_STOP)})}function m(){n.modalConfig={open:!1,exit:{open:!1},desistConsentment:{open:!1},error:{open:!1},emptyList:{open:!1}}}var n=this;n.closeModal=m,n.desistConsentment=j,n.secondConfirmConsentment=k,n.modalBtnDesistConsentment=l,i()}a.$inject=["$rootScope","$scope","$state","bvOpenService","CacheFactory","commonEvents","openBankingInteractionService","openBankingRoutes"],angular.module("internetBanking.openBanking").controller("TransmissionResumeController",a)}(),function(){"use strict";function a(a,b){function c(){}function d(){h(),a.go("app.navigation.user.openBankingManagement")}function e(){h(),a.go("app.navigation.user.openBankingManagement")}function f(){h(),a.go("app.navigation.user.openBankingManagement")}function g(){i.modalConfig.desistConsentment={open:!1},i.modalConfig.open=!1}function h(){try{b.get("bvSiteCache").get("openbanking")&&b.get("bvSiteCache").remove("openbanking")}catch(a){}}var i=this;i.afterCancelHome=d,i.btnNotAllowedCpf=e,i.btnNoProducts=f,i.closeModal=g,c()}a.$inject=["$state","CacheFactory"],angular.module("internetBanking.openBanking").controller("TransmissionCancelledController",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(){i.$parent=a.$parent.vm,i.consendData=a.$parent.vm.consendData,i.modalConfig={open:!1,redirectionUrl:{open:!1}},i.redirectData=i.$parent.redirectData,i.redirectData?(c.$emit("open-banking-datalayer","lightbox-redirecionamento"),g(),setTimeout(h,15e3)):c.$emit("open-banking-datalayer","lightbox-erro-redirecionamento")}function g(){i.modalConfig.redirectionUrl.open=!0,i.modalConfig.open=!0}function h(){c.isOpenBankingRedirected||(window.location.href=i.redirectData.redirect),c.isOpenBankingRedirected=!0}var i=this;i.retryRedirect=h,f()}a.$inject=["$scope","$state","$rootScope","$timeout","$window"],angular.module("internetBanking.openBanking").controller("TransmissionRedirectController",a)}();