!function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L){function M(){angular.element("body").removeClass("logged"),D.reset(),da({url:f.current.url,errorCode:"",nameErrorCode:""}),d.billetbilling=null,d.countTokenAttempts=0,d.disableRetryGenerateBillet=!0,d.siteCache={CREDIT_CARD_CACHE:!0,ADDITIONAL_CREDIT_CARD_CACHE:!0,POINTS_CREDIT_CARD_CACHE:!1,SHORT_FORM_CACHE:!0}}function N(){if(ma.formData.isValidDocument&&ma.formData.hasPassword)return void S();var a=ma.formData.document.replace(/\D/gi,"");ba("login-spinner"),z.getPublicKey().then(function(b){na.setPublicKey(b.data.key),sessionStorage.setItem("userLastDigit",a.substr(a.length-1,a.length)),D.set("cpfCnpj",ma.formData.document),$()}).catch(function(a){var b={errorCode:a.status,nameErrorCode:"Erro ao obter a chave pública da API"};ca("login-spinner"),da(b)})}function O(){Z()?N():ga("invalidDocument")}function P(a){ma.formData.document=a.target.value,ma.formData.isValidDocument=Z(),Q()}function Q(){return void 0===ma.formData.hasPassword?ma.btnLoginDisabled=!ma.formData.isValidDocument:ma.formData.isValidDocument&&ma.formData.hasPassword?ma.btnLoginDisabled=!1:ma.btnLoginDisabled=!0,!ma.btnLoginDisabled}function R(a){var b=J.open(e,[6,8],"groups",a);ma.formData.password.keys=[],ma.formData.password.sequence=[],ma.formData.password.sequence_length="",da({siteSubSection:"teclado virtual"}),b.then(function(a){ma.formData.hasPassword=!0,ma.formData.password.keys=a.keys,ma.formData.password.sequence=a.sequence,ma.formData.password.sequence_length=a.sequence.join("").replace(","),Q()&&S()},function(){ma.formData.hasPassword=!1,ma.formData.password={keys:[],sequence:[],sequence_length:null,legacy_pass:null},Q()})}function S(){y.execute("login").then(function(a){T(a)}).catch(function(){ca("login-spinner")})}function T(a){ba("login-spinner"),angular.element(document.querySelector("#bv-password")).addClass("-not-click"),z.getPublicKey().then(function(b){function c(a){da({siteSubSection:"login com sucesso"});var b=a.headers("TokenCS"),c=a.headers("ibbv-login");b&&(E.setHeaders({CpfCnpj:e}),E.setHeaders({TokenCS:b}));try{U(c,a.config.url)}catch(d){console.log("Exception login minha bv. ",d)}V(a);try{W()}catch(d){angular.element(document.querySelector("#bv-password")).removeClass("-not-click"),console.log("Obter produtos exception. ",d)}}function d(a){return ca("login-spinner"),angular.element(document.querySelector("#bv-password")).removeClass("-not-click"),angular.equals(a.status,419)?(da({errorCode:a.status,nameErrorCode:"erro ao validar recaptcha"}),ga("recaptchaError")):a.status>=500?(da({errorCode:a.status,nameErrorCode:"sistema indisponivel"}),ga("serverError")):(da({errorCode:a.status,nameErrorCode:"dados incorretos"}),ga("businessError")),!1}na.setPublicKey(b.data.key);var e=ma.formData.document.replace(/\D/gi,""),f={userName:e,sequencia:ma.formData.password.sequence,gruposTeclas:ma.formData.password.keys},g={payload:na.encrypt(JSON.stringify(f))};K.post(g,a).then(c).catch(d)}).catch(function(a){ca("login-spinner"),angular.element(document.querySelector("#bv-password")).removeClass("-not-click"),console.log("Ocorreu um erro ao obter a chave publica. ",a)})}function U(a,b){a=null===a&&b.indexOf("localhost")>-1?(new Date).toString():new Date(moment(a,"DD/MM/YYYY hh:mm:ss")).toString(),A.setTimeSession(a)}function V(a){var b=ma.formData.document.replace(/\D/gi,"");j.convert(a.data),G.user=F.APIToViewModel({cpfCnpj:sha256(b),usuario:"",telefone:"",email:"",upgrade:i.userInRoles([o.UPGRADE_PROFILE_ROLE])})}function W(){function a(a){var b=a;if(X(b),_.isEmpty(a)||_.isEmpty(b.listaFinanciamento)&&_.isEmpty(b.listaCartao))return s.logout({"user-logout":!0}),ga("productNeonError"),!0;try{d.sessionPage=c.search()&&c.search().sessionPage;var e=c.search()&&c.search().idInteracao||u.getInteractionId();if(e){k.get("bvSiteCache").put("openbanking",{idInteracao:e}),u.setInteractionId(e)}}catch(g){}b.produtosContratados=b.listaFinanciamento.concat(b.listaCartao);var f=H.APIToViewModel(b);if(G.setProductsListCache(f.contractedProducts),G.setUserCache(G.user),G.user.possuiCartao=a.possuiCartao,G.user.moduloCartao=a.moduloCartao,Y(f),a.possuiCartao&&0===a.produtosContratados.length&&!a.moduloCartao)return console.error("Módulo de cartões desativado - Cliente possúi somente cartões para esse CPF/CNPJ"),s.logout({"user-logout":!0}),ga("cartBusinessError"),!1;ja(a)}angular.element("body").addClass("logged"),q.reset(),G.user.user="Cliente BV",G.user.nameUser="Cliente BV",I.getUsername().then(function(a){var b=ma.formData.document.replace(/\D/gi,""),c={cpfCnpj:b,firstName:"",hash:"",lastFourCharsCpf:b.substr(-4),idBV:""};_.isEmpty(a)||(G.user.user=F.limitName(a.nomeCliente,30),G.user.nameUser=a.nomeCliente,c.firstName=a.nomeCliente.split(" ")[0].toUpperCase()),c.hash="!"+c.firstName+"@"+c.cpfCnpj+"#"+c.firstName+"$",delete G.user.cpfCnpj,la(),c.idBV=sha256(c.hash)+c.lastFourCharsCpf,da(!1,{idBV:c.idBV,profile:{visitorId:c.idBV}})}).catch(function(a){console.log("Ocorreu um erro ao tentar obter o nome do cliente. ",a)}).finally(function(){x.get().then(a).catch(function(a){return s.logout({"user-logout":!0}),da({errorCode:a.status,nameErrorCode:"erro carregar produtos"}),ga("productError"),ca("login-spinner"),!1})})}function X(a){a.listaFinanciamento=a.listaFinanciamento.filter(function(a){if(!(a.codigoSubProdutos.indexOf(85)>-1||a.codigoSubProdutos.indexOf(86)>-1))return!0})}function Y(a){if(document){var b=angular.copy(a.contractedProducts);b.map(function(a){delete a.imageCode,delete a.guaranteesList,a.status=a.status&&a.status.description,a.initDate=moment(a.initDate).format("DD/MM/YYYY"),a.endDate=moment(a.endDate).format("DD/MM/YYYY")}),document.BVDatalayer.contractedProducts=b}}function Z(){var a=!1;return!(!ma.formData.document||ma.formData.document<13)&&(m.isValid(ma.formData.document)?(ma.formData.isCNPJ=!0,a=!0,D.set("isCNPJ",!0)):n.isValid(ma.formData.document)&&(ma.formData.isCNPJ=!1,a=!0,D.set("isCNPJ",!1)),a)}function $(){var a={payload:na.encrypt(JSON.stringify({cpfCnpj:ma.formData.document.replace(/\D/gi,"")}))};l.check(a).then(function(a){var c=a.data.status==ma.statusOnboarding.hasLogin?"RESET":"REGISTER";ma.formData.statusOnboarding=a.data.status,D.set("type",c),D.set("typeUser",a.data.status),"REGISTER"===c?aa(!1):(angular.element(document.querySelector(".box-login-container__content")).removeClass("--short"),da({pageName:b.PASSWORD.PAGENAME}),ma.btnLoginDisabled=!0,R(void 0),ca("login-spinner"))}).catch(function(a){if(ca("login-spinner"),a.status>=500){return da({errorCode:a.status,nameErrorCode:"Sistema indisponível ao consultar API de onboarding do cliente."}),ga("serverError"),!1}ga("businessError")})}function aa(a){z.getPublicKey().then(function(b){na.setPublicKey(b.data.key);var c={cpfCnpj:ma.formData.document.replace(/\D/gi,""),statusOnboard:ma.formData.statusOnboarding},d={payload:na.encrypt(JSON.stringify(c))};w.product(d).then(function(b){D.set("productClient",b.data.status),B.setFlow(B.flow.subscribe),a?f.go(C.WELCOME_RESET_PASSWORD):f.go(C.WELCOME_SUBSCRIBE)}).catch(function(a){if(ca("login-spinner"),a.status>=500){return da({errorCode:a.status,nameErrorCode:"Sistema indisponível ao consultar API de obter produto."}),ga("businessError"),!1}ga("serverError")})}).catch(function(a){console.log("Ocorreu um erro ao tentar obter a chave publica. ",a)})}function ba(a){d.$emit(p.SPINNING_START,{target:a})}function ca(a){d.$emit(p.SPINNING_STOP,{target:a})}function da(b,c){b&&(a.pageInfo=Object.assign(a.pageInfo,b)),c&&(a.userInfo=Object.assign(a.userInfo,c)),document.BVDatalayer=a,r.triggerDatalayer(!0)}function ea(a){ma.modalStatus.open=!1,ma.modalStatus[a]=!1}function fa(){angular.element(document.querySelector(".animation-close-modal")).addClass("start"),setTimeout(function(){G.goToHomePage()},400)}function ga(a){Object.keys(ma.modalStatus).forEach(function(a){"open"!=a&&(ma.modalStatus[a]=!1)}),ma.modalStatus.open=!0,ma.modalStatus[a]=!0}function ha(){window.location.replace("//appbv.bv.com.br/abrirappbv/?link=https://www.bv.com.br/conta&apn=com.votorantim.bvpd&isi=1494202346&ibi=com.votorantim.bvpd&efr=1&utm_source=site-minha-bv&utm_medium=interna-bv&utm_campaign=canal_incentivo_banco-bv-app_incentivo-app-login-minhabv&utm_content=botao-cta_all-clientes-login-minhabv_cta-quero-baixar-app-agora-login-minhabv-redirect-app-bancobv")}function ia(){B.setFlow(B.flow.forgotPassword),D.set("breadcumb",[{label:"Início",uiroute:"FORGOT_PASSWORD_PAGE"},{label:"Código de identificação",uiroute:"TOKEN_SEND"}]),ba("forgot-password-spinner"),aa(!0)}function ja(a){ma.possuiCartao=!_.isEmpty(a.listaCartao)&&_.isEmpty(a.listaFinanciamento),ma.newAppDownloadModal={},ma.goToStore=ka;var b=localStorage.getItem("downloadApp")-0;if(b){if(b>3)return void G.goToHomePage();ga("modalAberturaConta"),localStorage.setItem("downloadApp",b+1)}else ga("modalAberturaConta"),localStorage.setItem("downloadApp",1)}function ka(){if("ios"===L.os||"mac"===L.os){try{da({pageName:b.CAMPANHA.INCENTIVO_APP_IOS})}catch(a){console.error("Erro ao enviar o tagueamento da campanha: ",a)}h.open("https://appbv.bv.com.br/abrirappbv/abrirApp?utm_source=salesforce&utm_medium=qr-code&utm_campaign=canal_aquisicao_banco-bv-conta-digital_banner-minha-bv-app-092021&utm_content=qrcode_visitantes-minha-bv_appstore-visitantes-minha-bv-redirect-app-bancobv&utm_term=nenhum","_blank")}else{try{da({pageName:b.CAMPANHA.INCENTIVO_APP_OUTROS})}catch(a){console.error("Erro ao enviar o tagueamento da campanha: ",a)}h.open("https://appbv.bv.com.br/abrirappbv/abrirApp?utm_source=salesforce&utm_medium=qr-code&utm_campaign=canal_aquisicao_banco-bv-conta-digital_banner-minha-bv-app-092021&utm_content=qrcode_visitantes-minha-bv_playstore-visitantes-minha-bv-redirect-app-bancobv&utm_term=nenhum","_blank")}}function la(){t.getMdmIdHash().then(function(a){document.Interaction={idmdm:a.data.hash}}).catch(console.log)}var ma=this,na=new JSEncrypt;ma.antecipatePreAnalysis=!1,ma.btnLoginDisabled=!0,ma.formData={document:"",password:{keys:[],sequence:[],sequence_length:null},isCNPJ:void 0,isValidDocument:!1,hasPassword:void 0},ma.modalStatus={open:!1,businessError:!1,cartBusinessError:!1,invalidDocument:!1,noProductError:!1,productError:!1,productNeonError:!1,recaptchaError:!1,serverError:!1,modalAberturaConta:!1},ma.statusOnboarding={hasLogin:1,newClient:2,notClient:3},ma.checkDocument=N,ma.closeModal=ea,ma.enterNext=O,ma.gotoForgotPasswordPage=ia,ma.gotoWebsite=ha,ma.keyupCpfCnpj=P,ma.openVirtualKeyboard=R,ma.closeModalCampanhaConta=fa,M()}a.$inject=["BV_DATALAYER_LOGIN","BV_DATALAYER_LOGIN_LIST","$location","$rootScope","$scope","$state","$stateParams","$window","bvRolesService","bvUserModelFactory","CacheFactory","clientOnbordService","cnpjValidationFactory","cpfValidationFactory","commonConstants","commonEvents","creditCardStateManagement","dataLayerFactory","logoutServiceVII","mdmIdService","openBankingInteractionService","preAnalysisFactory","productClientService","productsListService","recaptchaService","rsaPublicKeyService","stopWatchService","subscribeFactory","subscribeRoutes","subscribeService","tokenCSFactory","userInfoFactory","userInfoService","userProductsFactory","userService","VirtualKeyboard","virtualKeyboardService","deviceDetector"],angular.module("internetBanking.login").controller("HomeLoginController",a)}(),function(){"use strict";var a={pageInfo:{url:"",pageName:"",siteSection:"minha bv",siteSubSection:"",environment:"area aberta",segment:"varejo",errorCode:"",nameErrorCode:""},userInfo:{idBV:"",bvid_mdm:"",profile:{visitorId:""}}},b={LOGIN:{PAGENAME:"BV|AA|minha-bv|login",MODAL:{DATA_INVALID:"acesso normal"}},PASSWORD:{PAGENAME:"BV|AA|minha-bv|senha"},CAMPANHA:{INCENTIVO_APP_IOS:"BV|AL|minha-bv|campanha|banner-conta-digital|ios-mac",INCENTIVO_APP_OUTROS:"BV|AL|minha-bv|campanha|banner-conta-digital|outros"}},c=angular.copy(a);c.pageInfo.pageName=b.LOGIN.PAGENAME,angular.module("internetBanking.subscribe").constant("BV_DATALAYER_LOGIN",c),angular.module("internetBanking.subscribe").constant("BV_DATALAYER_LOGIN_LIST",b)}();