!function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(){m(),k()}function k(){n(),l(),c.$on("$stateChangeStart",q),a.$on("loading",function(a,b){a.defaultPrevented||(x.currentStep.loading=b)})}function l(){f.get().then(function(a){h.setBankList(a.data)})}function m(){c.sendTokenOnInit=!0,c.isAuthenticationTokenValid=!1,x.loadingPage=!1,x.watchEvent=!0,x.onCloseHeader=t,x.closeAttempts=0,x.user={},x.step=1,x.modal={open:!1,pendency:{open:!1},error:{open:!1}},x.currentStep={step:1,loading:!0},x.breadcrumbSteps=[{description:"Reembolso",step:"1",selected:!0,icon:"loan/icon-check"},{description:"Solicitação de reembolso",step:"2",selected:!1},{description:"Confirmação de reembolso",step:"3",selected:!1}],x.refundSteps=[{description:"Reembolso",step:1},{description:"Solicitação de reembolso",step:2},{description:"Confirmação de reembolso",step:3},{description:"Reembolso solicitado",step:4}],x.stepForward=o,x.stepBack=p,x.openModal=u,x.resetModal=v,x.resetForm=!1,x.addSpinner=r,x.removeSpinner=s}function n(){x.loadingPage=!0,e.getUserCPF().then(function(a){x.user.numeroCpfCnpj=a.name;var b=g.getUserCached();Object.assign(x.user,{phone:b.phone||"",email:b.email||""}),h.setDataUserInfo(x.user)}).finally(function(){x.loadingPage=!1})}function o(a){x.step=a+1,x.currentStep.step=a,x.breadcrumbSteps[a]=3===a?{selected:!0,icon:""}:{selected:!0,icon:"loan/icon-check"}}function p(a){x.step=0!==a?a-1:a,x.currentStep.step=a,x.breadcrumbSteps.map(function(b,c){c>a&&(b.selected=!1,b.icon="")})}function q(a,b){var c=b.params&&b.params.step?b.params.step:x.currentStep.step;c&&(x.step=parseInt(c),x.currentStep.step=parseInt(c),x.currentStep.loading=!0)}function r(a){c.$emit(i.SPINNING_START,{target:a})}function s(a,b){c.$emit(i.SPINNING_STOP,{target:a,disabledBtn:b})}function t(){x.closeAttempts=x.closeAttempts+1,w()}function u(a,b){x.modal.open=!0,x.modal[a].open=!0,b&&(x.modal[a].body=b)}function v(a){x.modal.open=!1,x.modal[a].open=!1}function w(){x.loadingPage=!0,g.goToHome().then(function(a){b.go(a.routeHome,a)}).catch(function(){}).finally(function(){x.loadingPage=!1})}var x=this;j()}a.$inject=["$scope","$state","$rootScope","$stateParams","userService","bankService","userInfoService","refundDataLayerFactory","commonEvents"],angular.module("internetBanking.refund").controller("RefundController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){r(),t()}function q(a,b){w.isToggled[b]||v(a,b),w.isToggled[b]=!w.isToggled[b]}function r(){w.ctrl=b.$parent.vm,w.ctrl.step=1,w.refunds=[],w.isToggled=[!1],w.totalAmount=0,w.toggleDetails=q,w.goToRefundRequestPage=s,w.statusReembolso="Valor disponível para reembolso",w.subtitle=x(w.refunds.length>0?"@SITE-REEMBOLSO-LISTA-DESCRICAO":"@SITE-REEMBOLSO-LISTA-DESCRICAO_SING"),w.disclaimer={message:x("@SITE-CREDIT-REEMBOLSO-LISTA-AVISO")}}function s(){w.ctrl.addSpinner("refund-spinner");var b={successRoute:f.REFUND_REQUEST_FORM,prefixEndpoint:m.PREFIX_URL,kindTokenTransaction:n.REFUND_AUTHENTICATION_TOKEN_KEY};o.set(b),o.sendDataToken(),w.ctrl.stepForward(1),w.ctrl.removeSpinner("refund-spinner",!0),a.go(f.REFUND_REQUEST_AUTH_TOKEN)}function t(){u()}function u(){g.getUserCPF().then(function(a){l.setDataUserInfo({numeroCpfCnpj:a.name});var b={numeroCpfCnpj:a.name,codigoSistemaSolicitante:n.CHANNEL,codigoStatusReembolso:1};i.get(b).then(function(a){w.refunds=a.data.listaContratosComReembolso.contratoComReembolso,w.totalAmount=a.data.valorReembolsoSumarizado;var b=[];w.refunds.map(function(a){b.push(a.numeroContrato),a.valorReembolso=parseFloat(a.valorReembolso)}),l.setDataRefundList({list:w.refunds,totalAmount:w.totalAmount}),l.callSendEvent({valorReembolso:w.totalAmount.toString(),numeroContrato:b})}).catch(function(a){w.ctrl.openModal("error")}).finally(function(){w.ctrl.currentStep.loading=!1})})}function v(a,b){if(!a.hasOwnProperty("installments")){w.ctrl.currentStep.loading=!0;var c=a.codigoProcesso;j.get(c).then(function(b){b.data&&(a.installments=b.data.parcelas.parcela,a.installments.map(function(a){return a.dataRecebimentoParcela=moment(a.dataRecebimentoParcela).format("L")}))}).catch(function(a){w.ctrl.openModal("error")}).finally(function(){w.ctrl.currentStep.loading=!1})}}var w=this,x=c("translate");p()}a.$inject=["$state","$scope","$filter","$rootScope","$stateParams","refundRoutes","userService","userInfoService","refundListService","refundListDetailsService","contractData","refundDataLayerFactory","refundEndPoints","refundConstant","authenticationTokenRefundFactory"],angular.module("internetBanking.refund").controller("RefundListController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(){m(),n()}function m(){y.user=g.getDataUserInfo(),y.refunds=g.getDataRefundList(),g.clearPayment(),y.openModal=o,y.resetModal=p,y.closeModal=q,y.proceedToConfirmPage=x,y.hasFirstDeny=!1,y.hasSecondDeny=!1,y.btDisabled=!1,y.banks=[],y.payment={conta:{tipoConta:"",codigoBanco:"",codigoAgencia:"",digitoAgencia:"",numeroConta:"",digitoConta:""},cartaoCredito:{}},y.paymentType=[],y.creditCardList=[],y.type="2",y.form=null,y.selectCard=u,y.validateSelectedItem=v,y.resetFields=s,y.onBackForm=t,y.onClickContinue=w,y.ctrl=b.$parent.vm,y.ctrl.currentStep.loading=!0,y.paymentContainer=f.RECEIVEMENT_TYPE[y.type],y.modal={open:!1,pendency:{open:!1}}}function n(){r(),b.$watch("vm.type",function(a){y.paymentContainer=f.RECEIVEMENT_TYPE[a]})}function o(a,b){y.modal.open=!0,y.modal[a].open=!0,b&&(y.modal[a].body=b)}function p(a){y.modal.open=!1,y.modal.pendency.open=!1,s()}function q(a){y.modal.open=!1,y.modal[a].open=!1}function r(){y.ctrl.currentStep.loading=!0;var a={numeroCpfCnpj:y.user.numeroCpfCnpj,codigoCanal:f.CHANNEL};i.post(a).then(function(a){var b=!(!a.data.cartoesCredito||!a.data.cartoesCredito.cartaoCredito);console.log(b),y.paymentType=a.data.FormasRecebimento.formaRecebimento.filter(function(a){return b?"6"!==a.codigoFormaRecebimento:"100"!==a.codigoFormaRecebimento&&"6"!==a.codigoFormaRecebimento}),a.data.hasOwnProperty("conta")&&(y.payment.conta=a.data.conta),a.data.hasOwnProperty("cartoesCredito")&&(y.creditCardList=a.data.cartoesCredito.cartaoCredito,y.payment.cartaoCredito=a.data.cartoesCredito.cartaoCredito[0])}).catch(function(a){y.ctrl.openModal("error")}).finally(function(){y.ctrl.currentStep.loading=!1})}function s(){y.payment.conta={},y.payment.cartaoCredito={},y.hasFirstDeny=!1,y.hasSecondDeny=!1}function t(){y.resetFields(),y.ctrl.stepBack(0),y.ctrl.removeSpinner("refund-spinner",!0),a.go(e.REFUND_REQUEST_LIST)}function u(a,b){Array.from(document.getElementsByClassName("list-link")).forEach(function(a){a.classList.remove("-bg-gradient")}),document.getElementById("card-"+b).classList.add("-bg-gradient"),y.payment.cartaoCredito=a}function v(a){return document.getElementById("card-"+a).classList.contains("-bg-gradient")}function w(){y.ctrl.addSpinner("refund-spinner");var a=y.paymentType.filter(function(a){return a.codigoFormaRecebimento===y.type})[0];g.setDataRefundPaymentType(a),g.setDataRefundPayment({conta:y.payment.conta,cartaoCredito:y.payment.cartaoCredito});var b=g.getDataResume();j.post(b).then(function(a){y.hasFirstDeny=a.data.indicadorPrimeiraRecusa,y.hasSecondDeny=a.data.indicadorSegundaRecusa,y.btDisabled=y.hasFirstDeny||y.hasSecondDeny,"2"===y.type&&y.hasFirstDeny?y.openModal("pendency",a.data.listaStatusRespostaServico.statusResponse[0].mensagem):"2"===y.type&&y.hasSecondDeny?y.openModal("pendency",a.data.listaStatusRespostaServico.statusResponse[0].mensagem):x()}).catch(function(a){y.ctrl.openModal("error")}).finally(function(){y.ctrl.currentStep.loading=!1,y.ctrl.removeSpinner("refund-spinner",!0)})}function x(){y.ctrl.stepForward(2),a.go(e.REFUND_REQUEST_CONFIRM)}var y=this;c("translate");l()}a.$inject=["$state","$scope","$filter","refundEndPoints","refundRoutes","refundConstant","refundDataLayerFactory","bankService","refundPaymentTypeService","refundAnalysePaymentTypeService","authenticationTokenRefundFactory"],angular.module("internetBanking.refund").controller("RefundRequestController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){r(),s()}function r(){A.ctrl=b.$parent.vm,A.user=l.getDataUserInfo(),A.refunds=l.getDataRefundList(),A.payment=l.getDataRefundPayment(),A.paymentType=l.getDataRefundPaymentType(),A.isAutomaticTermChecked=l.getDataRefundAutomaticTerm(),A.paymentContainer=j.RECEIVEMENT_TYPE[A.paymentType.codigoFormaRecebimento]||"BANK_TRANSFER",A.isToggled=[!1],A.hasPaymentDetails=!1,A.checkAutomaticRefund=!1,A.handleToggle=w,A.resetFields=v,A.onBackForm=x,A.getBankByCode=t,A.getAccountType=u,A.goToRefundReceiptPage=y,A.ctrl.currentStep.loading=!1,A.requestObj={descricaoCanal:j.CHANNEL,numeroCpfCnpj:A.user.numeroCpfCnpj},A.requestContract={numeroCpfCnpj:A.user.numeroCpfCnpj,sistemaSolicitante:j.CHANNEL,tipoRecebimento:A.paymentType.codigoFormaRecebimento},A.requestTerm={ip:"0.0.0.0",porta:"443",endereco:"",latitude:"",longitude:"",observacao:"",descricaoCanal:"Minha BV"}}function s(){l.setDataRefundAutomaticTerm(A.checkAutomaticRefund),k.getIP().then(function(a){A.requestTerm.ip=a}),Object.assign(A.requestTerm,{sistemaOperacional:g.os,navegador:g.browser,fluxo:Intl.DateTimeFormat().resolvedOptions().timeZone,numeroCpfCnpj:A.user.numeroCpfCnpj,loginParceiro:A.user.numeroCpfCnpj}),window.navigator.geolocation.getCurrentPosition(function(a){A.requestTerm.latitude=a.coords.latitude.toString(),A.requestTerm.longitude=a.coords.longitude.toString()})}function t(a){var b=l.getBankList(a);return b.codigoBacen+" - "+b.nome}function u(a){return l.getDataAccountType(a)}function v(){A.hasPaymentDetails=!1,A.checkAutomaticRefund=!1}function w(){A.hasPaymentDetails=!A.hasPaymentDetails}function x(){A.ctrl.stepBack(1),A.checkAutomaticRefund=!1,c.go(i.REFUND_REQUEST_FORM)}function y(){A.ctrl.addSpinner("refund-spinner");var a=A.checkAutomaticRefund,b=l.getDataResume();b.indicadorTermoAutomatico=a,o.post(b).then(function(b){A.requestTerm.indicadorTermoAutomatico=a,l.setDataRefundAutomaticTerm(a),m.post(A.requestTerm).then(function(a){n.post(A.requestContract).then(function(a){l.setDataRefundProtocol(a.data.numeroProtocolo),z()}).catch(function(a){A.ctrl.openModal("error"),A.ctrl.removeSpinner("refund-spinner",!0)}).finally(function(){A.ctrl.removeSpinner("refund-spinner",!0)})}).catch(function(a){A.ctrl.openModal("error"),A.ctrl.removeSpinner("refund-spinner",!0)})}).catch(function(a){A.ctrl.openModal("error"),A.ctrl.removeSpinner("refund-spinner",!0),A.ctrl.currentStep.loading=!1})}function z(){A.ctrl.stepForward(3),c.go(i.REFUND_REQUEST_RECEIPT)}var A=this;q()}a.$inject=["$rootScope","$scope","$state","$location","bankService","$stateParams","deviceDetector","refundEndPoints","refundRoutes","refundConstant","refundUtilsFactory","refundDataLayerFactory","refundAutomaticTermService","refundRequestContractService","refundInformPaymentTypeService","authenticationTokenRefundFactory"],angular.module("internetBanking.refund").controller("RefundConfirmController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(){k(),l()}function k(){u.ctrl=a.$parent.vm,u.receipt={},u.getBankByCode=m,u.getAccountType=n,u.refunds=f.getDataRefundList(),u.payment=f.getDataRefundPayment(),u.protocol=f.getDataRefundProtocol(),u.paymentType=f.getDataRefundPaymentType(),u.accountType=f.getDataAccountType(),u.automaticTerm=f.getDataRefundAutomaticTerm(),u.paymentContainer=g.RECEIVEMENT_TYPE[u.paymentType.codigoFormaRecebimento]||"BANK_TRANSFER",u.refunds.list.map(function(a){a.valorReembolso=parseFloat(a.valorReembolso)}),Object.assign(u.receipt,{account:u.payment.conta,creditCard:u.payment.cartaoCredito,paymentType:u.paymentType,protocol:u.protocol,channel:"",status:""}),u.isToggled=[!1],u.isToggledPayment=!1,u.ctrl.currentStep.loading=!1}function l(){u.onBackForm=p,u.goToHome=t,u.handleTogglePayment=q,u.toggleDetails=r,o()}function m(a){var b=f.getBankList(a);return b.codigoBacen+" - "+b.nome}function n(a){return f.getDataAccountType(a)}function o(){u.ctrl.currentStep.loading=!0;var a=new URLSearchParams({numeroContrato:u.refunds.list[0].numeroContrato,canalAtendimentoCliente:g.CHANNEL}).toString();h.get(a).then(function(a){var b=a.data.listaHistoricosContrato.historicosContrato[0];b&&(u.receipt.channel=b.descricaoCanalAtendimentoCliente,u.receipt.status=b.descricaaoStatusSolicitacaoAtendimento,f.callSendEvent({formaPagamento:u.receipt.paymentType.descricaoFormaRecebimento,status:u.receipt.status,valorReembolso:u.refunds.totalAmount.toString(),tipoConta:u.receipt.account.tipoConta,bancoReembolso:u.receipt.codigoBanco,cartaoReembolso:u.receipt.creditCard?u.receipt.creditCard.tipoCartao:"",numeroContrato:u.receipt.protocol,flPagamentoAutomatico:u.automaticTerm}))}).finally(function(){u.ctrl.currentStep.loading=!1})}function p(){u.ctrl.stepBack(2),b.go(d.REFUND_REQUEST_CONFIRM)}function q(){u.isToggledPayment=!u.isToggledPayment}function r(a,b){s(a),u.isToggled[b]=!u.isToggled[b]}function s(a){if(!a.installments){u.ctrl.currentStep.loading=!0;var b=a.codigoProcesso;i.get(b).then(function(b){b.data&&(a.installments=b.data.parcelas.parcela,a.installments.map(function(a){return a.dataRecebimentoParcela=moment(a.dataRecebimentoParcela).format("L")}))}).catch(function(a){u.ctrl.openModal("error")}).finally(function(){u.ctrl.currentStep.loading=!1})}}function t(){u.ctrl.addSpinner("refund-spinner"),e.goToHome().then(function(a){f.clear(),b.go(a.routeHome,a),u.ctrl.removeSpinner("refund-spinner",!0)})}var u=this;j()}a.$inject=["$scope","$state","bankService","refundRoutes","userInfoService","refundDataLayerFactory","refundConstant","refundHistoryListService","refundListDetailsService"],angular.module("internetBanking.refund").controller("RefundReceiptController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){p(),q()}function p(){c.sendTokenOnInit=!0,B.hasAutomaticPayment=!1,B.watchEvent=!0,B.loadingPage=!1,B.setTabActive=v,B.addSpinner=x,B.openModal=z,B.closeModal=A,B.removeSpinner=y,B.isTabActive=w,B.tabActive=2,B.user={},B.currentStep={tab:2,loading:!1},B.modal={open:!1,error:{open:!1}},B.refundAvailable=m.getRefundAvailable(),B.hasAutomaticPayment=!1,B.hasRefundAvailable=B.refundAvailable.indicadorReembolsoDisponivel}function q(){t(),r(),c.$on("$stateChangeStart",u),b.$on("loading",function(a,b){a.defaultPrevented||(B.currentStep.loading=b)})}function r(){e.get().then(function(a){m.setBankList(a.data)})}function s(){B.currentStep.loading=!0,B.request_refundAvailable={numeroCpfCnpj:B.user.numeroCpfCnpj,codigoSistemaOrigem:k.CHANNEL},l.post(B.request_refundAvailable).then(function(a){m.setRefundAvailable(a.data),B.hasRefundAvailable=a.data.indicadorReembolsoDisponivel}).finally(function(){B.currentStep.loading=!1})}function t(){d.getUserCPF().then(function(a){var b=f.getUserCached();Object.assign(B.user,{numeroCpfCnpj:a.name,phone:b.phone||"",email:b.email||""}),m.setDataUserInfo(B.user),s()})}function u(a,b){var c=b.params&&b.params.tab?b.params.tab:void 0;c&&(B.tabActive=parseInt(c),B.currentStep.tab=parseInt(c),B.currentStep.loading=!0)}function v(b){B.tabActive=parseInt(b),B.currentStep.tab=parseInt(b),angular.equals(b,1)&&a.go(h.REFUND_TABS_AVAILABLE_LIST),angular.equals(b,2)&&a.go(h.REFUND_TABS_REQUESTED),angular.equals(b,3)&&a.go(h.REFUND_TABS_PAYMENT)}function w(a){return angular.equals(B.tabActive,a)}function x(a){c.$emit(i.SPINNING_START,{target:a})}function y(a,b){c.$emit(i.SPINNING_STOP,{target:a,disabledBtn:b})}function z(a,b){B.modal.open=!0,B.modal[a].open=!0,b&&(B.modal[a].body=b)}function A(a){B.modal.open=!1,a||(B.modal.error.open=!1),B.modal[a].open=!1}var B=this;o()}a.$inject=["$state","$scope","$rootScope","userService","bankService","userInfoService","$stateParams","refundRoutes","commonEvents","contractData","refundConstant","refundAvailableService","refundDataLayerFactory","authenticationTokenRefundFactory"],angular.module("internetBanking.refund").controller("RefundMainController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){p(),q()}function p(){c.$emit("scroll-top"),y.ctrl=b.$parent.vm,y.reembolsoSolicitado=!1,y.expandirPagamento=v,y.expandirValor=w,y.voltarInicio=x,y.banks=[],y.reembolsos=[],y.isToggledPagamento=[],y.isToggledValor=[],y.currentProduct=g,y.reembolsoSolicitado=u(a.params.solicitacao)}function q(){s(),r()}function r(){d.get().then(function(a){y.banks=a.data})}function s(){y.ctrl.currentStep.loading=!0;var a=new URLSearchParams({numeroContrato:y.currentProduct,canalAtendimentoCliente:h.CHANNEL}).toString();j.get(a).then(function(a){y.reembolsos=a.data.listaHistoricosContrato.historicosContrato,y.reembolsos.map(function(a){a.dataReembolsoCliente=a.dataReembolsoCliente&&moment(a.dataReembolsoCliente).format("L"),n.get(a.codigoSolicitacaoReembolso).then(function(b){b.data.cartaoCredito&&Object.keys(b.data.cartaoCredito).length>0&&(a.pagamento=b.data.cartaoCredito,a.pagamento.tipo="Cartão de Cŕedito",a.pagamento.selected=h.RECEIVEMENT_TYPE[100]),b.data.conta&&Object.keys(b.data.conta).length>0&&(a.pagamento=b.data.conta,a.pagamento.tipo="Transferência bancária",a.pagamento.selected=h.RECEIVEMENT_TYPE[2],y.banks.map(function(c){c.codigoBacen==t(b.data.conta.codigoBanco)&&(a.pagamento.nomeBanco=c.nome,a.pagamento.codigoBacen=c.codigoBacen)}))})})}).finally(function(){y.ctrl.currentStep.loading=!1})}function t(a){return/[0-9]{3}/g.test(a)?a.toString():"0"+a.toString()}function u(a){return"s"===a}function v(a,b){y.isToggledPagamento[b]=!y.isToggledPagamento[b]}function w(a,b){a.parcelas||(y.ctrl.currentStep.loading=!0,l.get(a.codigoProcessoDevolucao).then(function(b){a.parcelas=b.data.parcelas.parcela,a.parcelas.map(function(a){return a.dataRecebimentoParcela=moment(a.dataRecebimentoParcela).format("L")})}).finally(function(){y.ctrl.currentStep.loading=!1})),y.isToggledValor[b]=!y.isToggledValor[b]}function x(){y.ctrl.addSpinner("refund-spinner"),f.goToHome().then(function(b){m.clear(),a.go(b.routeHome,b),y.ctrl.removeSpinner("refund-spinner",!0)})}var y=this;o()}a.$inject=["$state","$scope","$rootScope","bankService","refundRoutes","userInfoService","contractData","refundConstant","refundPaymentTypeService","refundHistoryListService","refundAvailableService","refundListDetailsService","refundDataLayerFactory","refundPaymentTypeRequested"],angular.module("internetBanking.credit").controller("RefundRequestedController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(){m(),n()}function m(){var d=c("translate"),e=f;a.$emit("scroll-top"),r.ctrl=b.$parent.vm,r.isToggled=[],r.toggleDetails=p,r.goToStep2=q,r.numeroProposta=e.data,r.disclaimer={message:d("@SITE-CREDIT-REEMBOLSO-LISTA-AVISO")},r.refundAvailable=h.getRefundAvailable(),r.refundQty=r.refundAvailable.quantidadeContratoReembolso}function n(){o()}function o(){r.ctrl.currentStep.loading=!0,e.getUserCPF().then(function(a){h.setDataUserInfo({numeroCpfCnpj:a.name});var b={numeroCpfCnpj:a.name,codigoSistemaOrigem:k.CHANNEL};i.post(b).then(function(a){r.refundQty=a.data.quantidadeContratoReembolso}).finally(function(){r.ctrl.currentStep.loading=!1})}).catch(function(a){r.ctrl.currentStep.loading=!1})}function p(a,b){a.installments||j.get(a.codigoProcesso).then(function(b){a.installments=b.data.parcelas.parcela,a.installments.map(function(a){return a.dataRecebimentoParcela=moment(a.dataRecebimentoParcela).format("L")})}),r.isToggled[b]=!r.isToggled[b]}function q(){r.ctrl.addSpinner("refund-spinner"),h.setDataRefundList({list:r.refunds,totalAmount:r.totalAmount}),h.setDataUserInfo(r.user),r.ctrl.removeSpinner("refund-spinner",!0),d.go(g.REFUND_REQUEST_LIST)}var r=this;l()}a.$inject=["$rootScope","$scope","$filter","$state","userService","contractData","refundRoutes","refundDataLayerFactory","refundAvailableService","refundListDetailsService","refundConstant"],angular.module("internetBanking.refund").controller("RefundAvailableOne",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){var j=this;h.getUserCPF().then(function(b){function h(){a.$emit("scroll-top"),i.clearPayment()}function k(){j.request_analisarRecebimento={numeroCpfCnpj:j.cpf,codigoSistemaOrigem:4},null===j.tipoFormaRecebimento||2!==j.tipoFormaRecebimento.codigoFormaRecebimento&&6!==j.tipoFormaRecebimento.codigoFormaRecebimento||e.post(j.request_tipo_pagamento).then(function(a){a.data.hasOwnProperty("conta")&&(j.request_analisarRecebimento.conta=a.data.conta)})}function l(){j.modalRecusaConfig={open:!1},j.modalRecusa2Config={open:!1}}function m(a){Array.from(document.getElementsByClassName("list-link")).forEach(function(a){a.classList.remove("-bg-gradient")}),document.getElementById("card-"+a).classList.add("-bg-gradient"),j.cartaoSelecionado=j.cartoes[a],j.request_analisarRecebimento.cartaoCredito={bandeira:j.cartaoSelecionado.cartaoCredito.bandeira,codigoBandeira:j.cartaoSelecionado.cartaoCredito.codigoBandeira,codigoTipoCartao:j.cartaoSelecionado.cartaoCredito.codigoTipoCartao,ultimos4digitos:j.cartaoSelecionado.cartaoCredito.ultimos4digitos,tipoCartao:j.cartaoSelecionado.cartaoCredito.tipoCartao}}function n(a){return document.getElementById("card-"+a).classList.contains("-bg-gradient")}function o(){return null!==j.tipoFormaRecebimento&&100===j.tipoFormaRecebimento.codigoFormaRecebimento?!j.cartaoSelecionado:null===j.tipoFormaRecebimento||2!==j.tipoFormaRecebimento.codigoFormaRecebimento||(j.formRefund.$invalid||!j.request_analisarRecebimento.conta.tipoConta)}function p(){f.post(j.request_analisarRecebimento).then(function(a){a.data.indicadorPrimeiraRecusa?j.modalRecusaConfig.open=!0:a.data.indicadorSegundaRecusa?j.modalRecusa2Config.open=!0:c.go(d.REFUND_AVAILABLE_STEP3)})}function q(){c.go(d.REFUND_AVAILABLE_STEP1)}function r(){i.setDataRefundPaymentType(j.tipoFormaRecebimento),i.setDataRefundPayment(j.request_analisarRecebimento),c.go(d.REFUND_AVAILABLE_STEP3)}j.user=g.getUserCached(),j.tipoFormaRecebimento=null,j.cartaoSelecionado=!1,j.cpf=b.name,j.request_analisarRecebimento={numeroCpfCnpj:j.cpf,codigoSistemaOrigem:4},j.request_tipo_pagamento={numeroCpfCnpj:j.cpf,codigoCanal:4},e.post(j.request_tipo_pagamento).then(function(a){j.formasRecebimento=a.data.formasRecebimento,a.data.hasOwnProperty("cartoesCredito")&&(j.cartoes=a.data.cartoesCredito.cartaoCredito)}),j.selecionarCartao=m,j.validarSelecionado=n,j.goToStep1=q,j.goToStep3=r,j.validarRecusa=p,j.validarCampos=o,j.resetRequestAnaliseRecebimento=k,j.resetModal=l,l(),h()})}a.$inject=["$rootScope","$scope","$state","refundRoutes","refundPaymentTypeService","refundAnalysePaymentTypeService","userInfoService","userService","refundDataLayerFactory"],angular.module("internetBanking.refund").controller("RefundAvailableTwo",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(){a.$emit("scroll-top"),g.getUserCPF().then(function(a){o.cpf=a.name}),o.tipoFormaRecebimento=h.getDataRefundPaymentType(),o.request_analisarRecebimento=h.getDataRefundPayment(),o.totalAmount=h.getDataRefundList().totalAmount,o.contracts=h.getDataRefundList().list,o.isExpandirPagamento=!1,o.checkSolicitar=!1,o.goToStep2=l,o.goToStep4=m,o.expandirPagamento=k}function k(){o.isExpandirPagamento=!o.isExpandirPagamento}function l(){c.go(d.REFUND_AVAILABLE_STEP2)}function m(){n(),o.contracts.length>1?c.go(d.REFUND_AVAILABLE_STEP4):(b.$parent.vm.tabActive=2,c.go(d.REFUND_REQUESTED,{solicitacao:"s"}))}function n(){var a={numeroCpfCnpj:o.cpf,endereco:"string",loginParceiro:o.cpf,"observação":"string"};document.getElementById("checkbox-solicitacao").checked?(o.request_analisarRecebimento.indicadorTermoAutomatico=!0,a.indicadorTermoAutomatico=!0):(o.request_analisarRecebimento.indicadorTermoAutomatico=!1,a.indicadorTermoAutomatico=!1),e.post(o.request_analisarRecebimento).then(function(b){f.post(a).then(function(a){h.setDataRefundProtocol(a.data.numeroProtocolo)})})}var o=this;j()}a.$inject=["$rootScope","$scope","$state","refundRoutes","refundInformPaymentTypeService","refundAutomaticTermService","userService","refundDataLayerFactory","deviceDetector"],angular.module("internetBanking.refund").controller("RefundAvailableThree",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(){a.$emit("scroll-top")}function g(){i.isExpandirPagamento=!i.isExpandirPagamento}function h(){c.go(d.HOME)}var i=this;i.tipoFormaRecebimento=null,i.isExpandirPagamento=!1,i.tipoFormaRecebimento=e.getDataRefundPaymentType(),i.request_analisarRecebimento=e.getDataRefundPayment(),i.voltarInicio=h,i.expandirPagamento=g,f()}a.$inject=["$rootScope","$scope","$state","refundRoutes","refundDataLayerFactory"],angular.module("internetBanking.refund").controller("RefundAvailableFour",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(){a.$emit("scroll-top");var b=o.getDataTransaction(),c=b.receiveType||"DEFAULT",d=b.pageName;F.receiveType=c,F.model.receive="DEFAULT"===c?"SMS":c,F.ctrl.currentStep.loading=!1,q.customPageView({pageName:G(d)});t.getDataUserInfo();a.sendTokenOnInit&&x()}function v(){var a=o.getDataTransaction();return I={data:{tipoDeEnvio:F.model.receive,tipoTransacaoToken:a.kindTokenTransaction,ultimosQuatroDigitosCartao:"1234"},prefixEndpoint:a.prefixEndpoint,successRoute:a.successRoute}}function w(a){var c=6,d=i.open(b,[c,c],null,a);return F.view.disabledToken=!0,F.model.token="",d.then(function(a){F.model.token=a,F.view.disabledToken=!1,F.view.disabledConfirm=!1},function(a){F.view.disabledToken=!1}),d}function x(b){function c(c){F.resend=!0,f(function(){F.view.disabledBtnSendToken=a.countTokenAttempts>j.MAX_TOKEN_ATTEMPTS,F.view.labelBtnSendToken=J.resend},H),F.view.modalMessage=y(c.data.destinoDeEnvio),F.view.modalConfig.open=b,F.disclaimer.show=!0,F.view.disabledToken=!1,f(function(){document.getElementById("confirm-token-number").focus()},1500)}function d(b){var c=b&&b.data&&b.data.messages&&b.data.messages[1];F.view.modalErrorMessage=J.sendTokenError||c,F.view.modalErrorConfig.open=!0,F.view.disabledBtnSendToken=a.countTokenAttempts>j.MAX_TOKEN_ATTEMPTS}C("send-token-spinner"),F.disclaimer.show=!0,F.view.disabledBtnSendToken=!0;var e,g=v();return e=F.resend?m.resend(g):m.send(g),e.then(c).catch(d).finally(function(){D("send-token-spinner",!1)}),e}function y(a){return F.smsSentMessage=r.maskPhoneNumber(a),"Código enviado via SMS para o número "+r.maskPhoneNumber(a)}function z(){F.view.modalErrorConfig.open=!1}function A(){F.view.modalConfig.open=!1}function B(){function b(b){a.countTokenAttempts=0,c.go(e.successRoute)}function d(b){var c=b&&b.data&&b.data.messages&&b.data.messages[1],d="";"SMS"===F.receiveType&&(a.countTokenAttempts+=1),J.confirmTokenWarning=G("@SITE-REEMBOLSO-AUTHENTICATION-TOKEN-CONFIRMAR-MODAL-AVISO",{attempts:j.MAX_TOKEN_ATTEMPTS-a.countTokenAttempts}),d=a.countTokenAttempts>j.MAX_TOKEN_ATTEMPTS?J.confirmTokenError:J.confirmTokenWarning,F.view.modalErrorConfig.open=!0,F.view.modalErrorMessage=d||c,F.view.disabledConfirm=!0,F.view.disabledToken=!0,F.model.token="",F.view.disabledBtnSendToken=a.countTokenAttempts>j.MAX_TOKEN_ATTEMPTS,F.resend=!1}C("confirm-token-spinner");var e=v();e.token=F.model.token;var f=m.confirmOperation(e);return f.then(b).catch(d).finally(function(){D("confirm-token-spinner",!0)}),f}function C(b){a.$emit(p.SPINNING_START,{target:b})}function D(b,c){a.$emit(p.SPINNING_STOP,{target:b,disabledBtn:c})}function E(a){c.go(a)}a.countTokenAttempts=1;var F=this,G=e("translate"),H=1e4,I={},J=(j.PAGE_NAME_REFUND.REFUND_REQUEST_AUTH_TOKEN,{sendNow:G("@SITE-CARTAO-CREDITO-LINK-SEGURANCA-ENVIAR-AGORA"),resend:G("@SITE-CARTAO-CREDITO-LINK-SEGURANCA-REENVIAR-AGORA"),sendTokenError:G("@SITE-REEMBOLSO-AUTHENTICATION-TOKEN-ENVIAR-MODAL-ERRO"),confirmTokenError:G("@SITE-REEMBOLSO-AUTHENTICATION-TOKEN-CONFIRMAR-MODAL-ERRO"),noPhoneError:G("@SITE-REEMBOLSO-AUTHENTICATION-TOKEN-HAS-NO-PHONE-ERROR"),noPhoneSAC:G("@SITE-REEMBOLSO-AUTHENTICATION-TOKEN-SAC"),disclaimer:G("@SITE-REEMBOLSO-AUTHENTICATION-TOKEN-ALERT")});F.smsSentMessage="",F.ctrl=b.$parent.vm,F.resend=!1,F.view={disabledToken:!0,disabledConfirm:!0,disabledBtnSendToken:a.countTokenAttempts>j.MAX_TOKEN_ATTEMPTS,modalConfig:{open:!1},modalErrorConfig:{open:!1},modalErrorMessage:"",labelBtnSendToken:J.sendNow,modalMessage:"",noPhoneError:J.noPhoneError},F.model={receive:""},F.receiveType="",F.onFocusTokenValue=w,F.onConfirmSendToken=x,F.onConfirmToken=B,F.onCloseModal=A,F.onBackPage=E,F.onCloseModalTokenError=z,F.route=g,F.userInfo={ddd:"",phone:""},F.noPhoneMessage=!1,F.disclaimer={message:J.disclaimer,show:!1},u()}a.$inject=["$rootScope","$scope","$state","$stateParams","$filter","$timeout","refundRoutes","userInfoService","VirtualKeyboard","refundConstant","refundEndPoints","personalDataService","refundAuthTokenService","productDetailService","authTokenFactory","commonEvents","dataLayerFactory","refundUtilsFactory","contractData","refundDataLayerFactory"],angular.module("internetBanking.refund").controller("RefundAuthTokenController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){p(),q()}function p(){a.$emit("scroll-top"),x.user=l.getDataUserInfo(),x.ctrl=c.$parent.vm,x.pagCadastrado=!1,x.hasAutomaticTerm=!1,x.paymentContainer="",x.formasRecebimento=[],x.formaPagamentoAtual={codigoFormaRecebimento:"",descricaoFormaRecebimento:""},x.parceiroComercial="",x.numeroProposta=n,x.isExpandirPagamento=!1,x.isPaymentApproved=!1,x.expandirPagamento=u,x.goToCancel1=v,x.goToAlter1=w,x.getPaymentRequested=t,x.request_analisarRecebimento={numeroCpfCnpj:x.user.numeroCpfCnpj,codigoSistemaOrigem:f.CHANNEL}}function q(){s(),r(),c.$watch("vm.formaPagamentoAtual",function(a){x.paymentContainer=f.RECEIVEMENT_TYPE[a.codigoFormaRecebimento]})}function r(){x.ctrl.currentStep.loading=!0,x.request_refundAvailable={numeroCpfCnpj:x.user.numeroCpfCnpj,codigoSistemaOrigem:f.CHANNEL},e.post(x.request_refundAvailable).then(function(a){x.pagCadastrado=a.data.indicadorPagamentoAutomatico,x.ctrl.hasRefundAvailable=a.data.indicadorReembolsoDisponivel,t()})}function s(){m.get().then(function(a){x.banks=a.data})}function t(){x.request_tipo_pagamento={numeroCpfCnpj:x.user.numeroCpfCnpj,codigoCanal:f.CHANNEL},k.post(x.request_tipo_pagamento).then(function(a){x.formasRecebimento=a.data.FormasRecebimento.formaRecebimento,a.data.hasOwnProperty("cartoesCredito")&&Object.keys(a.data.cartoesCredito.cartaoCredito).length>0&&(x.request_analisarRecebimento.cartaoCredito=a.data.cartoesCredito.cartaoCredito[0],x.isPaymentApproved=Object.values(a.data.cartaoCredito).some(function(a){return""!=a}),x.formaPagamentoAtual=x.formasRecebimento.filter(function(a){return"100"===a.codigoFormaRecebimento})[0]),a.data.hasOwnProperty("conta")&&Object.keys(a.data.conta).length>0&&(x.request_analisarRecebimento.conta=a.data.conta,x.isPaymentApproved=Object.values(a.data.conta).some(function(a){return""!=a}),x.banks.filter(function(b){b.codigoBacen===a.data.conta.codigoBanco&&Object.assign(x.request_analisarRecebimento.conta,{codigoBanco:b})}),x.formaPagamentoAtual=x.formasRecebimento.filter(function(a){return"2"===a.codigoFormaRecebimento})[0]),x.paymentContainer=f.RECEIVEMENT_TYPE[x.formaPagamentoAtual.codigoFormaRecebimento]}).catch(function(a){}).finally(function(){x.ctrl.currentStep.loading=!1})}function u(){x.isExpandirPagamento=!x.isExpandirPagamento}function v(){l.setDataRefundPayment(x.request_analisarRecebimento),l.setDataRefundPaymentType(x.formaPagamentoAtual),j.set({successRoute:d.REFUND_PAYMENT_CANCEL1,prefixEndpoint:h.PREFIX_URL,kindTokenTransaction:f.REFUND_AUTHENTICATION_TOKEN_KEY}),j.sendDataToken(),b.go(d.REFUND_TABS_AUTH_TOKEN)}function w(){x.ctrl.addSpinner("refund-spinner"),l.setDataUserInfo(x.user),j.set({successRoute:d.REFUND_PAYMENT_ALTER1,prefixEndpoint:h.PREFIX_URL,kindTokenTransaction:f.REFUND_AUTHENTICATION_TOKEN_KEY}),j.sendDataToken(),x.ctrl.removeSpinner("refund-spinner",!0),b.go(d.REFUND_TABS_AUTH_TOKEN)}var x=this;o()}
a.$inject=["$rootScope","$state","$scope","refundRoutes","refundAvailableService","refundConstant","userService","refundEndPoints","userInfoService","authenticationTokenRefundFactory","refundPaymentTypeService","refundDataLayerFactory","bankService","contractData"],angular.module("internetBanking.refund").controller("RefundPaymentController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(){n(),o()}function n(){a.$emit("scroll-top"),k.clearPayment(),z.user=k.getDataUserInfo(),z.ctrl=c.$parent.vm,z.selecionarCartao=r,z.validarSelecionado=s,z.validarRecusa=u,z.validarCampos=t,z.goToPayment=x,z.goToAlter2=y,z.resetModal=w,z.request_analisarRecebimento={conta:{},cartaoCredito:{}},z.tipoFormaRecebimento="2",z.paymentContainer=f.RECEIVEMENT_TYPE[2],z.btDisabled=!1,z.view={modalMessage:""}}function o(){w(),q(),p(),c.$watch("vm.tipoFormaRecebimento",function(a){null!==a&&(k.setDataRefundPaymentType(a),z.paymentContainer=f.RECEIVEMENT_TYPE[a])})}function p(){e.get().then(function(a){z.banks=a.data})}function q(){z.ctrl.currentStep.loading=!0,z.request_tipo_pagamento={numeroCpfCnpj:z.user.numeroCpfCnpj,codigoCanal:f.CHANNEL},i.post(z.request_tipo_pagamento).then(function(a){var b=!(!a.data.cartoesCredito||!a.data.cartoesCredito.cartaoCredito);z.formasRecebimento=a.data.FormasRecebimento.formaRecebimento.filter(function(a){return b?"6"!==a.codigoFormaRecebimento:"100"!==a.codigoFormaRecebimento&&"6"!==a.codigoFormaRecebimento}),a.data.hasOwnProperty("cartoesCredito")&&(z.cartoes=a.data.cartoesCredito.cartaoCredito),a.data.hasOwnProperty("conta")&&(z.request_analisarRecebimento.conta=a.data.conta)}).catch(function(){z.ctrl.openModal("error"),z.ctrl.removeSpinner("refund-spinner",!0)}).finally(function(){z.ctrl.currentStep.loading=!1})}function r(a,b){Array.from(document.getElementsByClassName("list-link")).forEach(function(a){a.classList.remove("-bg-gradient")}),document.getElementById("card-"+b).classList.add("-bg-gradient"),z.cartaoSelecionado=a,z.request_analisarRecebimento.cartaoCredito={bandeira:a.bandeira,codigoBandeira:a.codigoBandeira,codigoTipoCartao:a.codigoTipoCartao,ultimos4digitos:a.ultimos4digitos,tipoCartao:a.tipoCartao}}function s(a){return document.getElementById("card-"+a).classList.contains("-bg-gradient")}function t(){return null!==z.tipoFormaRecebimento&&"100"===z.tipoFormaRecebimento?!z.cartaoSelecionado:null===z.tipoFormaRecebimento||"2"!==z.tipoFormaRecebimento||z.form.$invalid}function u(){z.ctrl.addSpinner("refund-spinner");var a=z.formasRecebimento.filter(function(a){return a.codigoFormaRecebimento===z.tipoFormaRecebimento})[0];k.setDataRefundPaymentType(a),k.setDataRefundPayment(z.request_analisarRecebimento);var b=k.getDataResume();l.post(b).then(function(a){z.btDisabled=a.data.indicadorPrimeiraRecusa||a.data.indicadorSegundaRecusa,"2"===z.tipoFormaRecebimento&&a.data.indicadorPrimeiraRecusa?(z.view.modalMessage=a.data.listaStatusRespostaServico.statusResponse[0].mensagem,z.modalRecusaPagamentoConfig.open=!0):"2"===z.tipoFormaRecebimento&&a.data.indicadorSegundaRecusa?(z.view.modalMessage=a.data.listaStatusRespostaServico.statusResponse[0].mensagem,z.modalRecusaPagamento2Config.open=!0):y()}).catch(function(){z.ctrl.openModal("error"),z.ctrl.removeSpinner("refund-spinner",!0)})}function v(){z.request_analisarRecebimento.conta={tipoConta:"",codigoBanco:"",codigoAgencia:"",digitoAgencia:"",numeroConta:"",digitoConta:""},z.request_analisarRecebimento.cartaoCredito={}}function w(){z.ctrl.removeSpinner("refund-spinner",!0),v(),z.modalRecusaPagamentoConfig={open:!1},z.modalRecusaPagamento2Config={open:!1}}function x(){v(),b.go(d.REFUND_TABS_PAYMENT)}function y(){k.setDataRefundPayment(z.request_analisarRecebimento),b.go(d.REFUND_PAYMENT_ALTER2)}var z=this;m()}a.$inject=["$rootScope","$state","$scope","refundRoutes","bankService","refundConstant","userService","refundPaymentTypeRequested","refundPaymentTypeService","authenticationTokenRefundFactory","refundDataLayerFactory","refundAnalysePaymentTypeService"],angular.module("internetBanking.refund").controller("RefundAlterOneController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){a.$emit("scroll-top"),v.ctrl=b.$parent.vm,v.user=k.getDataUserInfo(),v.tipoFormaRecebimento=k.getDataRefundPaymentType(),v.request_analisarRecebimento=k.getDataRefundPayment(),v.accountType=k.getDataAccountType(),v.cpf=null,v.isExpandirPagamento=!1,v.checkAlterar=!1,v.goToAlter1=t,v.goToAlter3=u,v.expandirPagamento=s,v.getAccountType=p,v.paymentContainer=i.RECEIVEMENT_TYPE[v.tipoFormaRecebimento.codigoFormaRecebimento],v.requestTerm={numeroCpfCnpj:v.user.numeroCpfCnpj,loginParceiro:v.user.numeroCpfCnpj,ip:"0.0.0.0",porta:"",endereco:"",latitude:"",longitude:"",observacao:"",descricaoCanal:"Minha BV",sistemaOperacional:g.os,navegador:g.browser,fluxo:Intl.DateTimeFormat().resolvedOptions().timeZone},j.getIP().then(function(a){v.requestTerm.ip=a}),window.navigator.geolocation.getCurrentPosition(function(a){v.requestTerm.latitude=a.coords.latitude.toString(),v.requestTerm.longitude=a.coords.longitude.toString()}),q(),r()}function p(a){return k.getDataAccountType(a)}function q(){d.get().then(function(a){v.banks=a.data,v.banks.filter(function(a){a.codigoBacen===v.request_analisarRecebimento.conta.codigoBanco&&Object.assign(v.request_analisarRecebimento.conta,{codigoBanco:a})})})}function r(){v.request_tipo_pagamento={numeroCpfCnpj:v.user.numeroCpfCnpj,codigoCanal:i.CHANNEL},l.post(v.request_tipo_pagamento).then(function(a){v.formasRecebimento=a.data.FormasRecebimento.formaRecebimento,a.data.hasOwnProperty("cartoesCredito")&&(v.cartoes=a.data.cartoesCredito.cartaoCredito)}).catch(function(){v.ctrl.removeSpinner("refund-spinner",!0),v.ctrl.openModal("error")})}function s(){v.isExpandirPagamento=!v.isExpandirPagamento}function t(){c.go(f.REFUND_PAYMENT_ALTER1)}function u(){v.ctrl.addSpinner("refund-spinner"),document.getElementById("checkbox-pagamento-alterar").checked?(v.request_analisarRecebimento.indicadorTermoAutomatico=!0,v.requestTerm.indicadorTermoAutomatico=!0):(v.request_analisarRecebimento.indicadorTermoAutomatico=!1,v.requestTerm.indicadorTermoAutomatico=!1);var a=k.getDataResume();n.post(a).then(function(a){m.post(v.requestTerm).then(function(a){k.setDataRefundProtocol(a.data.numeroProtocolo),c.go(f.REFUND_PAYMENT_ALTER3)}).catch(function(a){v.ctrl.removeSpinner("refund-spinner",!0),v.ctrl.openModal("error")})}).catch(function(){v.ctrl.removeSpinner("refund-spinner",!0),v.ctrl.openModal("error")}).finally(function(){v.ctrl.removeSpinner("refund-spinner",!0)})}var v=this;o()}a.$inject=["$rootScope","$scope","$state","bankService","userService","refundRoutes","deviceDetector","userInfoService","refundConstant","refundUtilsFactory","refundDataLayerFactory","refundPaymentTypeService","refundAutomaticTermService","refundInformPaymentTypeService"],angular.module("internetBanking.refund").controller("RefundAlterTwoController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(){a.$emit("scroll-top"),l.ctrl=c.$parent.vm,l.tipoFormaRecebimento=g.getDataRefundPaymentType(),l.request_analisarRecebimento=g.getDataRefundPayment(),l.protocolNumber=g.getDataRefundProtocol(),l.isExpandirPagamento=!1,l.expandirPagamento=j,l.getAccountType=i,l.voltarInicio=k,l.paymentContainer=f.RECEIVEMENT_TYPE[l.tipoFormaRecebimento.codigoFormaRecebimento],g.callSendEvent({formaPagamento:l.tipoFormaRecebimento.descricaoFormaRecebimento,numeroContrato:l.protocolNumber})}function i(a){return g.getDataAccountType(a)}function j(){l.isExpandirPagamento=!l.isExpandirPagamento}function k(){l.ctrl.addSpinner("refund-spinner"),d.goToHome().then(function(a){g.clear(),b.go(a.routeHome,a),l.ctrl.removeSpinner("refund-spinner",!0)})}var l=this;h()}a.$inject=["$rootScope","$state","$scope","userInfoService","refundRoutes","refundConstant","refundDataLayerFactory"],angular.module("internetBanking.refund").controller("RefundAlterThreeController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){a.$emit("scroll-top"),t.ctrl=c.$parent.vm,t.request_analisarRecebimento=l.getDataResume(),t.user=l.getDataUserInfo(),t.voltarCancelarInicio=r,t.goToCancel2=s,t.checkCancelar=!1,t.cpf=null,q(),t.requestTerm={numeroCpfCnpj:t.user.numeroCpfCnpj,loginParceiro:t.user.numeroCpfCnpj,ip:"0.0.0.0",porta:"",endereco:"",latitude:"",longitude:"",observacao:"",descricaoCanal:"Minha BV",sistemaOperacional:h.os,navegador:h.browser,fluxo:Intl.DateTimeFormat().resolvedOptions().timeZone},k.getIP().then(function(a){t.requestTerm.ip=a}),window.navigator.geolocation.getCurrentPosition(function(a){t.requestTerm.latitude=a.coords.latitude.toString(),t.requestTerm.longitude=a.coords.longitude.toString()})}function q(){d.getUserCPF().then(function(a){t.cpf=a.name})}function r(){b.go(g.REFUND_TABS_PAYMENT)}function s(){t.ctrl.addSpinner("refund-spinner"),t.requestTerm.indicadorTermoAutomatico=!1,t.request_analisarRecebimento.indicadorTermoAutomatico=!1,n.post(t.request_analisarRecebimento).then(function(a){m.post(t.requestTerm).then(function(a){b.go(g.REFUND_PAYMENT_CANCEL2),l.setDataRefundProtocol(a.data.numeroProtocolo)}).catch(function(){t.ctrl.removeSpinner("refund-spinner",!0),t.ctrl.openModal("error")}).finally(function(){t.ctrl.removeSpinner("refund-spinner",!0)})}).catch(function(){t.ctrl.removeSpinner("refund-spinner",!0),t.ctrl.openModal("error")})}var t=this;p()}a.$inject=["$rootScope","$state","$scope","userService","contractData","userInfoService","refundRoutes","deviceDetector","refundConstant","refundEndPoints","refundUtilsFactory","refundDataLayerFactory","refundAutomaticTermService","refundInformPaymentTypeService","authenticationTokenRefundFactory"],angular.module("internetBanking.refund").controller("RefundCancelOneController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(){a.$emit("scroll-top"),n.ctrl=c.$parent.vm,n.voltarInicio=m,n.protocolNumber=j.getDataRefundProtocol(),j.callSendEvent({numeroContrato:n.protocolNumber})}function m(){n.ctrl.addSpinner("refund-spinner"),g.goToHome().then(function(a){j.clear(),b.go(a.routeHome,a),n.ctrl.removeSpinner("refund-spinner",!0)})}var n=this;l()}a.$inject=["$rootScope","$state","$scope","refundRoutes","creditCardRoutes","refundAvailableService","userInfoService","userService","authenticationTokenRefundFactory","refundDataLayerFactory","deviceDetector"],angular.module("internetBanking.refund").controller("RefundCancelTwoController",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(a){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=e.defer(),i={method:"POST",url:b.backEnd+c.REFUND_AVAILABLE,cache:!1,timeout:1e5,data:a};return d(i).then(f).catch(g),h.promise}return{post:f}}a.$inject=["tokenCSFactory","appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundAvailableService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){i.resolve(a)}function g(a){i.reject(a)}var h=a.backEnd+b.REFUND_LIST,i=d.defer();return c({method:"POST",cache:!0,url:h,data:e}).then(f).catch(g),i.promise}function f(e){function f(a){i.resolve(a)}function g(a){i.reject(a)}var h=a.backEnd+b.REFUND_RECEIVEMENT_TYPE_LIST,i=d.defer();return c({method:"POST",cache:!0,url:h,data:e}).then(f).catch(g),i.promise}function g(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.REFUND_DETAILS+"?codigoProcessoDevolucao="+e,cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{get:e,post:f,details:g}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundListService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",cache:!1,url:a.backEnd+e.prefixEndpoint+b.SEND_TOKEN,data:e.data};return c(i).then(f).catch(g),h.promise}function f(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",cache:!1,url:a.backEnd+e.prefixEndpoint+b.RESEND_TOKEN,data:e.data};return c(i).then(f).catch(g),h.promise}function g(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+e.prefixEndpoint+b.CONFIRM_OPERATION,data:e.data,headers:{"hst-token":e.token}};return c(i).then(f).catch(g),h.promise}return{send:e,resend:f,confirmOperation:g}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundAuthTokenService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.REFUND_REQUEST_HISTORY+"?"+e,cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{get:e}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundHistoryListService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.REFUND_REQUEST_PAYMENT_TYPE,data:{codigoSolicitacao:e},cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{get:e}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundRequestPaymentType",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.REFUND_DETAILS+"?codigoProcessoDevolucao="+e,cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{get:e}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundListDetailsService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){i.resolve(a)}function g(a){i.reject(a)}var h=a.backEnd+b.REFUND_RECEIVEMENT_TYPE_LIST,i=d.defer();return c({method:"POST",cache:!0,url:h,data:e}).then(f).catch(g),i.promise}return{post:e}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundPaymentTypeService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.REFUND_REQUEST_PAYMENT_TYPE+"?codigoSolicitacao="+e,cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{get:e}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundPaymentTypeRequested",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){function d(a){h.resolve(a)}function g(a){h.reject(a)}var h=f.defer(),i={method:"POST",url:b.backEnd+c.REFUND_ANALYSE_RECEIVEMENT_TYPE,cache:!1,timeout:1e5,data:a};return e(i).then(d).catch(g),h.promise}return{post:g}}a.$inject=["tokenCSFactory","appSettings","refundEndPoints","deviceDetector","$http","$q"],angular.module("internetBanking.refund").service("refundAnalysePaymentTypeService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){function d(a){h.resolve(a)}function g(a){h.reject(a)}var h=f.defer(),i={method:"POST",url:b.backEnd+c.REFUND_SEND_PAYMENT_TYPE,cache:!1,timeout:1e5,data:a};return e(i).then(d).catch(g),h.promise}return{post:g}}a.$inject=["tokenCSFactory","appSettings","refundEndPoints","deviceDetector","$http","$q"],angular.module("internetBanking.refund").service("refundInformPaymentTypeService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}if(e){var h=d.defer(),i={method:"POST",url:a.backEnd+b.REFUND_INFORME_AUTOMATIC_TERM,cache:!1,timeout:1e5,data:e};return c(i).then(f).catch(g),h.promise}}return{post:e}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.refund").service("refundAutomaticTermService",a)}(),function(){"use strict";function a(a,b,c,d){function e(){function e(a){h.resolve(a)}function f(a){h.reject(a)}var g=a.backEnd+b.REFUND_LIST,h=d.defer();return c({method:"POST",cache:!0,url:g}).then(e).catch(f),h.promise}function f(e){function f(a){i.resolve(a)}function g(a){i.reject(a)}var h=a.backEnd+b.REFUND_RECEIVEMENT_TYPE_LIST,i=d.defer();return c({method:"POST",cache:!0,url:h,data:e}).then(f).catch(g),i.promise}function g(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.REFUND_AVAILABLE,cache:!1,timeout:1e5,data:e};return c(i).then(f).catch(g),h.promise}function h(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.REFUND_LIST,data:{numeroCpfCnpj:e.numeroCpfCnpj,numeroContrato:e.numeroContrato,codigoSistemaSolicitante:e.codigoSistemaSolicitante,codigoStatusReembolso:e.codigoStatusReembolso},cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}function i(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.REFUND_DETAILS,data:{codigoProcessoDevolucao:e},cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{get:e,post:f,refundAvailable:g,listarContratoComReembolso:h,consultarDetalheReembolso:i}}a.$inject=["appSettings","refundEndPoints","$http","$q"],angular.module("internetBanking.credit").service("refundAvailableListService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){function d(a){h.resolve(a)}function g(a){h.reject(a)}var h=f.defer(),i={method:"POST",url:b.backEnd+c.REFUND_REQUEST_CONTRACT,cache:!1,timeout:1e5,data:a};return e(i).then(d).catch(g),h.promise}return{post:g}}a.$inject=["tokenCSFactory","appSettings","refundEndPoints","deviceDetector","$http","$q"],angular.module("internetBanking.refund").service("refundRequestContractService",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(a){return moment(a.split("/").reverse().join("-"))}function g(a){function b(a){i[a]||c(a),i[a]=!0}function c(a){d.resolve(a)}var d=e.defer(),f=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,g=new f({iceServers:[]}),h=function(){},i={},j=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g;return g.createDataChannel(""),g.createOffer(function(a){a.sdp.split("\n").forEach(function(a){a.indexOf("candidate")<0||a.match(j).forEach(b)}),g.setLocalDescription(a,h,h)},h),g.onicecandidate=function(a){a&&a.candidate&&a.candidate.candidate&&a.candidate.candidate.match(j)&&a.candidate.candidate.match(j).forEach(b)},d.promise}function h(a){var b=null;return a&&(b=a.replace(/\X/g,"•")),b}function i(a){if(a)var b=(new RegExp(/[0-9]/g),a.substring(0,a.length-3).replace(/[0-9]/g,"•")),c=a.substring(a.length-3,a.length);return b+c}return{formatDate:f,getIP:g,maskPhoneNumber:h,maskAccountNumber:i}}a.$inject=["dataLayerFactory","$state","$stateParams","refundConstant","$q"],angular.module("internetBanking.refund").factory("refundUtilsFactory",a)}(),function(){"use strict";function a(a,b,c,d){function e(a){f(a)?h=a:console.error("Precisa passar um objeto com os seguintes atributos:{successRoute, prefixEndpoint}")}function f(a){return 0==["successRoute","prefixEndpoint"].map(function(b){return!!a.hasOwnProperty(b)}).filter(function(a){return!1===a}).length}function g(){i={successRoute:h.successRoute,prefixEndpoint:h.prefixEndpoint,pageName:c.PAGE_NAME_REFUND.REFUND_REQUEST_AUTH_TOKEN,kindTokenTransaction:c.REFUND_AUTHENTICATION_TOKEN_KEY,receiveType:"SMS",dataTransaction:{dadosAceiteDigital:{numeroPropostaParceria:h.numeroPropostaParceria,codigoParceiroComercial:h.codigoParceiroComercial,logAceiteDigital:{dataOcorrencia:d.formatDate(moment().format("L"))._i,sistemaOperacional:b.os+" | "+b.os_version,navegadorInternet:b.browser}}}},a.setDataTransaction(i)}var h=null,i=null;return{set:e,sendDataToken:g}}a.$inject=["authTokenFactory","deviceDetector","refundConstant","refundUtilsFactory"],angular.module("internetBanking.refund").factory("authenticationTokenRefundFactory",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(b,c){var d=c||a.current.url;h.customPageView({pageName:b,url:d})}function k(a){var a={reembolso:{status:a.status||"",valorReembolso:a.valorReembolso||"",formaPagamento:a.formaPagamento||"",tipoConta:a.tipoConta||"",bancoReembolso:a.codigoBanco||"",cartaoReembolso:a.cartaoCredito||"",protocoloReembolso:a.numeroProtocolo||"",flPagamentoAutomatico:a.indicadorTermoAutomatico||""},contractedProducts:{contractNumber:a.contractNumber||[]}},b={reembolso:{}};for(var d in a.reembolso)""!==a.reembolso[d]&&(b.reembolso[d]=a.reembolso[d]);console.log("Trigger BVDatalayer >>>",b),document&&document.BVDatalayer&&(angular.merge(document.BVDatalayer.userInfo,b),c.$emit("data-layer-product"))}function l(a){a&&Object.assign(H.userInfo,a)}function m(){return H.userInfo||e.getUserCPF().then(function(a){var b=i.getUserCached();Object.assign(H.userInfo,{numeroCpfCnpj:user.name,phone:b.phone,email:b.email})}),H.userInfo}function n(a){a&&(H.refundAvailable=a)}function o(){return H.refundAvailable}function p(a){return a?I.filter(function(b){if(b.codigoBacen===a)return b})[0]:I}function q(a){I=a}function r(a){H.list=a.list,H.totalAmount=a.totalAmount}function s(a){a&&H.list.map(function(b){(b.numeroContrato=a.numeroContrato)&&(b.installments=a.installments)})}function t(){return{list:H.list,totalAmount:H.totalAmount}}function u(a){a&&(H.informAutomaticTerm=a)}function v(){return H.informAutomaticTerm}function w(a){H.hasOwnProperty("request")||(H.request={}),H.paymentType=a.formaRecebimento,H.conta=a.conta,H.paymentOrder=a.ordemPagamento}function x(a){a&&(H.payment=Object.assign(H.payment,a))}function y(){return H.payment}function z(a){if(a)return J("cc"===a?"@SITE-REEMBOLSO-ACCOUNT-TYPE-CC":"@SITE-REEMBOLSO-ACCOUNT-TYPE-CP")}function A(a){a&&(H.paymentType=a)}function B(){return H.paymentType}function C(){return H.payment.protocol}function D(a){H.payment.protocol=a}function E(){var a={numeroCpfCnpj:H.userInfo.numeroCpfCnpj,codigoSistemaOrigem:g.CHANNEL},b=g.RECEIVEMENT_TYPE[H.paymentType.codigoFormaRecebimento],c=angular.copy(H.payment);if("BANK_TRANSFER"===b){var d=Object.assign(c.conta,{codigoBanco:c.conta.codigoBanco.codigoBacen?parseInt(c.conta.codigoBanco.codigoBacen):parseInt(c.conta.codigoBanco)});a.conta=d}return"PAYMENT_ORDER"===b&&(a.ordemPagamento=c.paymentOrder||c.ordermPagamento),"CREDIT_CARD"===b&&(delete c.cartaoCredito.isHover,a.cartaoCredito=c.cartaoCredito||c.cartaoCredito),a}function F(){H.userInfo={},H.list=[],H.totalAmount="",H.payment={},H.informAutomaticTerm=!1,H.receipt={}}function G(){H.payment={},H.paymentType={}}var H={refundAvailable:!1,list:[],userInfo:{ddd:"",phone:"",numeroCpfCnpj:""},totalAmount:"",payment:{conta:{},cartaoCredito:{},paymentOrder:{}},paymentType:{},informAutomaticTerm:!1},I=[],J=b("translate");return{callCustomPageView:j,callSendEvent:k,setDataUserInfo:l,getDataUserInfo:m,setRefundAvailable:n,getRefundAvailable:o,getBankList:p,setBankList:q,setDataRefundList:r,getDataRefundList:t,setDataRefundDetails:s,setDataRefundRequest:w,setDataRefundAutomaticTerm:u,getDataRefundAutomaticTerm:v,setDataRefundPayment:x,getDataRefundPayment:y,getDataAccountType:z,setDataRefundPaymentType:A,getDataRefundPaymentType:B,getDataRefundProtocol:C,setDataRefundProtocol:D,getDataResume:E,clear:F,clearPayment:G}}a.$inject=["$state","$filter","$rootScope","$stateParams","userService","bankService","refundConstant","dataLayerFactory","userInfoService"],angular.module("internetBanking.refund").factory("refundDataLayerFactory",a)}();