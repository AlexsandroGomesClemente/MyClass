!function(){"use strict";function a(a){function b(a,b,c){}return{link:b,templateUrl:a.ITEM_RENEGOTIATION,replace:!0,transclude:!0,restrict:"E",scope:{contract:"=",list:"=?"}}}a.$inject=["creditTemplateUrls"],angular.module("internetBanking.credit").directive("bvItemRenegotiation",a)}(),function(){"use strict";function a(a){function b(a,b,c){a.loading=!0===a.loading;var d=angular.element(b).parents(".listitem").attr("id").split("-");a.id=d.pop(),a.name=d.join("-")}return{link:b,templateUrl:a.LIST_LINK_TEMPLATE,restrict:"E",trasclude:!0,replace:!0,scope:{arrowText:"@",arrowLabel:"@",linkLabel:"@",translateValues:"@",highlight:"=?",loading:"=?",badgeLabel:"=?"}}}a.$inject=["creditTemplateUrls"],angular.module("internetBanking.credit").directive("bvListLinkTemplate",a)}(),function(){"use strict";function a(a,b,c,d){function e(a,b){switch(i.settled=!1,i.isFriendlyDelay=!1,i.isPendingBills=!1,a){case 0:i.settled=!0;break;case d.PAID.code:break;case d.LATEPAYMENT.code:f(b),i.billsAmount=1,i.isFriendlyDelay=!0;break;case d.OVERDUE.code:f(b),i.isFriendlyDelay=!0,i.isPendingBills=!0;break;case d.OPEN.code:}}function f(c){a.getInstallmentsHistory(c).then(function(a){var c=b.APIToViewModel(a.data);return i.billsAmount=g(c),g(c)})}function g(a){return c.getTotalLateInstallmentsLength(a)?c.getTotalLateInstallmentsLength(a):0}function h(){i.isStatement=!0}var i={settled:!1,isFriendlyDelay:!1,isPendingBills:!1,billsAmount:0,isAcquittance:!1};return{applyPaymentSituationCode:e,getTotalOfLateInstallments:f,product:i,getBillsAmount:g,checkStatement:h}}a.$inject=["installmentsHistoryService","installmentsFactory","creditInstallmentsFactory","installmentsStatus"],angular.module("internetBanking.credit").service("creditProductsService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.OBTAIN_PDF_DECLARATION_OF_DISCHARGE+"/"+e,cache:!0,headers:{accept:"application/pdf"},responseType:"arraybuffer",transformResponse:function(a){var b,c=!!document.documentMode;return c?a:(a&&(b=new Blob([a],{type:"application/pdf"})),b)}};return c(i).then(f).catch(g),h.promise}return{get:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("declarationOfDischargeService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"GET",url:a.backEnd+b.OBTAIN_PDF_DEMONSTRATIVE_VALUE+"/"+e,cache:!0,headers:{accept:"application/pdf"},responseType:"arraybuffer",transformResponse:function(a){var b,c=!!document.documentMode;return c?a:(a&&(b=new Blob([a],{type:"application/pdf"})),b)}};return c(i).then(f).catch(g),h.promise}return{get:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("demonstrativeValueService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=c.defer(),i={method:"GET",url:a.backEnd+d.OBTAIN_ADVISORY_DATA+"/"+e};return b(i).then(f).catch(g),h.promise}return{get:e}}a.$inject=["appSettings","$http","$q","endPoints"],angular.module("internetBanking.credit").service("obtainAdvisoryDataService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.CREDIT_OBTAIN_DATA_BILLET+"/"+e,cache:!1};return c(i).then(f).catch(g),h.promise}return{seachBilletOpen:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("billetOpenService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.CREDIT_SEND_BILLET_EMAIL,data:{codigoContrato:e.contractNumber,parcelas:e.installments,valor:e.installmentValue,enderecoEletronicoPessoa:e.email,idEnderecoEletronicoPessoa:e.id,dataVencimento:e.dueDate}};return c(i).then(f).catch(g),h.promise}return{send:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("sendBilletEmailService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.CREDIT_SIMULATE_ONLY_FINANCING_BILLET,data:{numeroContrato:e.contractNumber,parcelas:e.installments,dataVencimento:e.dateDue}};return c(i).then(f).catch(g),h.promise}return{searchDataSimulate:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("simulateBilletDelayService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}e.tipoEntrada="S";var h=d.defer(),i={method:"POST",url:a.backEnd+b.SIMULATE_BILLET_FINANCING_ACCORD,data:e,cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{post:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("simulateBilletFinancingAccordService",a)}(),function(){"use strict";function a(){function a(){e={contractValues:null,contractData:null,dueDate:null,currentBillet:null,installmentsActive:null}}function b(a,b){e[a]=b}function c(a){return e[a]}function d(){a()}var e={};return a(),{contractValues:e.contractValues,currentBillet:e.contractData,dueDate:e.dueDate,contractData:e.currentBillet,set:b,get:c,reset:d}}angular.module("internetBanking.credit").service("billetAcquittanceValueCurrentService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.CREDIT_OBTAIN_DATA_BILLET,data:e,cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}function f(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.CREDIT_OBTAIN_DATA_CARNET,data:e,cache:!1,timeout:1e5};return c(i).then(f).catch(g),h.promise}return{post:f,postBillet:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("obtainDataBilletService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){i.resolve(a)}function h(a){g+=1,i.reject(a)}var i=d.defer(),j={method:"POST",url:a.backEnd+b.OBTAIN_DATA_BILLET_ACCORD,data:e,cache:!1,timeout:1e5};return c(j).then(f).catch(h),i.promise}function f(){return g}var g=0;return{post:e,getErrors:f}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("obtainDataBilletAccordService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.CREDIT_ISSUE_SINGLE_BILLET,data:e};return c(i).then(f).catch(g),h.promise}return{issue:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("issueSingleBilletService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(f,g){function h(a){j.resolve(a)}function i(a){j.reject(a)}var j=d.defer(),k="/"+f+"/"+g,l={method:"GET",cache:!1,url:a.backEnd+b.CREDIT_GET_PDF+k,timeout:1e5,headers:{accept:"application/pdf"},responseType:"arraybuffer",transformResponse:function(a){return e.IS_IE?a:new Blob([a],{type:"application/pdf"})}};return c(l).then(h).catch(i),j.promise}return{getPDF:g}}a.$inject=["appSettings","endPoints","$http","$q","commonConstants","$rootScope"],angular.module("internetBanking.credit").service("getPDFCreditService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function g(a){i.resolve(a)}function h(a){i.reject(a)}var i=d.defer(),j={method:"POST",url:a.backEnd+b.DIGITAL_BILL,data:{email:e}};return f(e),c(j).then(g).catch(h),i.promise}function f(a){h=a}function g(){return h}var h="";return{registryEmail:e,setCacheEmail:f,getCacheEmail:g}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("digitalBillService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.INSURANCE_REFUND_BANK_DATA,data:e};return c(i).then(f).catch(g),h.promise}function f(e){function f(a){i.resolve(a)}function g(a){i.reject(a)}var h=a.backEnd+b.INSURANCE_REFUND+"/"+e,i=d.defer();return c({method:"GET",cache:!1,url:h}).then(f).catch(g),i.promise}function g(a){i=a}function h(){return i}var i={numeroContrato:"",numeroBanco:"",tipoConta:"",numeroAgencia:"",numeroConta:""};return{sendBankData:e,checkInsuranceLender:f,isInsuranceLender:!1,setDataBank:g,getDataBank:h}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("insuranceRefundService",a)}(),function(){"use strict";function a(a,b,c,d){function e(e){function f(a){h.resolve(a)}function g(a){h.reject(a)}var h=d.defer(),i={method:"POST",url:a.backEnd+b.LOAN_CONTRACT_CANCEL+"/"+e,cache:!1};return c(i).then(f).catch(g),h.promise}return{post:e}}a.$inject=["appSettings","endPoints","$http","$q"],angular.module("internetBanking.credit").service("contractCancelService",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(d){var e={method:"GET",cache:!1,url:a.backEnd+c.RENEG_GET_CONSULTAR+"?contrato="+d};return b(e)}function g(d){var e={method:"GET",cache:!1,url:a.backEnd+c.RENEG_GET_CONSULTAR+"?refresh=true&contrato="+d};return b(e)}function h(d){var e={method:"POST",cache:!1,data:d,url:a.backEnd+c.RENEG_POST_SIMULACAO};return b(e)}function i(d){var e={method:"GET",cache:!1,url:a.backEnd+c.RENEG_GET_ELEGIBILIDADE+"?contrato="+d,timeout:1e5};return b(e)}function j(d){var e={method:"POST",cache:!1,data:d,url:a.backEnd+c.RENEG_POST_GRAVAR,timeout:1e5};return b(e).then(function(a){return l.removeAll(),a})}function k(a){if(!a)return Promise.resolve(null);var b=f(a).then(function(b){var c=d.formatConsult(b.data).contractStatusList;return c&&c.filter(function(b){return b.contractNumber===a})});return Promise.all([b]).then(function(a){return a[0]&&a[0].length>0?a[0][0]:a[0]})}var l=e.get("renegotiation")||e.createCache("renegotiation");return{search:f,refresh:g,simulate:h,getElegibility:i,save:j,getContractStatus:k}}a.$inject=["appSettings","$http","endPoints","renegotiationFactory","CacheFactory"],angular.module("internetBanking.credit").service("renegotiationService",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b,c){y=b,z=g.getOpenInstallments(y),A=g.getOverdueInstallments(y),B=z.concat(A),C=s(B),D.category=k.getCurrentProduct().data.category||"",D.productName=k.getCurrentProduct().data.title||"",D.contractNumber=a}function o(a,b,c){var d,e=i.formatInstallmentsParam(b);return n(a,b,c),d=l.post(a,e,c),d.then(q).catch(r),d}function p(a,b,c){var d=l.post(a,b,c);return d.then(q).catch(r),d}function q(a){var b=j.APIToViewModel(a),c=t(b,C),d=u(y.map(function(a){return{installmentNumber:a.installmentNumber}})),e=!1,f=[],g=0;d.forEach(function(a,b,c){var d=a.installmentNumber,h=c.length===b+1;if(c.length>=b+1){var i=!h&&c[b+1].installmentNumber;f.hasOwnProperty("installmentGroup"+g)?f["installmentGroup"+g].push(d):(f["installmentGroup"+g]=[],f["installmentGroup"+g].push(d)),h||d+1===i||(g++,e=!0)}});var i="";for(var k in f){var l=!!f[k]&&f[k];if(l){if(1===l.length){i=i.concat(l[0]+", ");continue}i=i.concat(l[0]+" a "+l[l.length-1]+", ")}}var n={installmentNumber:d,labelBilletView:"Quitação de contrato",installment:{installmentValue:C}};h.set(n),m.set("isAcquittance",!0),m.set("contractValues",b),m.set("currentBillet",n),m.set("dueDate",new Date),m.set("contractData",w()),m.set("installmentsActive",c),m.set("total",b.totalBilletValue),m.set("formattedOverDueDate",new Date),x()}function r(a){console.error("Ocorreu um erro na simulação do adiantamento de parcela/quitaçlão de contrato",a)}function s(a){return a.reduce(function(a,b){return a+b.installmentValue},0)}function t(a,b){for(var c=[{label:"Parcela",value:b,disclaimerNumber:!1}],d=["fineTotalValue","arrearsTotalValue","discountsTotalValue","notificationTotalValue"],e=0;e<d.length;e++)c.push({label:a[d[e]].label,value:a[d[e]].value,disclaimerNumber:!0});return c}function u(a){return a.sort(function(a,b){var c=a.installmentNumber>b.installmentNumber?1:0;return a.installmentNumber<b.installmentNumber?-1:c})}function v(a){D=a}function w(){return D}function x(){switch(a.current.name){case c.HOME:a.go(b.FINANCING_ACQUITTANCE_DUE_DATE);break;case e.HOME:a.go(b.LEASING_ACQUITTANCE_DUE_DATE);break;case d.HOME:a.go(b.PERSONAL_ACQUITTANCE_DUE_DATE);break;case f.HOME:a.go(b.PAYROLL_ACQUITTANCE_DUE_DATE)}}var y,z,A,B,C,D={};return{simulate:p,setContractData:v,acquittanceContract:o}}a.$inject=["$state","acquittanceRoutes","financingRoutes","personalCreditRoutes","leasingRoutes","payrollRoutes","anticipateInstallmentFactory","currentBilletDataService","installmentsParamFactory","simulateOnlyFinancingBilletFactory","productDetailService","simulateOnlyFinancingBilletService","billetAcquittanceValueCurrentService"],angular.module("internetBanking.credit").factory("antecipateInstallmentsFactory",a)}(),function(){"use strict";function a(){function a(a){return a[a.length-1]}function b(a){return _.filter(a,function(a){return 3===a.situation.code}).length}function c(a,b){var c={friendlyDelay:_.filter(a,function(a){return 3===a.situation.code&&3!==b&&!1==!!a.paymentDate}).shift(),assessory:_.filter(a,function(a){return a.numberDaysDelay>15&&3===b})};return c.friendlyDelay&&(c.friendlyDelay.isFriendlyDelay=!0),c}return{getLatestInstallmentFromList:a,getTotalLateInstallmentsLength:b,getTypeOfLateInstallments:c}}angular.module("internetBanking.credit").factory("creditInstallmentsFactory",a)}(),function(){"use strict";function a(){function a(a){return a.map(function(a){return{numeroParcela:a.installmentNumber}})}function b(a){return{installment:{value:a.installmentValue,label:"Parcela"},fine:{value:a.fineValue,label:"Multa"},arrears:{value:a.arrearsValue,label:"Mora"},notification:{value:a.notificationValue,label:"Notificação"},total:{value:a.totalBilletValue||a.notificationValue+a.arrearsValue+a.fineValue+a.installmentValue}}}return{formatInstallmentsParam:a,formatInstallmentReceipt:b}}angular.module("internetBanking.credit").factory("installmentsParamFactory",a)}(),function(){"use strict";function a(){function a(a){return{codeBar:a.codigoDeBarras,hashCode:a.codigoHash,processingDate:moment(a.dataProcessamento).format("DD/MM/YY HH:mm"),token:a.tokenBoleto,notificationBillet:{code:a.notificacaoBoleto&&a.notificacaoBoleto.codigoRetorno,message:a.notificacaoBoleto&&a.notificacaoBoleto.mensagemRetorno},divergentBilletValue:a.valorBoletoDivergente}}function b(a,b){return{numeroContrato:a.installments[0].code,valor:a.totalBilletValue,dataVencimento:moment(b).utc().format("YYYY-MM-DD"),tipoCanal:"S",tipoAcordo:a.accordType,listaParcelas:a.installments.map(function(a){return{codigoContrato:a.code,sequenciaContrato:a.sequence,numeroParcela:a.installmentNumber,composicaoParcela:{valorParcela:a.installmentComposition&&a.installmentComposition.installmentValue||a.principalValue,valorJuros:a.installmentComposition&&a.installmentComposition.interestValue||0},dataVencimento:moment(a.dueDate.date).utc().format("YYYY-MM-DD"),valorParcela:a.installmentValue,valorPrincipal:a.principalValue,valorJuros:a.interestValue,valorMulta:a.fineValue,valorMora:a.moraValue,valorDesconto:a.discountValue,valorHonorario:a.honoraryValue,valorCustasJudiciais:a.courtCostsValue,valorDescontoMultaLimite:a.fineDiscountLimitValue,valorDescontoMoraLimite:a.moraDiscountLimitValue,valorDescontoParcelaLimite:a.installmentDiscountLimitValue,valorDescontoSeguroPrestamista:a.valorDescontoSeguroPrestamista,diasAtraso:a.datesDelay}})}}return{format:a,formatRequest:b}}angular.module("internetBanking.credit").factory("obtainDataBilletAccordFactory",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a){r=a}function l(){return r}function m(){return r=null,!0}function n(b){function e(a){var b;b=d.IS_IE?new Blob([a.data]):URL.createObjectURL(a.data),k({data:b,response:a}),h.resolve({data:b,response:a})}function f(a){var d=[b,"declarationOfDischargeService.get",a&&a.data&&a.data.messages];c.error(d.join(" - ")),h.reject(a)}var h=a.defer();return g.get(b).then(e).catch(f),h.promise}function o(c,f){var g=a.defer(),i=[];return d.IS_IE?(h.saveAs(c.data,"declaração-anual-"+s+".pdf"),g.resolve({hasPopupBlocked:!1})):b(function(){var a=0;f.location=c.data,i.push({tela:f}),null!==i[i.length-1].tela&&angular.forEach(i,function(b){null!==b.tela&&(a+=b.tela.closed?0:1)}),g.resolve({hasPopupBlocked:!1})},500),e.sendEvent({ID:q()}),g.promise}function p(c,f){var g=a.defer(),i=[];return d.IS_IE?(h.saveAs(c.data,"declaração-IR-"+s+".pdf"),g.resolve({hasPopupBlocked:!1})):b(function(){var a=0;f.location=c.data,i.push({tela:f}),null!==i[i.length-1].tela&&angular.forEach(i,function(b){null!==b.tela&&(a+=b.tela.closed?0:1)}),g.resolve({hasPopupBlocked:!1})},500),e.sendEvent({ID:q()}),g.promise}function q(){var a=j.getCurrentProduct().data.productCode,b=f.BVF.ANNUAL_DEBT_ACQUITTANCE_STATEMENT.FINANCING;return a===i.personalCredit?b=f.BVF.ANNUAL_DEBT_ACQUITTANCE_STATEMENT.CREDIT:a===i.payroll&&(b=f.BVF.ANNUAL_DEBT_ACQUITTANCE_STATEMENT.PAYROLL),b}var r,s=Math.floor(999001*Math.random())+999;return{setCached:k,getCached:l,reset:m,generatePdf:n,generatePdfSuccess:o,generateIRPdf:p}}a.$inject=["$q","$timeout","bvLogService","commonConstants","dataLayerFactory","dataLayerSendEventCode","declarationOfDischargeService","FileSaver","mainProductCodes","productDetailService"],angular.module("internetBanking.credit").factory("pdfDeclarationFactory",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a){q=a}function l(){return q}function m(){return q=null,!0}function n(b){function e(a){var b;b=d.IS_IE?new Blob([a.data]):URL.createObjectURL(a.data),k({data:b,response:a}),g.resolve({data:b,response:a})}function f(a){var d=[b,"demonstrativeValueService.get",a&&a.data&&a.data.messages];c.error(d.join(" - ")),g.reject(a)}var g=a.defer();return h.get(b).then(e).catch(f),g.promise}function o(c,f){var h=a.defer(),i=[];return d.IS_IE?(g.saveAs(c.data,"demonstrativo-valores-"+r+".pdf"),h.resolve({hasPopupBlocked:!1})):b(function(){var a=0;f.location=c.data,i.push({tela:f}),null!==i[i.length-1].tela&&angular.forEach(i,function(b){null!==b.tela&&(a+=b.tela.closed?0:1)}),h.resolve({hasPopupBlocked:!1})},500),e.sendEvent({ID:p()}),h.promise}function p(){var a=i.getCurrentProduct().data.productCode,b=f.BVF.CREDIT_OPERATION_VALUES.FINANCING;return a===j.personalCredit?b=f.BVF.CREDIT_OPERATION_VALUES.CREDIT:a===j.payroll&&(b=f.BVF.CREDIT_OPERATION_VALUES.PAYROLL),b}var q,r=Math.floor(999001*Math.random())+999;return{setCached:k,getCached:l,reset:m,generatePdf:n,generatePdfSuccess:o}}a.$inject=["$q","$timeout","bvLogService","commonConstants","dataLayerFactory","dataLayerSendEventCode","FileSaver","demonstrativeValueService","productDetailService","mainProductCodes"],angular.module("internetBanking.credit").factory("pdfDemonstrativeFactory",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a){r=a}function l(){return r}function m(){return r=null,!0}function n(b){function e(a){var b;b=d.IS_IE?new Blob([a.data]):URL.createObjectURL(a.data),k({data:b,response:a}),g.resolve({data:b,response:a})}function f(a){var d=[b.hash,b.type,"getPDFCreditService.getPDF",a&&a.data&&a.data.messages];c.error(d.join(" - ")),g.reject(a)}var g=a.defer();return h.getPDF(b.type,b.hash).then(e).catch(f),g.promise}function o(c,f){var h=a.defer(),i=[];return c.pdfFromFLexContract&&(c.data=base64ToBlob(c.pdfFromFLexContract)),d.IS_IE?(g.saveAs(c.data,"segunda-via-carne-"+s+".pdf"),h.resolve({hasPopupBlocked:!1})):b(function(){var a=0;f.location=c.data,i.push({tela:f}),null!==i[i.length-1].tela&&angular.forEach(i,function(b){null!==b.tela&&(a+=b.tela.closed?0:1)}),h.resolve({hasPopupBlocked:!1})},500),e.sendEvent({ID:q()}),h.promise}function p(b,c){function f(a){function b(a){for(var b=atob(a),c=[],d="application/pdf",e=512,f=0;f<b.length;f+=e){for(var g=b.slice(f,f+e),h=new Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Uint8Array(h);c.push(j)}return new Blob(c,{type:d})}return b(a)}var h=a.defer();if(d.IS_IE){var i=new Blob([f(b)]);g.saveAs(i,"segunda-via-carne-"+s+".pdf"),h.resolve({hasPopupBlocked:!1})}else{var j=URL.createObjectURL(f(b)),k=0,l=[];c.location=j,l.push({tela:c}),l[l.length-1].tela&&angular.forEach(l,function(a){null!==a.tela&&(k+=a.tela.closed?0:1)}),h.resolve({hasPopupBlocked:!1})}return e.sendEvent({ID:q()}),h.promise}function q(){var a=j.getCurrentProduct().data.productCode,b=f.BVF.SECOND_WAY.FINANCING;return a===i.personalCredit?b=f.BVF.SECOND_WAY.CREDIT:a===i.payroll&&(b=f.BVF.SECOND_WAY.PAYROLL),b}var r,s=Math.floor(999001*Math.random())+999;return{setCached:k,getCached:l,reset:m,generatePdf:n,generatePdfSuccess:o,generatePdfForFlexContract:p}}a.$inject=["$q","$timeout","bvLogService","commonConstants","dataLayerFactory","dataLayerSendEventCode","FileSaver","getPDFCreditService","mainProductCodes","productDetailService"],angular.module("internetBanking.credit").factory("pdfSecondWayFactory",a)}(),function(){"use strict";function a(a,b){function c(a){return{contractStatusList:a&&a.contratos&&a.contratos[0]&&a.contratos[0].contrato.map(function(a){return{contractNumber:parseInt(a.numeroContrato),statusCode:a.codigoStatus,statusDescription:a.descricaoStatus,flActive:a.flAtivo,installmentsQuantity:a.quantidadeParcelas,installmentValue:a.valorPrestacao,nextDueDate:moment(a.dataPrimeiroVencimento).format("DD/MM/YYYY"),renegotiationTax:a.taxaRenegociacao,protocolNumber:a.numeroProtocolo}})}}function d(a){return a&&a.listaContratos.map(function(a){return{codigoRetorno:a.codigoRetorno,descricaoRetorno:a.descricaoRetorno,contrato:a.contrato,sequenciaContrato:a.sequenciaContrato,carenciaMin:a.carenciaMin,carenciaMax:a.carenciaMax,prazoMin:a.prazoMin,prazoMax:a.prazoMax,dataCarenciaMin:a.dataCarenciaMin,dataCarenciaMax:a.dataCarenciaMax,dataBaseCarencia:a.dataBaseCarencia,dataVenciPagEntrada:a.dataVenciPagEntrada,listaParcelasEntrada:a.listaParcelasEntrada,valorFinanciado:a.valorFinanciado,valorSaldoDevedor:a.valorSaldoDevedor,numeroMesesProximaReneg:a.numeroMesesProximaReneg,listaOfertasSugeridas:a.listaOfertasSugeridas.map(function(a){return{dataPrimeiroVencimento:a.dataPrimeiroVencimento,carencia:a.carencia,valorSaldoRenegociar:a.valorSaldoRenegociar,valorMora:a.valorMora,valorMulta:a.valorMulta,valorPrincipal:a.valorPrincipal,valorDescontoMora:a.valorDescontoMora,valorDescontoMulta:a.valorDescontoMulta,valorDescontoPrincipal:a.valorDescontoPrincipal,SLAEfetivacao:a.SLAEfetivacao,descricao:a.descricao,listaCalculos:a.listaCalculos.map(function(a){return{idOfertaSimulacao:a.idOfertaSimulacao,prazo:a.prazo,valorTotalRenegociado:a.valorTotalRenegociado,taxaJurosDaOperacao:a.taxaJurosDaOperacao,taxaCET:a.taxaCET,taxaCETAnualizada:a.taxaCETAnualizada,valorIOF:a.valorIOF,valorParcela:a.valorParcela,coeficiente:a.coeficiente}})}})}})}function e(a){return{dataPrimeiroVencimento:a.dataPrimeiroVencimento,valorSaldoRenegociar:a.valorSaldoRenegociar,valorMora:a.valorMora,valorMulta:a.valorMulta,valorPrincipal:a.valorPrincipal,valorDescontoMora:a.valorDescontoMora,valorDescontoMulta:a.valorDescontoMulta,valorDescontoPrincipal:a.valorDescontoPrincipal,SLAEfetivacao:a.SLAEfetivacao,descricao:a.descricao,aliquotaiof:{aliquota:a.aliquotaiof.aliquota,aliquotamaxima:a.aliquotaiof.aliquotamaxima,aliquotaexcedente:a.aliquotaiof.aliquotaexcedente},listaCalculos:a.listaCalculos.map(function(a){return{idOfertaSimulacao:a.idOfertaSimulacao,prazo:a.prazo,taxaRenegociacao:a.taxaRenegociacao,taxaJurosDaOperacao:a.taxaJurosDaOperacao,taxaCET:a.taxaCET,taxaCETAnualizada:a.taxaCETAnualizada,valorIOF:a.valorIOF,valorTotalRenegociado:a.valorTotalRenegociado,valorParcela:a.valorParcela,coeficiente:a.coeficiente}})}}function f(a){return{dataVencimentoEntrada:a&&a.dataVenciPagEntrada,contrato:a&&a.contrato,email:a&&a.idEmail,celular:a&&a.idPhone,nomeUsuario:a&&a.nomeUsuario||"",idOfertaSimulacao:a&&a.idOfertaSimulacao}}function g(a,b){return{contrato:a.contrato||a.numeroContrato||a.contractNumber,carencia:b.carencia||a.carencia||0,prazoMin:b.prazoMin||a.prazoMin,prazoMax:b.prazoMax||a.prazoMax}}function h(a,c){return a.map(function(a){var d=_.find(c,{contractNumber:parseInt(a.contractNumber)});if(angular.merge(a,d||{}),a.statusCode){a.steps=b.getCurrent({current:a.statusCode});var e=_.findLast(a.steps,{complete:!0});a.statusDescription=e&&e.text}}),a}return{formatConsult:c,formatElegibility:d,formatSimulate:e,formatRequestSave:f,formatRequestSimulate:g,join:h}}a.$inject=["$filter","renegotiationStepsFactory"],angular.module("internetBanking.credit").factory("renegotiationFactory",a)}(),function(){"use strict";function a(){function a(a){var c=angular.copy(b);if(a&&a.current)for(var d=0;d<a.current;d++)c[d]&&(c[d].complete=!0);return c}var b=[{label:"Condições escolhidas",text:"Em breve você receberá um e-mail de nosso parceiro Clicksign, explicando como fazer a assinatura eletrônica de seu contrato para realizar seu pedido. Lembre-se, você tem 24 horas para assinar, senão terá que iniciar sua renegociação novamente.",complete:!1},{label:"Contrato enviado pela ClickSign",text:"Você recebeu um email da ClickSign explicando como fazer a assinatura eletrônica de seu contrato com as novas condições. Você tem 24 horas para realizar sua assinatura.",complete:!1},{label:"Contrato assinado na ClickSign",text:"Recebemos a confirmação da ClickSign que você assinou seu contrato. Seu pedido já foi realizado! Em até 10 dias úteis você terá suas condições de contrato atualizadas por aqui.",complete:!1},{label:"Contrato renegociado",text:"Pronto! Seu contrato foi renegociado e atualizado com as novas condições escolhidas.",complete:!1},{text:"Cancelada por prazo.",hidden:!0},{text:"Verificamos que você começou uma renegociação desse contrato em outro canal. Por gentileza, finalize seu pedido por lá.",hidden:!0}];return{getCurrent:a}}angular.module("internetBanking.credit").service("renegotiationStepsFactory",a)}(),function(){"use strict";function a(a){function b(b,c){function d(a){return a.indexOf(b)>-1}var e={isAssessory:d([a.ASSESSORIA]),isCededBB:d([a.CESSAO_BB]),isBlockedBillet:d([a.SUSPENSO,a.FRAUDE,a.RENEGOCIACAO_LEASING,a.LEASING_TRANSFERIDO]),isBlocked:d([a.EM_BNDU,a.CESSAO_BB,a.AVISO_SALDO,a.ENTREGA_AMIGAVEL,a.CANCELADO,a.CEDIDO_CARTEIRA_PODRE]),isSettled:d([a.QUITADO]),isOpened:d([a.EM_ABERTO,a.EM_ATRASO]),isNegociableAssessory:d([a.ASSESSORIA_ACORDO_BV]),isDigitalBilling:c&&c.productCode>=12&&d([a.ASSESSORIA_ACORDO_BV,a.CONTRATO_16_30_SEM_ASSESSORIA_SITE_BV]),isFriendlyDelay:d([a.CONTRATO_16_30_SEM_ASSESSORIA_SITE_BV])};return Object.freeze(e)}return{mapsPaymentSituation:b}}a.$inject=["financialSituationCode"],angular.module("internetBanking.credit").factory("rulesAccessFactory",a)}(),function(){"use strict";function a(a){function b(a){return{totalBilletValue:a.valorTotalBoleto,fineValue:a.valorMulta,moraFee:a.valorMora,notificationFee:a.valorNotificacao,judicialCosts:a.valorCustasJudiciais,discountValue:a.valorDesconto,discountParcel:a.valorTotalDesagio,chargesFee:a.valorEncargos,totalDiscountFine:a.valorTotalDescontoMulta,totalDiscountMora:a.valorTotalDescontoMora,totalDiscountInstallment:a.valorTotalDescontoParcela,totalDebtAmount:a.valorTotalDivida,totalValueParcel:a.valorTotalParcela,accordType:a.tipoAcordo,valorDescontoSeguroPrestamista:a.valorDescontoSeguroPrestamista||a.valorTotalDescontoSeguroPrestamista||0,installments:a.listaParcelas&&a.listaParcelas.map(function(a){return{code:a.codigoContrato,installmentComposition:{installmentValue:a.composicaoParcela&&a.composicaoParcela.valorParcela||0,interestValue:a.composicaoParcela&&a.composicaoParcela.valorJuros||0},sequence:a.sequenciaContrato,installmentNumber:a.numeroParcela,dueDate:a.dataVencimento,installmentValue:a.valorParcela,principalValue:a.valorPrincipal,interestValue:a.valorJuros,fineValue:a.valorMulta,moraValue:a.valorMora,debtAmount:a.valorDivida,discountValue:a.valorDesconto,honoraryValue:a.valorHonorario,courtCostsValue:a.valorCustasJudiciais,fineDiscountLimitValue:a.valorDescontoMultaLimite,moraDiscountLimitValue:a.valorDescontoMoraLimite,installmentDiscountLimitValue:a.valorDescontoParcelaLimite,datesDelay:a.diasAtraso,valorDescontoSeguroPrestamista:a.valorDescontoSeguroPrestamista||0}})}}function c(b){return{numeroContrato:b.contractNumber,parcelas:b.installments,dataVencimento:b.dueDate,codigoSituacaoFinanceira:a.ASSESSORIA_ACORDO_BV}}function d(a){switch(a){case"Q":return"quitacao";case"P":return"parcela";case"A":return"atualizacao"}return""}return{format:b,formatRequest:c,translateAccordType:d}}a.$inject=["financialSituationCode"],angular.module("internetBanking.credit").factory("simulateBilletFinancingAccordFactory",a)}(),function(){"use strict";function a(a,b){var c={};return angular.extend(c,a.createFactory(b)),c}a.$inject=["baseFactory","billetAcquittanceDataKeys"],angular.module("internetBanking.credit").factory("billetAcquittanceDataFactory",a)}(),function(){"use strict";function a(){function a(a){c=a}function b(){return c}var c={};return{setDetails:a,getDetails:b}}angular.module("internetBanking.credit").service("contractCancelFactory",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,aa){function ba(){y.setInternalPage(!1),H.reset(),e.showError||ea(),b.$emit("scroll-top"),na();var a=I.getCurrentProduct();o.setDetails(a.productDetail),Oa.contractData=a.productDetail,angular.merge(Oa.contractData,a.data),Oa.overDueInstallments=_.where(Oa.contract.listInstallments,{situation:{code:3}}),Oa.installmentsFormat={overDueInstallments:Oa.overDueInstallments.length},Oa.delayedInstallments=_.filter(Oa.overDueInstallments,function(a){if(a.numberDaysDelay>=5&&a.numberDaysDelay<=15)return a}),!Oa.contract.accessRules.isAssessory&&!document.BVDatalayer.pageInfo["fique-em-dia"]&&Oa.contract.accessRules.isNegociableAssessory&&Oa.overDueInstallments.length>0&&document&&document.BVDatalayer&&angular.merge(document.BVDatalayer.pageInfo,{"fique-em-dia":!0});try{"creditopravoce"===b.sessionPage&&console.log("creditopravoce ==> "),"boleto"===b.sessionPage&&(b.sessionPageShowed||ca(),b.sessionPageShowed=!0,document.BVDatalayer.pageInfo["fique-em-dia"]=!0,$("#campaign-bval249-modal").remove())}catch(f){}Oa.contract.accessRules.isAssessory||document.BVDatalayer.pageInfo["fique-em-dia"]||!Oa.contract.chargeType.CARNE||!Oa.contract.accessRules.isDigitalBilling&&!Oa.contract.accessRules.isOpened||(Oa.delayedInstallments.length>0||Oa.contract.accessRules.isDigitalBilling&&Oa.overDueInstallments.length>0)&&(document&&document.BVDatalayer&&angular.merge(document.BVDatalayer.pageInfo,{"fique-em-dia":!0}),Oa.contract.accessRules.isDigitalBilling&&!Oa.contract.accessRules.isFriendlyDelay&&ua(!0)),c.$watch(function(){Oa.assessoryCompaniesList=b.assessoryCompaniesList}),Ka(),da(),s.addDataLayerEvent({actionField:"step-visualizou-home",page:"home"}),k.reset(),F.reset(),G.reset(),Oa.isRenegotiationEligible=!1,Oa.hasRenegotiationInProgress=!1,Oa.statusRenegotiation=null,delete b.tapumeRenegotiationCached,delete b.renegInputBillet,delete b.renegInputPage,Y.getContractStatus(a.productDetail.contractNumber).then(function(a){function b(a){return[5,7,8,9,11,15,16].indexOf(a)>-1}function c(a){var b="reneg-modal-"+a+"-"+document.BVDatalayer.userInfo.profile.visitorId;return!!localStorage.getItem(b,!0)}if(a){if(Oa.isRenegotiationEligible=!0,a.statusCode>0&&4!==a.statusCode)if(b(a.statusCode)){if(c(a.statusCode))return;d.go(O.RENEGOTIATION_STATUS)}else Oa.hasRenegotiationInProgress=!0,d.go(O.RENEGOTIATION_STATUS)
;4===a.statusCode?Oa.statusRenegotiation="Contrato renegociado!":Oa.statusRenegotiation=""}})}function ca(){b.$emit(R.SPINNING_START);var a=4,c=_.where(Oa.contract.listInstallments,{situation:{code:a}}),e=[];c.length&&e.push(c[0]),Oa.selectedDate=new Date,(Oa.contract.overDueInstallments.length||e.length)&&d.go(O.BILLET_DIGITAL_BILLING,{installments:Oa.contract.overDueInstallments||e,selectedDate:Oa.selectedDate,autoGenerateBillet:!0,isInsuranceLender:!1,isAntecipate:!1,isAcquittance:!1,page:L.translateAccordType("A")}).then(function(){b.$emit(R.SPINNING_STOP)}).catch(function(){b.$emit(R.SPINNING_STOP)})}function da(){X.getUserCPF().then(function(a){U.setDataUserInfo({numeroCpfCnpj:a.name});var b={numeroCpfCnpj:a.name,codigoSistemaOrigem:W.CHANNEL};T.post(b).then(function(a){Oa.isRefundAvailable=a.data.indicadorReembolsoDisponivel,Oa.hasRefundHistory=a.data.indicadorHistoricoReembolso,Oa.hasAutomaticPayment=a.data.indicadorPagamentoAutomatico,Oa.refundModalStatus=a.data.indicadorExibeModal,U.setRefundAvailable(a.data),Oa.refundModalStatus&&f(function(){Oa.modalRefundConfig.open=!0},3e3)}).catch(function(a){})}).catch(function(a){na(),Oa.modalConfig.open=!0,Oa.modalConfig.error=!0})}function ea(){if(!P||!Q)return!1;Oa.contract={listInstallments:P.listInstallments,overDueInstallments:j.getOverdueInstallments(P.listInstallments),showCancel:document.showLoanCancel||!1,productCode:Q.productCode,isLeasing:angular.equals(Q.productCode,z.leasing),isCredit:angular.equals(Q.productCode,z.personalCredit),isPayroll:angular.equals(Q.productCode,z.payroll),isFinancing:angular.equals(Q.productCode,z.vehicleFinancing),settled:!Q.paymentSituationCode,isFriendlyDelay:ja(),installmentsDelayAmount:p.getTotalLateInstallmentsLength(P.listInstallments),accessRules:J.mapsPaymentSituation(Q.paymentSituationCode,{productCode:Q.productCode}),isNewContract:P.firstDueDate&&P.nextDueDate&&angular.equals(P.firstDueDate.value,P.nextDueDate.value),nextDueDate:P.nextDueDate.dateLabel,nextDueDateMonth:u.formatDateMonth(P.nextDueDate.value),chargeType:{CARNE:P&&P.chargeType&&1===P.chargeType.code,CHEQUE:P&&P.chargeType&&2===P.chargeType.code,DESCONTO_EM_FOLHA:P&&P.chargeType&&6===P.chargeType.code,DEBITO_EM_CONTA:P&&P.chargeType&&7===P.chargeType.code},stateParams:{showError:e.showError,errorTitle:e.errorTitle,errorText:e.errorText},hasDemonstrative:!0,hasDeclaration:!0,isEndorsed:P.endorsed||!1,isFraud:"FRAUDE"===P.financialSituationEnum||!1,isCarbonEmissionEligible:aa.isEligible(Q)},Oa.contract.isLatelyANDCarne=Oa.contract.chargeType.CARNE&&Oa.contract.isFriendlyDelay,z.vehicleFinancing!==Oa.contract.productCode&&Oa.contract.accessRules.isNegociableAssessory&&(Oa.contract.isLatelyANDCarne=!0),Oa.homeListInstallments=ia(),r.currentProductRoutes=O,Oa.overDueInstallments=_.where(Oa.contract.listInstallments,{situation:{code:3}}),Oa.contract.hasBilletAvailable=xa(),Oa.contract.translateValues=w.getTranslate(ja(),Oa.contract.overDueInstallments.length,Oa.contract.nextDueDateMonth),Ja()}function fa(){b.$emit("open-carbon-emission-modal")}function ga(){ma(),d.go(V.REFUND_REQUEST_LIST)}function ha(){d.go(V.REFUND_TABS_REQUESTED,{contractNumber:Q.contractNumber})}function ia(){x.setInstallmentStatus(P.listInstallments,Q.paymentSituationCode),!Oa.contract.settled&&P.listInstallments&&(Ia(P.listInstallments),q.set(r.parcelDisposable(P.listInstallments)));var a={justHired:Oa.contract.isNewContract,friendlyDelay:Oa.contract.isFriendlyDelay,settled:Oa.contract.settled,inDay:!0},b={list:P.listInstallments,quantity:3,current:q.get()};return w.get(a,b)}function ja(){return Q.paymentSituationCode===E.EM_ATRASO.code||Q.paymentSituationCode===E.ASSESSORIA.code}function ka(){return!Oa.contract.settled&&Oa.contract.chargeType.CARNE}function la(a){na(),Oa.modalConfig.open=!0,Oa.modalConfig[a]=!0,b.isModal=!0}function ma(){sessionStorage.setItem("refundModalStatus",!0),Oa.modalRefundConfig={open:!1},b.isModal=!1}function na(){Oa.modalConfig={isAssessory:{open:!1,modifierClass:"-is-assessory"},acquittance:!1,antecipate:!1,open:!1,error:!1,demonstrativePDF:!1,declarationPDF:!1,secondWayPDF:!1,secondWayPDFLoading:!1,billet:!1,notAssessory:!1,popup:!1,demonstrativeIR:!1,renegotiatedContract:!1},b.isModal=!1}function oa(){function b(a){var b={type:"carnes",hash:a.data&&a.data.codigoHash,statusCode:a.status,flexContractPdf:a.data&&a.data.pdf?a.data.pdf:""};209!==a.status&&210!==a.status||(b.message=a&&a.data&&a.data.messages[1]),d.resolve(b)}function c(a){var b=Q.contractNumber,c=a&&a.data&&a.data.messages;l.error([b,"erro obtainDataBilletService.post",c].join(" - ")),d.reject(a)}var d=a.defer();return D.post({codigoContrato:Q.contractNumber,parcelas:[{numeroParcela:0}]}).then(b).catch(c),d.promise}function pa(a){var c=t.BVF.SECOND_WAY.SECOND_WAY_ACCESS;if("carne-digital"===a&&(c=t.BVF.SECOND_WAY.DIGITAL_BILLET_ACCESS),s.sendEvent({ID:c}),!ka()||Oa.contract.accessRules.isBlockedBillet)return la("billet");var d=S.nonBlockPopup("Aguarde, seu carnê está sendo gerado..."),e=H.getCached();e?H.generatePdfSuccess(e,d).then(qa):(Oa.loading.secondWay=!0,Oa.modalConfig.open=!0,Oa.modalConfig.secondWayPDFLoading=!0,b.isModal=!0,oa().then(function(a){function c(a){var b=[Q.contractNumber,"pdfSecondWayFactory.generatePdf",a&&a.data&&a.data.messages];l.error(b.join(" - ")),na(),Oa.modalConfig.open=!0,Oa.modalConfig.error=!0}if(209===a.statusCode||210===a.statusCode)return Oa.modalConfig.open=!1,b.isModal=!1,Oa.modalConfig.secondWayPDFLoading=!1,Oa.loading.secondWay=!1,!1;a.flexContractPdf?(Qa=H.generatePdfForFlexContract(a.flexContractPdf,d),Oa.loading.secondWay=!1,na(),Qa.then(qa)):H.generatePdf(a).then(function(a){Qa=H.generatePdfSuccess(a,d)}).catch(c).finally(function(){Oa.loading.secondWay=!1,na(),Qa.then(qa)})}).catch(function(){Oa.loading.secondWay=!1,na(),Oa.modalConfig.open=!0,Oa.modalConfig.error=!0}))}function qa(a){a.hasPopupBlocked&&(b.isModal=!0,Oa.modalConfig.open=!0,Oa.modalConfig.popup=!0,s.sendEvent({ID:"02.02.00.34.03"}))}function ra(){function a(a){var b=[],c=new Date,e=j.getOpenInstallments(P.listInstallments),f=j.getOverdueInstallments(P.listInstallments),g=e.concat(f);return a&&(b=A.APIToViewModel(a),c=moment(b[0].expiryDate).toDate()),d.go(O.BILLET_DIGITAL_BILLING,{installments:g,selectedDate:c||new Date,autoGenerateBillet:!1,isAcquittance:!0,page:L.translateAccordType("Q")})}return Oa.contract.accessRules.isAssessory?ua(!1):(b.$emit(R.SPINNING_START),B.get(Q.contractNumber,P.listInstallments).then(function(b){return a(b&&b.data)}).catch(function(){return a([{dataVencimento:new Date}])}).finally(function(){b.$emit(R.SPINNING_STOP)}))}function sa(){if(Oa.contract.accessRules.isAssessory)return ua(!1);d.go(O.ANTICIPATE_INSTALLMENTS_LIST)}function ta(){d.go(O.AUTHORIZE_DIGITAL_BILL)}function ua(a,c){function d(b){r.assessoryData=i.APIToViewModel(b.data),r.assessoryData.contractNumber=Q.contractNumber,Oa.assessoryData=r.assessoryData,va(c),a||(Oa.modalConfig.isAssessory.open=!0)}function e(){Oa.assessoryData=null,a||(Oa.modalConfig.open=!Oa.modalConfig.open,Oa.modalConfig.notAssessory=!Oa.modalConfig.notAssessory)}C.get(Q.contractNumber).then(d).catch(e).finally(function(){b.isModal=!0})}function va(a){var b="financiamento",c="FINANCING";if(Oa.contract.isCredit?(b="credito pessoal",c="CREDIT"):Oa.contract.isPayroll&&(b="consignado",c="PAYROLL"),a){var d=a.origin&&a.origin.toUpperCase()||"MENUITEM",e=t.BVF.BILLET_BILLING_ASSESSORY[d];s.sendEvent({ID:e,parameters:b})}else s.sendEvent({ID:t.BVF.ASSESSORY[c],parameters:b})}function wa(){return ja()?c.$parent.navigation.permissioning.role.IBBV_BVF_PAGTO_GERACAOBOLETOPAGTOATRASO_SOLICITAR:c.$parent.navigation.permissioning.role.IBBV_BVF_PAGTO_GERACAOBOLETOPAGTODIA_SOLICITAR}function xa(){var a=!1;return!Oa.contract.settled&&wa()&&(Oa.contract.accessRules.isAssessory||Oa.contract.chargeType.CARNE)&&(Oa.contract.accessRules.isBlockedBillet&&!Oa.contractData.nextDueDate||(a=!0)),a}function ya(){if(!Oa.contract.hasDemonstrative)return la("demonstrativePDF"),!1;var a=S.nonBlockPopup("Aguarde, seu demonstrativo está sendo gerado..."),b=G.getCached();b?G.generatePdfSuccess(b,a):(Oa.loading.demonstrative=!0,G.generatePdf(Q.contractNumber).then(function(b){G.generatePdfSuccess(b,a)}).catch(function(){Oa.contract.hasDemonstrative=!1,la("demonstrativePDF")}).finally(function(){Oa.loading.demonstrative=!1}))}function za(){if(!Oa.contract.hasDeclaration)return la("declarationPDF"),!1;var a=S.nonBlockPopup("Aguarde, sua declaração está sendo gerada..."),b=F.getCached();b?F.generatePdfSuccess(b,a):(Oa.loading.declaration=!0,F.generatePdf(Q.contractNumber).then(function(b){F.generatePdfSuccess(b,a)}).catch(function(){Oa.contract.hasDeclaration=!1,la("declarationPDF")}).finally(function(){Oa.loading.declaration=!1}))}function Aa(){Oa.modalConfig.open=!0,Oa.modalConfig.demonstrativeIR=!0,Oa.successDemonstrativeIR=!1,Oa.errorDemonstrativeIR=null;for(var a=[],b=-1;b>=-5;b--)a.push((new Date).getYear()+1900+b);Oa.demonstrativeIR=Oa.demonstrativeIR||{ano:a[0]},Oa.yearDemonstrativeIR=_.map(a,function(a){return{ano:a}})}function Ba(){b.$emit(R.SPINNING_START),Oa.successDemonstrativeIR=!1,Oa.errorDemonstrativeIR=null;var a={contractNumber:Q.contractNumber,ano:parseInt(Oa.demonstrativeIR.ano),email:Oa.demonstrativeIR.email};return M.post(a.contractNumber,a.ano,a.email).then(function(a){a&&a.mensagem&&(a.mensagem.length>4||"200"===a.mensagem)?(Oa.successDemonstrativeIR=!0,Oa.errorDemonstrativeIR=null):Oa.errorDemonstrativeIR="Não há declaração disponível para o período selecionado"}).catch(function(){Oa.errorDemonstrativeIR="Ocorreu um erro no processamento da sua solicitação, tente novamente mais tarde."}).finally(function(){b.$emit(R.SPINNING_STOP)})}function Ca(){return Oa.contract.accessRules.isAssessory?ua(!1):Oa.contract.isFriendlyDelay?Pa(Oa.contract.overDueInstallments[0]):void Fa(q.get())}function Da(a){function c(a){return a=a&&a.toLowerCase(),"antecipate"===a?"ANTECIPATE":"acquittance"===a?"ACQUITTANCE":"maxymiser"===a?"VENDOR":"menuitem"===a?"MENUITEM":"link_negociar"===a?"NEGOCIAR":"OTHERS"}if(Oa.contract.accessRules.isAssessory)return ua(!1);var e,f;e=c(a),f=t.BVF.BILLET_BILLING_OPEN_BUTTON[e];var g="financiamento";Oa.contract.isCredit?g="credito pessoal":Oa.contract.isPayroll&&(g="consignado"),s.sendEvent({ID:f,parameters:g}),["antecipate","acquittance"].indexOf(a)>-1?angular.merge(Oa.modalConfig,{antecipate:!1,acquittance:!1,open:!1}):Oa.contract.accessRules.isFriendlyDelay?Oa.onOpenBilletAvailable("menuitem"):(b.$emit(R.SPINNING_START),d.go(O.BILLET_DIGITAL_BILLING).then(function(){b.$emit(R.SPINNING_STOP)}).catch(function(){b.$emit(R.SPINNING_STOP)}))}function Ea(){b.$emit(R.SPINNING_START),Oa.hasRenegotiationInProgress?d.go(O.RENEGOTIATION_STATUS):d.go(O.RENEGOTIATION_CHOOSE,{contractNumber:Q.contractNumber}).then(function(){b.$emit(R.SPINNING_STOP);try{document.BVDatalayer.formInfo||(document.BVDatalayer.formInfo={}),document.BVDatalayer.formInfo.step=1,document.BVDatalayer.internalCampaign="bv|area-logada|campanha|renegociacao|menu-home",s.customPageView({pageName:"bv|area-logada|campanha|renegociacao|menu-home",url:d.current.url})}catch(a){}}).catch(function(){b.$emit(R.SPINNING_STOP)})}function Fa(a){return Oa.contract.accessRules.isBlockedBillet?Oa.onNotDocumentPDF("billet"):Pa(a)}function Ga(a){g.open(a)}function Ha(a){if(Oa.contract.accessRules.isDigitalBilling){var b=a||"acquittance";return Oa.modalConfig.acquittance=!1,Oa.modalConfig.antecipate=!1,Oa.modalConfig[b]=!0,Oa.modalConfig.open=!0,!1}return!0}function Ia(a){if(a=_.filter(_.where(a,{situation:{code:3}}),function(a){return a.numberDaysDelay>0}),0===a.length)return!1;var b={numeroContrato:Q.contractNumber,parcelas:a.map(function(a){return{numeroParcela:a.installmentNumber}}),dataVencimento:u.format(Oa.selectedDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT"),codigoSituacaoFinanceira:Q.paymentSituationCode};return K.post(b).then(function(a){if(!a||!a.data)return!1;Oa.billetDataSimulated=L.format(a.data);var b=w.get({justHired:Oa.contract.isNewContract,friendlyDelay:Oa.contract.isFriendlyDelay,settled:Oa.contract.settled,inDay:!0},{list:P.listInstallments,quantity:3,current:q.get()});b.forEach(function(a){var b=_.find(Oa.billetDataSimulated.installments,{installmentNumber:a.installmentNumber});b&&b.installmentValue&&(a.totalValue=b.principalValue,a.recalculedValue=!0)}),Oa.homeListInstallments=b})}function Ja(){function a(a){return["QTD","EAB","EAT","ASS","BLQ","BLQ","BLQ","BLQ","BLQ","BLQ","BLQ","BLQ","BLQ","BLQ","ASC","CSA"][a]}function c(a){var b=angular.copy(a);return b.chargeType=_.findKey(b.chargeType,_.partial(_.isEqual,!0)),b.accessRules=_.findKey(b.accessRules,_.partial(_.isEqual,!0)),_.forEach(["stateParams","overDueInstallments","listInstallments","translateValues"],function(a){delete b[a]}),b}var d=_.filter(_.where(I.getCurrentProduct().productDetail.listInstallments,{situation:{code:3}}),function(a){return a.numberDaysDelay>0}),e={overDueInstallments:d&&d.length,numberDaysDelay:d&&d[0]&&d[0].numberDaysDelay||0};if(angular.merge(e,Oa.contract.accessRules),document&&document.BVDatalayer){document.BVDatalayer.pageInfo.account=e;var f={contract:I.getCurrentProduct().data.contractNumber,profile:{status:{type:a(Q.paymentSituationCode),code:Q.paymentSituationCode,days:Oa.homeListInstallments&&Oa.homeListInstallments[0]&&Oa.homeListInstallments[0].numberDaysDelay||0},data:c(Oa.contract)}};angular.merge(document.BVDatalayer.userInfo,f),Ka()}b.$on("data-layer-product",Ka)}function Ka(){var a=_.find(N.getProductsListCached(),{contractNumber:Q.contractNumber});if(!a)return void l.error([Q.contractNumber," erro - usuario nao tem um product"].join(" - "));var b,c=_.findKey(z,_.partial(_.isEqual,a.productCode)),d=a.guaranteesList&&a.guaranteesList[0],e=[a.alias,a.title,a.subtitle].join("; ");if(d&&(b=[d&&d.brand.replace(/^\s+|\s+$/g,""),d&&d.model.replace(/^\s+|\s+$/g,""),d&&d.fabricationYear,d&&d.modelYear].join("; ")),a){var f={category:"Empréstimos",type:a.category,name:La(c),detail:e,guarantees:b||"",status:a.contractStatus&&a.contractStatus.description,initial:moment(a.initDate).utc().format("DD/MM/YYYY"),final:moment(a.endDate).utc().format("DD/MM/YYYY")};document&&document.BVDatalayer&&(document.BVDatalayer.product=f)}}function La(a){return{personalCredit:"Credito Pessoal",payroll:"Consignado",vehicleFinancing:"Financiamento de veiculo",noGuaranteeFinancing:"Financiamento sem garantia",leasing:"Leasing",creditCard:"Cartao de Credito"}[a]}function Ma(a){if(document.BVDatalayer.pageInfo["fique-em-dia"])return!0;na(),Oa.modalConfig.open=!0,Oa.modalDescriptionContent=a.message,Oa.modalDescriptionTitle=a.title||"Fique em dia",Oa.modalDescriptionSubtitle=a.subtitle||"Caso já tenha efetuado o pagamento, desconsidere este aviso.",Oa.modalDescriptionLabelButton=a.label||"Eu quero",Oa.modalDescriptionAnticipation=a.linkAnticipation,s.addDataLayerEvent({actionField:"step-visualizou-ofertas",page:"debts"})}function Na(){d.go(O.ASSESSORY_LIST)}var Oa=this,Pa=q.generateBillet,Qa=!1;Oa.commonUrls=m,Oa.bvfRoute=O,Oa.loading={declaration:!1,demonstrative:!1,secondWay:!1},Oa.hasSecondWay=ka,Oa.hasFriendlyDelayPermissioning=wa,Oa.hasBilletAvailable=xa,Oa.onAcquittanceContract=ra,Oa.onAnnualDeclarationSettledDebits=za,Oa.onAntecipateInstallment=sa,Oa.onDemonstrativeCreditOperationValues=ya,Oa.onExtractAnnualConsolidated=Aa,Oa.getExtractAnnualConsolidated=Ba,Oa.onGenerateInstallmentBillet=Fa,Oa.onOpenBilletAvailable=Ca,Oa.onOpenBilletBilling=Da,Oa.onOpenRenegotiation=Ea,Oa.onOpenSecondWay=pa,Oa.onOpenAssessory=ua,Oa.gotoUrl=Ga,Oa.goToAssessoryPage=Na,Oa.goToRefund=ha,Oa.checkBilletStatus=Ha,Oa.sendOptionsAssessory=va,Oa.onNotDocumentPDF=la,Oa.resetModal=na,Oa.resetRefundModal=ma,Oa.refundQty=null,Oa.hasRefundAvailable=da,Oa.onAuthorizeDigitalBill=ta,Oa.goToRefundPage=ga,Oa.isRefundAvailable=!1,Oa.hasRefundHistory=!1,Oa.hasAutomaticPayment=!1,b.isModal=!1,Oa.refundModalStatus=sessionStorage.getItem("refundModalStatus"),Oa.modalRefundConfig={open:!1},Oa.isCarbonEmissionEligible=!1,Oa.onOpenCarbonEmission=fa,ba(),b.$on("open-business-delayed-modal",function(a,b){Ma(b)}),b.$on("show-modal-acquittance",function(){Ha("acquittance")}),b.$on("show-modal-antecipate",function(){Ha("antecipate")})}a.$inject=["$q","$rootScope","$scope","$state","$stateParams","$timeout","$window","appSettings","advisoryDataFactory","anticipateInstallmentFactory","billetAcquittanceValueCurrentService","bvLogService","commonUrls","commonConstants","contractCancelFactory","creditInstallmentsFactory","currentBilletDataService","currentProductDetailsService","dataLayerFactory","dataLayerSendEventCode","formatDateFactory","FileSaver","homeInstallmentsFactory","installmentsHistoryFactory","internalPageService","mainProductCodes","expiryDateOptionsFactory","expiryDateOptionsService","obtainAdvisoryDataService","obtainDataBilletService","paymentSituationCodes","pdfDeclarationFactory","pdfDemonstrativeFactory","pdfSecondWayFactory","productDetailService","rulesAccessFactory","simulateBilletFinancingAccordService","simulateBilletFinancingAccordFactory","serviceSendDemonstrativeIRService","userInfoService","bvfRoute","contractData","productDetails","commonEvents","windowOpenFactory","refundAvailableService","refundDataLayerFactory","refundRoutes","refundConstant","userService","renegotiationService","renegotiationFactory","carbonEmissionService"],angular.module("internetBanking.credit").controller("BVFController",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){m.loadingPage=!1,m.watchEvent=!0,m.modal={confirm:{open:!1}},m.openModal=i,m.closeModal=j,m.requestCancel=k,m.requestAcquittance=l,m.productDetails=c.getDetails(),m.validityDays=h()}function h(){var a={},b={};return a=moment(m.productDetails.initDate),b=moment(new Date),b.diff(a,"days")}function i(a){m.modal[a].open=!0}function j(a){m.modal[a].open=!1}function k(){a.go(b.CONTRACT_CANCEL_SUCCESS)}function l(){function c(c){var f=[],g=new Date;return c&&(f=e.APIToViewModel(c),g=moment(f[0].expiryDate).toDate()),a.go(b.BILLET_DIGITAL_BILLING,{installments:m.productDetails.listInstallments,selectedDate:g||new Date,autoGenerateBillet:!1,isAcquittance:!0,page:d.translateAccordType("Q")})}f.get(m.productDetails.contractNumber,m.productDetails.listInstallments).then(function(a){return c(a&&a.data)}).catch(function(){return c([{dataVencimento:new Date}])}).finally(function(){})}var m=this;g()}a.$inject=["$state","bvfRoute","contractCancelFactory","simulateBilletFinancingAccordFactory","expiryDateOptionsFactory","expiryDateOptionsService"],angular.module("internetBanking.credit").controller("CreditContractCancelController",a)}(),function(){"use strict";function a(a,b,c,d){function e(){j.loadingPage=!0,j.watchEvent=!0,j.modalConfig={error:{open:!1}},j.protocolNumber="",j.goToHome=i,j.onCloseModal=h,j.productDetails=b.getDetails(),j.validityDays=f(),g()}function f(){var a={},b={};return a=moment(j.productDetails.initDate),b=moment(new Date),b.diff(a,"days")}function g(){c.post(j.productDetails.contractNumber).then(function(a){j.protocolNumber=a.data.numeroTarefa,j.loadingPage=!1}).catch(function(a){j.modalConfig.error.open=!0})}function h(){a.history.back()}function i(){d.goToHomePage()}var j=this;e()}a.$inject=["$window","contractCancelFactory","contractCancelService","userInfoService"],angular.module("internetBanking.credit").controller("CreditContractCancelSuccessController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F){function G(){r.setInstallmentStatus(ha.installmentsList,t),ha.installmentsAmountPerType=r.installmentsAmountPerType(ha.installmentsList),ha.selectedInstallmentsQuantity=ha.installmentsList.length,ha.isBilletBilling=z.getCurrentProduct().data.paymentSituationCode===o.ASSESSORIA_ACORDO_BV,ha.openInstallments=f.getOpenInstallments(ha.installmentsList),ha.overDueInstallments=f.getOverdueInstallments(ha.installmentsList),ha.numOverdueSelectedParcels=angular.copy(ha.overDueInstallments),ha.isBilletBilling&&H(),ha.openAndOverdueInstallments=ha.openInstallments.concat(ha.overDueInstallments),ha.installmentsOverdueQuantity=5,ha.installmentsQuantity=4-ha.overDueInstallments.length<0?0:4-ha.overDueInstallments.length,ha.installmentsIncrement=10,ha.assessoryData=A.assessoryData,ha.overDueInstallments.length&&ha.overDueInstallments[0].numberDaysDelay&&(ha.is90Delayed=ha.overDueInstallments[0].numberDaysDelay>90),ha.overDueInstallments.length&&(ha.overDueInstallments.forEach(function(a){a.selected=!0}),ba()),I();var a=$(".main_content__inner");a.off("scroll"),a.on("scroll",function(){var a=arguments[0].currentTarget.scrollTop,b=jQuery(".-anticipate-installment-table").css("height");if(b){Number(b.replace("px",""))-a<=250?jQuery(".anticipate-installments-footer-bar").addClass("detached"):jQuery(".anticipate-installments-footer-bar").removeClass("detached")}}),z.getCurrentProduct().data.paymentSituationCode===o.ASSESSORIA_ACORDO_BV?F.checkInsuranceLender(ha.contractData.contractNumber).then(function(a){F.isInsuranceLender=a&&a.data}):F.isInsuranceLender=!1}function H(){var a=moment(ha.selectedDate).format("YYYY-MM-DD"),b={numeroContrato:z.getCurrentProduct().data.contractNumber,parcelas:_.sortByOrder(ha.overDueInstallments.map(function(a){return{numeroParcela:a.installmentNumber}}),"numeroParcela",!0),dataVencimento:a,codigoSituacaoFinanceira:z.getCurrentProduct().data.paymentSituationCode};_.forEach(ha.overDueInstallments,function(a){delete a.debtAmount}),y.post(b).then(function(a){if(!a||!a.data)return!1;var b=a&&a.data?a.data:a;ha.calculatedBilling=x.format(b);for(var c=0,d=ha.calculatedBilling.installments[0];c<ha.calculatedBilling.installments.length;c++,d=ha.calculatedBilling.installments[c]){var e=d.installmentNumber,f=d.debtAmount+d.honoraryValue;if(ha.overDueInstallments.length)try{_.find(ha.overDueInstallments,{installmentNumber:e}).debtAmount=f}catch(g){}}}).catch(function(a){console.error("Erro no servico simulateBilletFinancingAccordService",a),g.error(ha.contractData.contractNumber+" - erro simulateBilletFinancingAccordService")})}function I(){var b=z.getCurrentProduct().data.contractNumber;n.get(b,s.formatInstallmentsParam(ha.checkboxesSelected)).then(function(c){if(!c)return g.error([b,"erro em expiryDateOptionsService, installmentsParamFactory","dates undefined"].join(" - ")),ha.errorExpiryDate=!0,ha.selectedDateFlag=!1,ha.alternativeDueDates=null,ha.selectedDate=null,ha.formattedSelectDate=null,!1;P(c),ha.selectedDate=ha.selectedDateFlag?ha.selectedDate:moment(ha.alternativeDueDates[0].expiryDate).toDate(),a.$broadcast(i.CHECK_DATES,{maxDate:l.datepickerOptions.maxDate}),ha.selectedDateFlag=!0,ha.formattedOverDueDate=Q(ha.selectedDate),ha.errorExpiryDate=!1,ca()}).catch(function(){ha.errorExpiryDate=!0,ha.selectedDateFlag=!1,ha.alternativeDueDates=null,ha.selectedDate=null,ha.formattedSelectDate=null,g.error(b+" - erro expiryDateOptionsService.get")})}function J(){d.history.back()}function K(a){if(ha.alternativeDueDates)return!ha.alternativeDueDates.filter(function(b){return angular.equals(b.expiryDate,a)}).length}function L(){ha.installmentsQuantity+=ha.installmentsIncrement}function M(){if(ia=ha.checkboxesSelected.map(function(a){return{installmentNumber:a.installmentNumber}}),S().isNotSequence)return ha.openModal(ha.modalConfig.installmentNonSequence),!1;N()}function N(){return ba(),ha.alternativeDueDates?(ha.openModal(ha.modalConfig.dueDatesAnticipate),l.datepickerOptions.minDate=ha.alternativeDueDates[0].expiryDate,void(l.datepickerOptions.maxDate=ha.alternativeDueDates[ha.alternativeDueDates.length-1].expiryDate)):O()}function O(){var b=s.formatInstallmentsParam(ha.checkboxesSelected),c=z.getCurrentProduct().data.contractNumber;return n.get(c,b).then(function(b){if(!b)return g.error([c,"erro em expiryDateOptionsService, showDatepicker","dates undefined"].join(" - ")),!1;P(b),ha.openModal(ha.modalConfig.dueDatesAnticipate),l.datepickerOptions.minDate=ha.alternativeDueDates[0].expiryDate,l.datepickerOptions.maxDate=ha.alternativeDueDates[ha.alternativeDueDates.length-1].expiryDate,ha.selectedDate=ha.selectedDateFlag?ha.selectedDate:moment(ha.alternativeDueDates[0].expiryDate).toDate(),ha.selectedDateFlag=!0,a.$broadcast(i.CHECK_DATES,{maxDate:l.datepickerOptions.maxDate})}).catch(function(){g.error(c+" - erro expiryDateOptionsService.get")})}function P(a){ha.alternativeDueDates=a.data&&a.data.map(function(a){return{expiryDate:moment(a.dataVencimento+"T00:00:00-03:00").toDate()}})||[{}]}function Q(a){return moment(a).format("L")}function R(){ha.formattedSelectDate=p.format(ha.selectedDate,"@SITE-COMMON-SHORTDATE-MOMENT"),ha.anticipateInstallmentsServiceData.formattedSelectDate=p.format(ha.selectedDate,"@SITE-COMMON-SHORTDATE-MOMENT"),a.$emit(i.SPINNING_START);var d=ha.checkboxesSelected;c.overDueInstallments=d,b.go(E.BILLET_DIGITAL_BILLING,{installments:d,selectedDate:ha.selectedDate,autoGenerateBillet:!ha.isSettle||!F.isInsuranceLender,isInsuranceLender:!1,isAntecipate:!ha.isSettle,isAcquittance:ha.isSettle,page:x.translateAccordType(ha.billetData.accordType)}).then(function(){a.$emit(i.SPINNING_STOP)}).catch(function(){a.$emit(i.SPINNING_STOP)})}function S(){var a=!1,b=[],c=0;return T(),ia.forEach(function(d,e,f){var g=d.installmentNumber,h=f.length===e+1;if(f.length>=e+1){var i=!h&&f[e+1].installmentNumber;b.hasOwnProperty("installmentGroup"+c)?b["installmentGroup"+c].push(g):(b["installmentGroup"+c]=[],b["installmentGroup"+c].push(g)),h||g+1===i||(c++,a=!0)}}),{isNotSequence:a,productName:b}}function T(){return ia.sort(function(a,b){var c=a.installmentNumber>b.installmentNumber?1:0;return a.installmentNumber<b.installmentNumber?-1:c})}function U(a){return a.reduce(function(a,b){return a+b.installmentValue},0)}function V(){if(ha.selectedDateFlag=!0,!ha.selectedDate||!ha.selectedDateFlag)return!1;W()&&console.info("Nenhuma data selecionada?",ha.selectedDate),ha.formattedOverDueDate=Q(ha.selectedDate),ha.formattedSelectDate=ha.formattedOverDueDate,ca(),ha.isBilletBilling=z.getCurrentProduct().data.paymentSituationCode===o.ASSESSORIA_ACORDO_BV,ha.isBilletBilling&&H(),ha.closeModal(ha.modalConfig.dueDatesAnticipate)}function W(){return!ha.checkboxesSelected.length||ha.selectedDate&&!ha.selectedDateFlag}function X(){ha.openAndOverdueInstallments.forEach(function(a){var b=angular.equals(a.situation.code,t.OVERDUE.code);ha.openAndOverdueInstallments.length===ha.checkboxesSelected.length?a.selected=b:a.selected=ha.openAndOverdueInstallments.length!==ha.checkboxesSelected.length}),ba(),ca()}function Y(){function b(){this.isActive=!this.isActive,a.isModal=!a.isModal}function c(){this.isActive=!1,a.isModal=!1}return{isActive:!1,toggle:b,off:c}}function Z(a,b){if(a.preventDefault(),ha.selectedInstallment=ha.installmentsList.filter(function(a){return angular.equals(a.installmentNumber,b)})[0],ha.is90Delayed&&ha.selectedInstallment.isOverdue)return!1;ha.selectedInstallment.selected=!ha.selectedInstallment.selected,aa(b,ha.selectedInstallment.isOverdue),ba(),ha.checkAll=angular.equals(ha.checkboxesSelected.length,ha.openInstallments.length),ha.numOverdueSelectedParcels=_.where(ha.openAndOverdueInstallments,{selected:!0,isOverdue:!0}),ha.checkboxesSelected.length&&ca()}function aa(a,b){var c=!1;ha.installmentsList.filter(function(d){d.isOverdue&&!b&&(d.selected=!0),d.installmentNumber===a&&d.isOverdue&&(ha.selectedInstallment.selected?ha.installmentsList.filter(function(b){b.installmentNumber<a&&b.isOverdue&&(b.selected=!0)}):c=!0),c&&(d.selected=!1)})}function ba(){ha.checkboxesSelected=ha.openAndOverdueInstallments.filter(function(a){return a.selected}),ha.isSettle=ha.openAndOverdueInstallments.length===ha.checkboxesSelected.length}function ca(){ha.formattedSelectDate=p.format(ha.selectedDate,"@SITE-COMMON-SHORTDATE-MOMENT"),ha.anticipateInstallmentsServiceData.formattedSelectDate=p.format(ha.selectedDate,"@SITE-COMMON-SHORTDATE-MOMENT"),a.$emit(i.SPINNING_START),ha.billetData.isCheckingValue=!0;var b=!0,c=_.sortByOrder(s.formatInstallmentsParam(ha.checkboxesSelected),"numeroParcela",b),d={numeroContrato:ha.contractData.contractNumber,parcelas:c,dataVencimento:p.format(ha.selectedDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT"),codigoSituacaoFinanceira:ha.productDetails.paymentSituationCode};ha.productDetails.paymentSituationCode===o.ASSESSORIA_ACORDO_BV?y.post(d).then(function(b){if(!b||!b.data)return!1;ha.billetData=x.format(b.data);var c=ha.billetData.valorDescontoSeguroPrestamista||0;ha.billetData.discountsTotalValue={value:ha.billetData.discountValue+c||0},ha.anticipateInstallmentsServiceData.billetData=ha.billetData,a.$emit(i.SPINNING_STOP)}).finally(function(){a.$emit(i.SPINNING_STOP),ha.billetData.isCheckingValue=!1}):w.post(z.getCurrentProduct().data.contractNumber,c,p.format(ha.selectedDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")).then(function(b){ha.billetData=v.APIToViewModel(b);var c=ha.billetData.valorDescontoSeguroPrestamista&&ha.billetData.valorDescontoSeguroPrestamista.value||0;ha.billetData.discountsTotalValue={value:ha.billetData.discountsTotalValue.value+c||0},ha.anticipateInstallmentsServiceData.billetData=ha.billetData,a.$emit(i.SPINNING_STOP)}).catch(function(){a.$emit(i.SPINNING_STOP)}).finally(function(){ha.billetData.isCheckingValue=!1})}function da(){var a=ha.checkboxesSelected;ha.installmentsSelected=s.formatInstallmentsParam(a),q.get(ha.contractData.contractNumber,ha.installmentsSelected,p.format(ha.selectedDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")).then(function(a){ha.generatedBilletData=h.APIToViewModel(a),ha.generatedBilletData.date=p.format(ha.generatedBilletData.processingDate,"@SITE-BILLET-GENERATED-DAY-FORMAT"),ha.generatedBilletData.time=p.format(ha.generatedBilletData.processingDate,"@SITE-BILLET-GENERATED-TIME-FORMAT")}).catch(function(){g.error(ha.contractData.contractNumber+" - getOnlyFinancingBilletService.get")})}function ea(){switch(b.current.name){case e.FINANCING_ANTICIPATE_INSTALLMENTS_LIST:b.go(e.FINANCING_ACQUITTANCE_DUE_DATE);break;case e.LEASING_ANTICIPATE_INSTALLMENTS_LIST:b.go(e.LEASING_ACQUITTANCE_DUE_DATE);break;case e.PERSONAL_ANTICIPATE_INSTALLMENTS_LIST:b.go(e.PERSONAL_ACQUITTANCE_DUE_DATE);break;case e.PAYROLL_ANTICIPATE_INSTALLMENTS_LIST:b.go(e.PAYROLL_ACQUITTANCE_DUE_DATE)}}function fa(){ga(),b.go(E.ANTICIPATE_INSTALLMENTS_BILLET)}function ga(){var a="";switch(b.current.name){case e.FINANCING_ANTICIPATE_INSTALLMENTS_LIST:a=C.BVF.ACQUITTANCE_INSTALLMENTS.FINANCING;break;case e.LEASING_ANTICIPATE_INSTALLMENTS_LIST:a=C.BVF.ACQUITTANCE_INSTALLMENTS.LEASING;break;case e.PERSONAL_ANTICIPATE_INSTALLMENTS_LIST:a=C.BVF.ACQUITTANCE_INSTALLMENTS.CREDIT;break;case e.PAYROLL_ANTICIPATE_INSTALLMENTS_LIST:a=C.BVF.ACQUITTANCE_INSTALLMENTS.PAYROLL}B.sendEvent({ID:a,parameters:"Adiantamento de parcelas"})}var ha=this,ia=[];ha.datePickerOptions=l.datepickerOptions,l.datepickerOptions.minDate=moment(),l.datepickerOptions.maxDate=moment(),ha.selectedDate=new Date,ha.selectedDateFlag=!1,ha.rangeDates=null,ha.productDetails=D,ha.productDetails.anticipateInstallments={},ha.anticipateInstallmentsServiceData=ha.productDetails.anticipateInstallments,ha.filterActive=t.PAID,ha.checkboxesSelected=[],ha.contractData=k,ha.contractData.contractNumber=D.contractNumber,ha.contractData.category=D.category,ha.contractData.productName=D.alias?D.alias:D.category,ha.totalInstallments=k.installmentsTotalQuantity.value,ha.paidInstallments=k.paidInstallmentsQuantity.value,ha.selectedInstallmentsQuantity=ha.totalInstallments-ha.paidInstallments,ha.openAndOverdueInstallments=[],ha.installmentsList=k.listInstallments,ha.billetData={totalBilletValue:null,savedValue:null},ha.errorExpiryDate=!1,ha.headerCheckbox=!1,ha.alternativeDueDates=null,ha.formattedOverDueDate=null,ha.generatedBilletData=null,ha.modalConfig={acquittance:{open:!1},dueDatesAnticipate:{open:!1,modifierClass:"-datepicker"},overDueInstallment:{open:!1},installmentNonSequence:{open:!1}},ha.contractItems={installmentsTotalValue:{label:j.PARCELAS,value:0},discountsTotalValue:{
label:j.DESCONTOS,disclaimerNumber:1,value:0}},ha.contractItemsArray=[{contractItem:"installmentsTotalValue",contractItemDetails:ha.contractItems.installmentsTotalValue},{contractItem:"discountsTotalValue",contractItemDetails:ha.contractItems.discountsTotalValue}],ha.installmentsListFormatted=null,ha.mobileFilterPopup=Y(),ha.changeAllCheckboxes=X,ha.checkIt=Z,ha.generateBillet=da,ha.loadMoreInstallments=L,ha.checkInstallmentsAnticipation=R,ha.openModal=u.openModal,ha.closeModal=u.closeModal,ha.getDueDates=M,ha.goBack=J,ha.calculateInstallmentsTotal=U,ha.closeChooseDate=V,ha.verifyDateSelected=W,ha.disableInvalidDates=K,ha.goToAcquittance=ea,ha.gotoBilletAcquittance=fa,ha.showDatepicker=N,ha.setOverDueInstallmentsAccord=H,G()}a.$inject=["$rootScope","$state","$stateParams","$window","acquittanceRoutes","anticipateInstallmentFactory","bvLogService","codeBarsFactory","commonEvents","commonConstants","contractData","datepickerManagerService","expiryDateOptionsFactory","expiryDateOptionsService","financialSituationCode","formatDateFactory","getOnlyFinancingBilletService","installmentsHistoryFactory","installmentsParamFactory","installmentsStatus","modalHelpersService","simulateOnlyFinancingBilletFactory","simulateOnlyFinancingBilletService","simulateBilletFinancingAccordFactory","simulateBilletFinancingAccordService","productDetailService","currentProductDetailsService","dataLayerFactory","dataLayerSendEventCode","productDetails","bvfRoute","insuranceRefundService"],angular.module("internetBanking.credit").controller("AnticipateInstallmentsController",a)}(),function(){"use strict";function a(a){function b(){c.assessoryCompaniesList=a.assessoryCompaniesList}var c=this;b()}a.$inject=["$rootScope"],angular.module("internetBanking.credit").controller("AssessoryListController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){function C(){D(),F(),G()}function D(){if(ca.currentProductDetailsService=o,ca.isFinancing=angular.equals(y.getCurrentProduct().data.productCode,12),ca.stateRoutes=o.currentProductRoutes,ca.contractData=y.getCurrentProduct().productDetail,ca.contractData.contractNumber=y.getCurrentProduct().data.contractNumber,ca.contractData.productName=y.getCurrentProduct().data.title||y.getCurrentProduct().data.category,ca.contractData.category=y.getCurrentProduct().data.category,ca.singleInstallment=o.singleInstallment?o.singleInstallment:null,ca.onSendBilletEmail=O,ca.onOpenPDF=T,ca.setDataBillet=U,ca.onBackHome=W,ca.editData=Y,ca.editEmailDataUpdate=N,ca.goToDataUpdate=$,ca.goToHome=Z,ca.resetModalConfig=_,ca.sendDataEmail=S,E(),_(),c.dataUpdateCallback&&!a.emailSent&&"function"==typeof c.sendEmailBillet){var b=c.sendEmailBillet();b.id=c.dataUpdateCallback.id,delete b.email,a.emailSent=!0,P().then(function(){}).finally(function(){S(b).then(function(){ca.resetModalConfig(),d(function(){ca.isUpdated?ca.modalConfig.bankslipSent={open:!0}:ca.isAllUpdated?ca.modalConfig.emailAndBankslipSent={open:!0}:ca.modalConfig.emailAndBankslipSentNotUpdated={open:!0}},1e3)})})}ca.loadingLink=!0}function E(){ca.isCopied=!1,ca.copyHelperText=!1,ca.inputIdonError=null,ca.onSuccess=J,ca.onError=K,ca.actionOnCopy=L,ca.notIsCopiedAndNotCopyHelperText=M,a.$on(j.COPY,function(){ca.copyHelperText&&ca.actionOnCopy(ca.inputIdonError)}),ca.isAcquittance=m.product.isAcquittance}function F(){var a=o.currentProductDetails.paymentSituationCode;ca.settled=angular.equals(a,t.QUITADO),ca.currentBillet=n.get(),ca.broadcastBlurEvent=I,ca.currentDueDate=u.format(ca.currentBillet.dueDate,"@SITE-COMMON-SHORTDATE-MOMENT"),ca.settled=!0}function G(){function a(a){return a?[209,210].indexOf(a.status)>-1?(d(function(){b.go(ca.stateRoutes.HOME)},200),!1):(ca.hiddenPageBillet=!0,ca.codeBar=a.data.codigoDeBarras,ca.processingDate=a.data.dataProcessamento,ca.date=u.format(ca.processingDate,"@SITE-BILLET-GENERATED-DAY-FORMAT"),ca.time=u.format(ca.processingDate,"@SITE-BILLET-GENERATED-TIME-FORMAT"),U({type:"boletos",hash:a.data.codigoHash,pdf:a.data.pdf?a.data.pdf:""}),void X({bill:{type:"ED",value:ca.codeBar&&parseInt(ca.codeBar.slice(-10))/100,months:1}})):(ca.hiddenPageBillet=!1,ca.modalConfig.open=!0,!1)}function c(a){ca.hiddenPageBillet=!1,ca.modalConfig.open=!0;var b=ca.contractData.contractNumber,c=a&&a.data&&a.data.messages;h.error([b,"erro obtainDataBilletService.postBillet",c].join(" - "))}var e=H();x.postBillet(e).then(a).catch(c)}function H(){return{codigoContrato:ca.contractData.contractNumber,parcelas:[{numeroParcela:ca.currentBillet.installmentNumber}],valor:ca.currentBillet.totalValue,dataVencimento:u.format(ca.currentBillet.dueDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function I(b){a.$broadcast(j.BLUR,b)}function J(b){ca.broadcastBlurEvent(b),ca.isCopied=!0,d.cancel(),d(function(){ca.isCopied=!1},2500);var c=y.getCurrentProduct().data.productCode,e=q.BVF.OPEN_BILLET_COPY_CODE.FINANCING;angular.equals(c,w.personalCredit)?e=q.BVF.OPEN_BILLET_COPY_CODE.CREDIT:angular.equals(c,w.payroll)&&(e=q.BVF.OPEN_BILLET_COPY_CODE.PAYROLL),a.$emit("data-layer-product"),d(function(){p.sendEvent({ID:e})})}function K(a){ca.copyHelperText=!0,ca.inputIdonError=a}function L(b){ca.copyHelperText=!1,ca.isCopied=!0,d.cancel(),d(function(){ca.broadcastBlurEvent(b),ca.isCopied=!1,ca.inputIdonError=null},2500),a.$digest()}function M(){return!ca.isCopied&&!ca.copyHelperText}function N(){function d(){var d=angular.copy(c);angular.merge(d,{installments:R().installments,selectedDate:moment(R().dueDate).toDate(),autoGenerateBillet:!0,sendEmailBillet:function(){return R()}}),a.emailSent=!1,b.go(l.DATA_UPDATE_EDIT,{showField:"email",hideOptIn:!0,isUpdated:ca.isUpdated||!1,callback:function(a){d.dataUpdateCallback=a&&a.enderecosEletronicos&&a.enderecosEletronicos[0],b.go(f.BILLET_OPEN,angular.copy(d))}}).then(function(){a.$emit(j.SPINNING_STOP)})}a.$emit(j.SPINNING_START),c.sendEmailBillet=null,c.dataUpdateCallback=null,d()}function O(){a.$emit(j.SPINNING_START),a.emailSent=!1,Q();var b=y.getCurrentProduct().data.productCode,c=q.BVF.OPEN_BILLET_EMAIL.FINANCING;angular.equals(b,w.personalCredit)?c=q.BVF.OPEN_BILLET_EMAIL.CREDIT:angular.equals(b,w.payroll)&&(c=q.BVF.OPEN_BILLET_EMAIL.PAYROLL),p.sendEvent({ID:c})}function P(){return Q(!0)}function Q(b){function c(a,c){b||("object"==typeof c?ca.modalConfig[a]={open:!0}:(ca.modalConfig.open=!0,ca.modalConfig[a]=!0),ca.isLoaded=!0)}return a.$emit(j.SPINNING_START),ca.isUpdated=!1,ca.isAllUpdated=!0,r.get().then(function(d){function e(a){ca.isUpdated=a&&a.enderecosEletronicosAtualizados}function f(a){ca.isAllUpdated=a&&a.enderecosAtualizados&&a.enderecosEletronicosAtualizados&&a.telefonesAtualizados}function g(a,b){var c=[];return a.reduce(function(a,d){return a.indexOf(d.infoMask)<0&&(a.push(d.infoMask),c.push({infoMask:d.infoMask,tipo:b,dataAtualizacao:d.dataAtualizacao,id:d.id})),a},[]),c}if(ca.phoneList=g(d.data.telefones,"CELULAR"),ca.emailList=d.data.enderecosEletronicos,b?f(d.data):e(d.data),!a.emailSent)if(0===ca.phoneList.length&&0===ca.emailList.length)c("emptyData",{});else{if(ca.isUpdated)return ca.isLoaded=!0,void c("emailConfirmation",{});c("contactsFound",{})}}).catch(function(){c("error",{})}).finally(function(){a.$emit(j.SPINNING_STOP)})}function R(){return{contractNumber:ca.contractData.contractNumber,installments:[{numeroParcela:ca.currentBillet.installmentNumber}],installmentValue:ca.currentBillet.totalValue,id:ca.emailList&&ca.emailList[0]&&ca.emailList[0].id,dueDate:u.format(ca.currentBillet.dueDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function S(b){function c(){ca.resetModalConfig(),a.emailSent||P().then(function(){ca.modalConfig.bankslipSent={open:!0}}),a.$emit(j.SPINNING_STOP)}function d(b){ca.resetModalConfig(),ca.modalConfig.notEmail.open=!0,ca.modalConfig.notEmail.message=b&&b.data&&b.data.messages[1],a.$emit(j.SPINNING_STOP)}var e=b||R();return a.$emit(j.SPINNING_START),z.send(e).then(c).catch(d)}function T(){function a(a){if(i.IS_IE){var c=new g(h.pdf?[b(h.pdf)]:[a.data]);s.saveAs(c,"boleto-bv-"+h.hash+".pdf")}else{var d=h.pdf?URL.createObjectURL(b(h.pdf)):URL.createObjectURL(a.data),e=0,j=[];ba.location=d,j.push({tela:ba}),j[j.length-1].tela&&angular.forEach(j,function(a){null!==a.tela&&(e+=a.tela.closed?0:1)}),e||(ca.modalConfig.open=!0,ca.modalConfig.popup.open=!0)}f()}function b(a){function b(a){for(var b=atob(a),c=[],d="application/pdf",e=512,f=0;f<b.length;f+=e){for(var h=b.slice(f,f+e),i=new Array(h.length),j=0;j<h.length;j++)i[j]=h.charCodeAt(j);var k=new Uint8Array(i);c.push(k)}return new g(c,{type:d})}return b(a)}function c(b){a(b)}function e(){ca.modalConfig.open=!0,ca.modalConfig.error.open=!0}function f(){angular.equals(j,w.personalCredit)?k=q.BVF.OPEN_BILLET.CREDIT:angular.equals(j,w.payroll)&&(k=q.BVF.OPEN_BILLET.PAYROLL),p.sendEvent({ID:k})}ba=B.nonBlockPopup("Aguarde, seu boleto está sendo gerado...");var h=V(),j=y.getCurrentProduct().data.productCode,k=q.BVF.OPEN_BILLET.FINANCING;console.info("### CONTRATO FLEX"),console.info("dataBillet: ",h),h.pdf?a():d(function(){v.getPDF(h.type,h.hash).then(c).catch(e)},500)}function U(a){aa=a}function V(){return aa}function W(){window.history.back()}function X(a){if(a)try{angular.merge(document.BVDatalayer.userInfo.profile,a)}catch(b){}}function Y(a){b.go(l.DATA_UPDATE_EDIT,{showField:a})}function Z(){_(),b.go(k.HOME)}function $(){b.go(l.DATA_UPDATE_EDIT)}function _(){ca.modalConfig={email:{open:!1,value:""},emailNotRegister:{open:!1},notEmail:{open:!1,message:""},error:{open:!1},open:!1,contactsFound:{open:!1},emailConfirmation:{open:!1},bankslipSent:{open:!1},emailAndBankslipSent:{open:!1},emailAndBankslipSentNotUpdated:{open:!1},emptyData:{open:!1}}}var aa,ba,ca=this;C()}a.$inject=["$rootScope","$state","$stateParams","$timeout","$window","bvfRoutes","Blob","bvLogService","commonConstants","commonEvents","commonRoutes","userRoutes","creditProductsService","currentBilletDataService","currentProductDetailsService","dataLayerFactory","dataLayerSendEventCode","dataUpdateService","FileSaver","financialSituationCode","formatDateFactory","getPDFCreditService","mainProductCodes","obtainDataBilletService","productDetailService","sendBilletEmailService","userInfoService","windowOpenFactory"],angular.module("internetBanking.credit").controller("BilletOpenController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(){x(),w(),y()}function w(){N.currentProductDetailsService=j,N.isFinancing=angular.equals(s.getCurrentProduct().data.productCode,12),N.stateRoutes=j.currentProductRoutes,N.contractData=s.getCurrentProduct().productDetail,N.contractData.contractNumber=s.getCurrentProduct().data.contractNumber,N.contractData.productName=s.getCurrentProduct().data.title||s.getCurrentProduct().data.category,N.contractData.category=s.getCurrentProduct().data.category,N.singleInstallment=j.singleInstallment?j.singleInstallment:null,N.openModal=r.openModal,N.closeModal=r.closeModal,N.calculateAcquittanceValue=D,N.isAcquittance=f.get("isAcquittance")||!1,N.modalConfig={email:{open:!1,value:""},emailNotRegister:{open:!1},notEmail:{open:!1},dueDatesAnticipate:{open:!1,modifierClass:"-datepicker"},error:{open:!1}}}function x(){N.isFriendlyDelay=!0,N.dueDate=new Date,N.dueDateFlag=!1,N.isSingleAndFriendlyDelay=!1,N.datePickerOptions=m.datepickerOptions,m.datepickerOptions.minDate=moment(),m.datepickerOptions.maxDate=moment(),N.alternativeDueDates=null,N.selectedDate=new Date,N.selectedDateFlag=!1,N.rangeDates=null,N.alternativeDueDates=n,N.openDates=z,N.closeChooseDate=B,N.disableInvalidDates=C,N.alternativeDueDates[0]||(N.alternativeDueDates=[{expiryDate:new Date}]),m.datepickerOptions.minDate=moment(N.alternativeDueDates[0].expiryDate),m.datepickerOptions.maxDate=moment(N.alternativeDueDates[N.alternativeDueDates.length-1].expiryDate),N.selectedDate=N.selectedDateFlag?N.selectedDate:moment(N.alternativeDueDates[0].expiryDate).toDate(),b.$broadcast(g.CHECK_DATES,{maxDate:m.datepickerOptions.maxDate})}function y(){var a=j.currentProductDetails.paymentSituationCode;N.settled=angular.equals(a,o.QUITADO),N.currentBillet=i.get(),N.currentDueDate=p.format(N.currentBillet.dueDate,"@SITE-COMMON-SHORTDATE-MOMENT"),N.settled=!0}function z(){N.openModal(N.modalConfig.dueDatesAnticipate)}function A(a){return moment(a).format("dddd")+" ("+moment(a).format("L")+")"}function B(){N.selectedDateFlag=!0,N.dueDate=N.selectedDate,N.formattedOverDueDate=A(N.selectedDate),N.closeModal(N.modalConfig.dueDatesAnticipate)}function C(a){if(N.alternativeDueDates){return!N.alternativeDueDates.filter(function(b){var c=moment(b.expiryDate).format("DD/MM/YYYY");return angular.equals(c,moment(a).format("DD/MM/YYYY"))}).length}}function D(){var a=N.isAcquittance?F():E();K(),G(a)}function E(){return{contractNumber:N.contractData.contractNumber,installments:[{numeroParcela:N.currentBillet.installmentNumber}],dateDue:p.format(N.dueDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function F(){return{contractNumber:N.contractData.contractNumber,installments:N.currentBillet.installmentNumber.map(function(a){return{numeroParcela:a.installmentNumber}}),dateDue:p.format(N.dueDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function G(a){function b(a){H(a.data)}function c(a){N.modalConfig.notEmail.open=!0;var b=N.contractData.contractNumber,c=a&&a.data&&a.data.messages;e.error([b,"erro simulateBilletDelayService.searchDataSimulate",c].join(" - ")),L()}t.searchDataSimulate(a).then(b).catch(c)}function H(a){N.contractValues=u.APIToViewModel(a);var b=J(N.contractValues);f.set("contractValues",N.contractValues),f.set("currentBillet",N.currentBillet),f.set("dueDate",N.dueDate),f.set("contractData",N.contractData),f.set("installmentsActive",b),f.set("total",N.contractValues.totalBilletValue),f.set("formattedOverDueDate",N.dueDate),L(),M({bill:{type:N.isAcquittance?"QC":"EA",value:N.contractValues.totalBilletValue,months:1}}),N.isAcquittance?(I(),c.go(N.stateRoutes.ACQUITTANCE_BILLET)):c.go(N.stateRoutes.ACQUITTANCE_VALUE)}function I(){var a=s.getCurrentProduct().data.productCode,c=l.BVF.ACQUITTANCE_DUE_DATE.FINANCING;angular.equals(a,q.personalCredit)?c=l.BVF.ACQUITTANCE_DUE_DATE.CREDIT:angular.equals(a,q.payroll)?c=l.BVF.ACQUITTANCE_DUE_DATE.PAYROLL:angular.equals(a,q.leasing)&&(c=l.BVF.ACQUITTANCE_DUE_DATE.LEASING),b.$emit("data-layer-product"),d(function(){k.sendEvent({ID:c})})}function J(a){for(var b=[{label:"Parcela",value:N.currentBillet.installment&&N.currentBillet.installment.totalValue-(N.currentBillet.installment.fineValue+N.currentBillet.installment.arrearsValue),disclaimerNumber:!1}],c=["fineTotalValue","arrearsTotalValue","discountsTotalValue","notificationTotalValue"],d=0;d<c.length;d++)b.push({label:a[c[d]].label,value:a[c[d]].value,disclaimerNumber:!0});return b}function K(){b.$emit(g.SPINNING_START)}function L(){b.$emit(g.SPINNING_STOP)}function M(a){if(a)try{angular.merge(document.BVDatalayer.userInfo.profile,a)}catch(b){}}var N=this;v()}a.$inject=["$log","$rootScope","$state","$timeout","bvLogService","billetAcquittanceValueCurrentService","commonEvents","contractData","currentBilletDataService","currentProductDetailsService","dataLayerFactory","dataLayerSendEventCode","datepickerManagerService","dueDatesAlternative","financialSituationCode","formatDateFactory","mainProductCodes","modalHelpersService","productDetailService","simulateBilletDelayService","simulateOnlyFinancingBilletFactory"],angular.module("internetBanking.credit").controller("BilletDelayController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M){function N(){if(Ra.overDueInstallments=_.filter(_.where(D.getCurrentProduct().productDetail.listInstallments,{situation:{code:3}}),function(a){return a.numberDaysDelay>=1}),Ra.back=Ca,Ra.btnBilletBarcode=Da,Ra.checkInstallmentsAnticipation=P,Ra.closeChooseDate=ja,Ra.closeModal=A.closeModal,Ra.closeModalShowDueDate=Ja,Ra.closePopupPdf=Ba,Ra.closeRetention=za,Ra.datePickerOptions=s.datepickerOptions,Ra.disableInvalidDates=Q,Ra.generateBillet=S,Ra.getDueDates=fa,Ra.goToAntecipate=ga,Ra.onChangeDate=ca,Ra.openModal=A.openModal,Ra.openPaymentDetails=Ga,Ra.openRetention=ya,Ra.popUp=[],Ra.sendDataEmail=ta,Ra.sendNotificationErrorMessage=Z,Ra.sendRetentionSurvey=Aa,Ra.showDetailedBillet=ea,Ra.onSuccessGeneratedBilling=X,Ra.editData=Na,Ra.editEmailDataUpdate=oa,Ra.goToDataUpdate=Pa,Ra.goToHome=Oa,Ra.resetModalConfig=ia,Ra.isAntecipateContract=!0===c.isAntecipate,Ra.isAcquittanceContract=!0===c.isAcquittance,Ra.isRenegotiation=!0===c.isRenegotiation,Ra.openDatePicker=!1,Ra.retentionForm={},Ra.divergentBilletValue=!1,s.datepickerOptions.minDate=moment(),s.datepickerOptions.maxDate=moment(),da(),la(),Fa(),c.installments&&(Ra.overDueInstallments=c.installments,Ra.selectedDate=c.selectedDate),Ra.dataUpdateCallback=c.dataUpdateCallback,Ra.dataUpdateCallback&&!a.emailSent&&"function"==typeof c.sendEmailBillet){var b=c.sendEmailBillet();b.id=Ra.dataUpdateCallback.id,delete b.email,a.emailSent=!0,qa().then(function(){}).finally(function(){ta(b).then(function(){function a(){d(function(){Ra.isUpdated?Ra.modalConfig.bankslipSent={open:!0}:Ra.isAllUpdated?Ra.modalConfig.emailAndBankslipSent={open:!0}:Ra.modalConfig.emailAndBankslipSentNotUpdated={open:!0}},1e3)}Ra.resetModalConfig(),a();for(var b=1;b<40;b++)d(a,100*b)})})}if(c.dueDatesAlternative){Ra.alternativeDueDates=c.dueDatesAlternative;var e=c.dueDatesAlternative[0].expiryDate;c.selectedDate?Ra.selectedDate=moment(c.selectedDate).toDate():Ra.selectedDate=moment(e).toDate(),Ra.formattedSelectDate=O(Ra.selectedDate),P(moment(Ra.selectedDate).format("YYYY-MM-DD"))}M.isInsuranceLender=!1}function O(a){return moment(a).format("L")}function P(a){var b={numeroContrato:Ra.contractData.contractNumber,parcelas:_.sortByOrder(Ra.overDueInstallments.map(function(a){return{numeroParcela:a.installmentNumber}}),"numeroParcela",!0),dataVencimento:a,codigoSituacaoFinanceira:Ra.contractData.paymentSituationCode};return b.parcelas.length||(b.parcelas=[{numeroParcela:Ra.currentBillet&&Ra.currentBillet.installmentNumber}]),R(b)}function Q(a){if(Ra.alternativeDueDates){return!Ra.alternativeDueDates.filter(function(b){var c=moment(b.expiryDate).format("DD/MM/YYYY");return angular.equals(c,moment(a).format("DD/MM/YYYY"))}).length}}function R(d){function e(a){if(a){var d=a&&a.data?a.data:a;if(Ra.calculatedBilling=F.format(d),Ra.calculatedBilling.installmentsDelayed=_.filter(Ra.calculatedBilling.installments,function(a){return a.datesDelay>5}),j(Ra.calculatedBilling),l(Ra.calculatedBilling),b.go(b.current.name,{page:F.translateAccordType(Ra.calculatedBilling.accordType)},{notify:!1}),Ra.calculatedBilling&&Ra.calculatedBilling.installments){var e=("0"+Ra.calculatedBilling.installments.length).substr(-2,2),f={label:"Parcelas em aberto ("+e+")",number:"",value:_.reduceRight(Ra.calculatedBilling.installments,function(a,b){return a+b.installmentValue},0),visible:!1,isFixed:!1,hasDetails:!0};Ra.billetBillingItems.unshift(f);var g=[{label:"Parcelas em aberto: ",number:"",value:e,visible:!0,isFixed:!0,isQuantity:!0}],h=_.sum(Ra.calculatedBilling.installments,"installmentValue");g.push({label:1===Ra.calculatedBilling.installments.length?"Valor da parcela: ":"Valor total das parcelas: ",number:"1",value:Ra.calculatedBilling.totalValueParcel||h,visible:!0,isFixed:!0,hideWhenIsZero:!0}),Ra.billetBillingItem=g}if(Ra.selectedDateFlag){va("BILLET_BILLING_CHANGED_DATE",D.getCurrentProduct().data.productCode)}c.hideChangeDate&&(Ra.hideChangeDate=!0),c.autoGenerateBillet&&S(),Ia({bill:{type:Ha(Ra.calculatedBilling.accordType)}}),q.addDataLayerEvent({actionField:"step-visualizou-confirmacao-de-dados",page:"confirm"})}}function f(){i.error([Ra.contractData.contractNumber,JSON.stringify(Ka()),JSON.stringify(document.BVDatalayer),"erro simulateBilletFinancingAccordService"].join(" - ")),W(),Ra.modalConfig.open=!0,Ra.modalConfig.error.open=!0}function g(){a.$emit(k.LOADING_STOP,{noAnimate:!0})}function h(b){function c(a){return H.post(a.contractNumber,a.installmentsList,a.date).then(e).catch(f)}var d={contractNumber:b.numeroContrato,date:moment(Ra.selectedDate).utc().format("YYYY-MM-DD"),installmentsList:b.parcelas};return a.$emit(k.SPINNING_START),c(d)}function j(a){Ra.billetBillingDiscounts=[{label:"Multa",number:"",value:a.totalDiscountFine?-1*a.totalDiscountFine:0,visible:!0,isFixed:!1},{label:"Mora",number:"",value:a.totalDiscountMora?-1*a.totalDiscountMora:0,visible:!0,isFixed:!1}],a.discountParcel&&Ra.billetBillingDiscounts.push({label:"Antecipação de parcelas",number:"",value:-1*a.discountParcel,visible:!0,isFixed:!1})}function l(a){Ra.billetBillingItems=[{label:"Multa",number:"2",value:a.fineValue+(a.totalDiscountFine||0),visible:!1,isFixed:!1},{label:"Mora",number:"2",value:a.moraFee+(a.totalDiscountMora||0),visible:!1,isFixed:!1},{label:"Encargos",number:"2",value:a.chargesFee,visible:!1,isFixed:!1},{label:"Custas",number:"3",value:a.judicialCosts,visible:!1,isFixed:!1}],Ra.showJudicialCosts=a.judicialCosts&&0!==a.judicialCosts}return Ra.calculatedBilling=null,Ra.showFees=!1,a.$emit(k.LOADING_START,{noAnimate:!0}),14===d.codigoSituacaoFinanceira?G.post(d).then(e).catch(f).finally(g):h(d).then(e).catch(f).finally(g)}function S(d){function e(a){var d;if(!a||!a.data)return aa(),!1;if(Ra.retryGenerateBillet=!1,d=B.format(a.data),d.divergentBilletValue)return U(),!1;if(Ra.generatedBillet=d,X(Ra.generatedBillet),209!==a.status&&!Ra.isAntecipateContract){if(M.isInsuranceLender&&Ra.isAcquittanceContract&&!c.isInsuranceLender)return b.go(h.INSURANCE_REFUND,{selectedDate:Ra.selectedDate});La()}}if(Sa=!0,Ra.dueDate&&(Ra.selectedDate=Ra.dueDate),Ra.contractData.paymentSituationCode!==v.ASSESSORIA_ACORDO_BV)return T();if(V(d))return Ra.modalConfig.open=!0,void(Ra.modalConfig.confirmationPayment.open=!0);var f=B.formatRequest(Ra.calculatedBilling,Ra.selectedDate);return Ra.retryGenerateBillet=!0,a.$emit(k.SPINNING_START),C.post(f).then(e).catch(aa)}function T(){function d(a){var d;if(!a||!a.data)return aa(),!1;if(d=B.format(a.data),d.divergentBilletValue)return U(),!1;if(Ra.generatedBillet=d,X(Ra.generatedBillet),209!==a.status){if(M.isInsuranceLender&&Ra.isAcquittanceContract&&!c.isInsuranceLender)return b.go(h.INSURANCE_REFUND,{selectedDate:Ra.selectedDate});La()}}if(Ra.divergentBilletValue)return Ra.modalConfig.open=!0,Ra.modalConfig.callCenter.open=!0,!1;if(!Ra.calculatedBilling||!Ra.calculatedBilling.installments)return!1;var e={codigoContrato:Ra.contractData.contractNumber,dataVencimento:moment(Ra.selectedDate).utc().format("YYYY-MM-DD"),parcelas:Ra.calculatedBilling.installments.map(function(a){return{numeroParcela:a.installmentNumber}}),valorTotalBoleto:Ra.calculatedBilling.totalBilletValue?Ra.calculatedBilling.totalBilletValue:""};return a.$emit(k.SPINNING_START),u.issue(e).then(d).catch(aa)}function U(){Ra.modalConfig.open=!0,Ra.modalConfig.callCenter.open=!0,Ra.divergentBilletValue=!0,a.$emit(k.SPINNING_STOP),q.customPageView({pageName:"BV|AL|financiamento|geracao-boleto-quitacao|lightbox-call-center"})}function V(a){if(!a&&1!==Ra.contractData.chargeType.code){if(_.filter(Ra.calculatedBilling.installments,function(a){if(a.datesDelay<=-14&&a.datesDelay>=4)return a}).length>0)return!0;if(2===Ra.contractData.chargeType.code){return _.filter(Ra.calculatedBilling.installments,function(a){if(a.datesDelay<=-14&&a.datesDelay>=10)return a}).length>0}}return!1}function W(){q.addDataLayerEvent({actionField:"step-sem-ofertas",page:"sem-ofertas"})}function X(b){function c(a){var b=moment(Ra.selectedDate).format("DD/MM/YYYY").split("/");return b.push(a),b.push(Ra.contractData.contractNumber),b.join("|")}var d={};if(Ra.calculatedBilling&&Ra.generatedBillet&&Ra.generatedBillet.codeBar&&Ra.generatedBillet.codeBar.length>10&&(d={totalBilletValue:f("currency")(Ra.calculatedBilling.totalBilletValue),codeBar:f("currency")(parseInt((""+Ra.generatedBillet.codeBar).slice(-10))/100)}),wa({type:"boletos",hash:Ra.generatedBillet&&Ra.generatedBillet.hashCode}),jQuery&&jQuery(".attendance")[0]){var e=parseInt(.2*jQuery(".attendance")[0].offsetTop);jQuery(".main_content__inner").animate({scrollTop:e},"slow")}za(),Ea(),Y(),a.$emit(k.SPINNING_STOP);var g=""+parseInt((""+Ra.generatedBillet&&Ra.generatedBillet.codeBar).slice(-10)),h={prefix:g.substr(0,g.length-2),sufix:g.substr(-2,g.length)};if(b){var i={bill:{type:Ha(Ra.calculatedBilling&&Ra.calculatedBilling.accordType),value:Number([h.prefix,h.sufix].join(".")),months:Ra.calculatedBilling&&Ra.calculatedBilling.installments.length}};Ra.isAcquittance||Ra.isAcquittanceContract?va("GENERATE_BILLET_ACQUITTANCE",null,i):va("BILLET_BILLING_GENERATE_BILLET",null,i)}try{q.addDataLayerEvent({event:"transacao",ecommerce:{purchase:{actionField:{id:c(Ra.calculatedBilling.totalBilletValue),affiliation:"bv",renevue:d.totalBilletValue},products:[{name:document.BVDatalayer.product.name,id:[document.BVDatalayer.product.name,document.BVDatalayer.pageInfo.account.numberDaysDelay].join("-"),category:document.BVDatalayer.product.category,price:d.totalBilletValue,quantity:document.BVDatalayer.pageInfo.account.overDueInstallments}]}}})}catch(j){}}function Y(){if(Ra.generatedBillet&&Ra.generatedBillet.notificationBillet){var a=Ra.generatedBillet.notificationBillet;a.message&&a.message.length&&(Ra.modalConfig.open=!0,Ra.modalConfig.notificationBillet.open=!0,Ra.modalConfig.notificationBillet.message=a.message,Z(a.message))}}function Z(a){i.error([Ra.contractData.contractNumber,"notificacao boleto",a,JSON.stringify(Ra.calculatedBilling)].join(" - "))}function aa(b){if(b&&b.data){var c=B.format(b.data);c.notificationBillet.message&&c.notificationBillet.message.length&&(Ra.modalConfig.open=!0,Ra.modalConfig.notificationBillet.open=!0,Ra.modalConfig.notificationBillet.message=c.notificationBillet.message,Z(c.notificationBillet.message))}ba(),W(),i.error([Ra.contractData.contractNumber,"erro na geração do boleto",JSON.stringify(Ka()),JSON.stringify(document.BVDatalayer),JSON.stringify(Ra.calculatedBilling)].join(" - "));try{va("BILLET_BILLING_GENERATE_BILLET_ERROR",D.getCurrentProduct().data.productCode)}catch(d){}Ra.retryGenerateBillet&&!a.disableRetryGenerateBillet&&i.error([Ra.contractData.contractNumber,JSON.stringify(Ka()),JSON.stringify(document.BVDatalayer),"retryGenerateBillet","erro onErrorGeneratedBilling"].join(" - ")),Ra.retryGenerateBillet=!1,wa({type:"boletos",hash:null}),za(),Ra.modalConfig.open=!0,C.getErrors()>1?Ra.modalConfig.errorShowPhone.open=!0:Ra.modalConfig.error.open=!0,b&&500===b.status&&(Ra.modalConfig.open=!1,Ra.modalConfig.error.open=!1),a.$emit(k.SPINNING_STOP)}function ba(){function a(a){p.assessoryData=L.APIToViewModel(a.data),p.assessoryData.contractNumber=Ra.contractData.contractNumber,Ra.assessoryData=p.assessoryData}return Ra.assessoryData||K.get(Ra.contractData.contractNumber).then(a)}function ca(){Ra.calculatedBilling=null,Ra.generatedBillet=null}function da(){Ra.currentProductDetailsService=p,Ra.contractData=D.getCurrentProduct().productDetail,angular.merge(Ra.contractData,D.getCurrentProduct().data),Ra.singleInstallment=p.singleInstallment?p.singleInstallment:null,Ra.onSendBilletEmail=pa,Ra.onOpenPDF=ua,Ra.setDataBillet=wa,ka(),Ra.modalConfig||ia(),Ra.loadingLinkBillet=!1}function ea(){Ra.showFees=!Ra.showFees,_.map(Ra.billetBillingItems,function(a){return a.visible=Ra.showFees,a})}function fa(){function a(a){a&&(Ra.selectedDate=a)}a(Ra.dueDate),Ra.openDatePicker=!0,Ra.dueDate=Ra.selectedDate,Ra.selectedDateFlag=!0,ha()}function ga(){var c;switch(D.getCurrentProduct().data.productCode){case 10:c="personalCredit";break;case 11:c="credit";break;default:c="financing"}a.$emit(k.SPINNING_START),b.go("app.navigation."+c+".anticipateInstallments.list").then(function(){a.$emit(k.SPINNING_STOP)})}function ha(){s.datepickerOptions.minDate=Ra.alternativeDueDates[0].expiryDate,s.datepickerOptions.maxDate=Ra.alternativeDueDates[Ra.alternativeDueDates.length-1].expiryDate,Ra.selectedDate=Ra.selectedDate?Ra.selectedDate:moment(Ra.alternativeDueDates[0].expiryDate).toDate(),Ra.formattedSelectDate=O(Ra.selectedDate),Ra.openModal(Ra.modalConfig.dueDatesAnticipate),a.$broadcast(k.CHECK_DATES,{maxDate:s.datepickerOptions.maxDate})}function ia(){Ra.modalConfig&&Ra.modalConfig.emailAndBankslipSent&&Ra.modalConfig.emailAndBankslipSent.open,Ra.modalConfig&&Ra.modalConfig.emailAndBankslipSentNotUpdated&&Ra.modalConfig.emailAndBankslipSentNotUpdated.open;Ra.modalConfig={confirmationPayment:{open:!1},email:{open:!1,value:""},dueDatesAnticipate:{open:!1,modifierClass:"-datepicker"},emailNotRegister:{open:!1},notEmail:{open:!1,message:""},notificationBillet:{open:!1,message:""},retention:{open:!1},retentionSurvey:{open:!1},error:{open:!1},errorShowPhone:{open:!1},popup:{open:!1},paymentInformation:{open:!1},contactsFound:{open:!1},emailConfirmation:{open:!1},bankslipSent:{open:!1},emailAndBankslipSent:{open:!1},emailAndBankslipSentNotUpdated:{open:!1},emptyData:{open:!1},callCenter:{open:!1}}}function ja(){function a(){Ra.closeModal(Ra.modalConfig.dueDatesAnticipate)}!Ra.openDatePicker&&Ra.dueDate&&(Ra.selectedDate=Ra.dueDate,Ra.openDatePicker=!Ra.openDatePicker),delete Ra.dueDate,Ra.selectedDateFlag=!0,Ra.formattedSelectDate=O(Ra.selectedDate),P(moment(Ra.selectedDate).format("YYYY-MM-DD")).finally(a)}function ka(){function b(a){return Ra.broadcastBlurEvent(a),Ra.isCopied=!0,d.cancel(),va("BILLET_BILLING_COPY_CODE",D.getCurrentProduct().data.productCode)}function c(a){Ra.copyHelperText=!0,Ra.inputIdonError=a}Ra.actionOnCopy=na,Ra.copyHelperText=!1,Ra.inputIdonError=null,Ra.isAcquittance=n.product.isAcquittance,Ra.isCopied=!1,Ra.onSuccess=b,Ra.onError=c,a.$on(k.COPY,function(){Ra.copyHelperText&&Ra.actionOnCopy(Ra.inputIdonError)})}function la(){var a=p.currentProductDetails.paymentSituationCode;Ra.settled=angular.equals(a,v.QUITADO),Ra.currentBillet=o.get(),Ra.broadcastBlurEvent=ma,Ra.currentDueDate=x.format(Ra.currentBillet.dueDate,"@SITE-COMMON-SHORTDATE-MOMENT"),Ra.settled=!0}function ma(b){a.$broadcast(k.BLUR,b)}function na(a){Ra.copyHelperText=!1,Ra.isCopied=!0,d.cancel(),d(function(){Ra.broadcastBlurEvent(a),Ra.isCopied=!1,Ra.inputIdonError=null},2500)}function oa(){function d(){var d=angular.copy(c);angular.merge(d,{installments:sa().installments,selectedDate:moment(sa().dueDate).toDate(),autoGenerateBillet:!0,sendEmailBillet:function(){return sa()}}),a.emailSent=!1,b.go(J.DATA_UPDATE_EDIT,{showField:"email",hideOptIn:!0,isUpdated:Ra.isUpdated||!1,callback:function(a){d.dataUpdateCallback=a&&a.enderecosEletronicos&&a.enderecosEletronicos[0],b.go(h.BILLET_DIGITAL_BILLING,angular.copy(d))}}).then(function(){a.$emit(k.SPINNING_STOP)})}a.$emit(k.SPINNING_START),c.sendEmailBillet=null,Ra.dataUpdateCallback=null,d()}function pa(){return Ra.dataUpdateCallback=null,a.emailSent=!1,ra(),va("BILLET_BILLING_EMAIL",D.getCurrentProduct().data.productCode)}function qa(){return ra(!0)}function ra(b){function c(a,c){b||("object"==typeof c?Ra.modalConfig[a]={open:!0}:(Ra.modalConfig.open=!0,Ra.modalConfig[a]=!0),Ra.isLoaded=!0)}return a.$emit(k.SPINNING_START),Ra.isUpdated=!1,Ra.isAllUpdated=!0,t.get().then(function(d){function e(a){Ra.isUpdated=a&&a.enderecosEletronicosAtualizados}function f(a){Ra.isAllUpdated=a&&a.enderecosAtualizados&&a.enderecosEletronicosAtualizados&&a.telefonesAtualizados}function g(a,b){var c=[];return a.reduce(function(a,d){return a.indexOf(d.infoMask)<0&&(a.push(d.infoMask),c.push({infoMask:d.infoMask,tipo:b,dataAtualizacao:d.dataAtualizacao,id:d.id})),a},[]),c}if(Ra.phoneList=g(d.data.telefones,"CELULAR"),Ra.emailList=d.data.enderecosEletronicos,b?f(d.data):e(d.data),!a.emailSent)if(0===Ra.phoneList.length&&0===Ra.emailList.length)c("emptyData",{});else{if(Ra.isUpdated)return Ra.isLoaded=!0,void c("emailConfirmation",{});c("contactsFound",{})}}).catch(function(){c("error",{})}).finally(function(){a.$emit(k.SPINNING_STOP)})}function sa(){return{contractNumber:Ra.contractData.contractNumber,installments:Ra.calculatedBilling.installments.map(function(a){return{numeroParcela:a.installmentNumber}
}),installmentValue:Ra.calculatedBilling.totalBilletValue,id:Ra.emailList&&Ra.emailList[0]&&Ra.emailList[0].id,dueDate:x.format(Ra.selectedDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function ta(b){function c(){Ra.resetModalConfig(),a.emailSent||qa().then(function(){Ra.modalConfig.bankslipSent={open:!0}}),a.$emit(k.SPINNING_STOP)}function d(b){Ra.resetModalConfig(),Ra.modalConfig.notEmail.open=!0,Ra.modalConfig.notEmail.message=b&&b.data&&b.data.messages[1],a.$emit(k.SPINNING_STOP)}var e=b||sa();return a.$emit(k.SPINNING_START),E.send(e).then(c).catch(d)}function ua(){function a(a){if(j.IS_IE){var b=new g([a.data]);w.saveAs(b,"boleto-cobranca-"+k+"-"+c.hash+".pdf")}else{var d=URL.createObjectURL(a.data),e=0;l.location=d,Ra.popUp.push({tela:l}),null!==Ra.popUp[Ra.popUp.length-1].tela&&angular.forEach(Ra.popUp,function(a){null!==a.tela&&(e+=a.tela.closed?0:1)}),0===e&&(Ra.modalConfig.open=!0,Ra.modalConfig.popup.open=!0)}}function b(){Ra.modalConfig.open=!0,Ra.modalConfig.error.open=!0,i.error([Ra.contractData.contractNumber,JSON.stringify(Ka()),JSON.stringify(document.BVDatalayer),"erro no getPDFCreditService.getPDF"].join(" - "))}var c,f,h,k,l=e.open("","_blank");Ra.loadingLinkBillet=!0,d(function(){c=xa(),f=D.getCurrentProduct().data.productCode,h=va("BILLET_BILLING",f),k=x.format(Ra.selectedDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT"),c.hash&&c.hash.length>2?y.getPDF(c.type,c.hash).then(a).catch(b).finally(function(){Ra.loadingLinkBillet=!1}):(Ra.modalConfig.open=!0,Ra.modalConfig.error.open=!0)},1e3)}function va(b,c,e){var f=r.BVF[b].FINANCING,g="financiamento";return angular.equals(c,z.personalCredit)?(f=r.BVF[b].CREDIT,g="credito pessoal"):angular.equals(c,z.payroll)&&(f=r.BVF[b].PAYROLL,g="consignado"),e&&Ia(e),a.$emit("data-layer-product"),d(function(){q.sendEvent({ID:f,parameters:g})}),f}function wa(a){Qa=a}function xa(){return Qa}function ya(){if(!Ra.modalConfig.retention.open){va("BILLET_BILLING_VIEW_BILLET_RETENTION",D.getCurrentProduct().data.productCode)}Ra.retentionFormList&&Ra.retentionFormList.length?(Ra.modalConfig.retentionSurvey.open=!0,document.BVDatalayer.questionarioCobranca||(document.BVDatalayer.questionarioCobranca={})):Ra.modalConfig.retention.open=!0}function za(){Ra.modalConfig.retention.open=!1,Ra.modalConfig.retentionSurvey.open=!1}function Aa(){var a=Ra.retentionForm.retentionType;if(Ra.retentionForm.clicked)return Ma(a,Ra.retentionForm.textareaInput),za(),angular.merge(document.BVDatalayer.questionarioCobranca,{mensagem:!!Ra.retentionForm.textareaInput||void 0}),!1;if(a){var b=_.find(Ra.retentionFormList,{value:parseInt(a)});Ma(b.inputName||a),ba();var c={showGenerateButton:b.showGenerateButton||!1,showSelectParcels:b.showSelectParcels||!1,successMessage:b.successMessage||"Tudo bem, faremos contato com você em outra data.",showDueDate:b.showDueDate||!1,showAssessoryLink:b.showAssessoryLink||!1,showForm:b.showForm||!1};Ra.retentionForm.options=c,Ra.retentionForm.clicked=!0,angular.merge(document.BVDatalayer.questionarioCobranca,{idPesquisaCobranca:a})}else Ra.retentionForm.errorEmpty=!0;jQuery(document).trigger("BVCustomPageView",document.BVDatalayer)}function Ba(){ia(),Ra.modalConfig.popup.open=!1}function Ca(){}function Da(){ia(),S(!0)}function Ea(){var b=D.getCurrentProduct().data.contractNumber;a.billetbilling&&a.billetbilling.contracts?(_.remove(a.billetbilling.contracts,{contractNumber:b}),a.billetbilling.contracts.push({contractNumber:b,isRetention:!0})):a.billetbilling={contracts:[]},a.billetbilling.contracts.push({contractNumber:b,isRetention:!0})}function Fa(){var b=0,c=0;document.addEventListener("mousemove",function(a){b=a.clientX,c=a.clientY}),$(document).on("mouseleave",function(b){c<100&&b.clientY<0&&a.$emit("register-billing-retention")})}function Ga(){Ra.modalConfig.open=!0,Ra.modalConfig.paymentInformation.open=!0}function Ha(a){switch(a){case"Q":return"QC";case"P":return"PA";case"A":return"AP"}}function Ia(a){if(a)try{angular.merge(document.BVDatalayer.userInfo.profile,a)}catch(b){}}function Ja(){Ra.closeRetention(),Ra.getDueDates()}function Ka(){try{return{tipoCobranca:Ra.contractData&&Ra.contractData.chargeType.description,statusContrato:Ra.contractData&&Ra.contractData.contractStatus.description,situacaoFinanceira:Ra.contractData&&Ra.contractData.paymentSituationCode,proximoPagamento:JSON.stringify(Ra.contractData.nextDueDate),currentBillet:Ra.currentBillet}}catch(a){}return{}}function La(){if((Ra.isAcquittance||Ra.isAcquittanceContract)&&M.isInsuranceLender){var a=M.getDataBank();if(!a.numeroAgencia||!a.numeroConta||!a.numeroBanco)return!1;M.sendBankData(a).then().catch(function(a){console.log("Ocorreu um erro ao salvar os dados bancarios: ",a)})}}function Ma(a,b){var c=document.BVDatalayer&&document.BVDatalayer.userInfo&&document.BVDatalayer.userInfo.profile&&document.BVDatalayer.userInfo.profile.visitorId;jQuery.post("https://contato.bv.com.br/pub/rf",{_ri_:"X0Gzc2X%3DYQpglLjHJlTQGNcwi6SFRiYbblOG5WIAYCYzazgsaePm2Fzf47UtOVwjpnpgHlpgneHmgJoXX0Gzc2X%3DYQpglLjHJlTQGsXYum60k8zf7BzbMG0WzcL4RlzazgsaePm2Fzf47UtO",VISITOR_ID:c,MOTIVO_ABANDONO_FORM:a,DESCRICAO_ABANDONO_FORM:b},function(){})}function Na(a){b.go(J.DATA_UPDATE_EDIT,{showField:a})}function Oa(){ia(),b.go(l.HOME)}function Pa(){b.go(J.DATA_UPDATE_EDIT),d(function(){b.go(J.DATA_UPDATE_EDIT)},100)}var Qa,Ra=this,Sa=!1;N()}a.$inject=["$rootScope","$state","$stateParams","$timeout","$window","$filter","Blob","bvfRoutes","bvLogService","commonConstants","commonEvents","commonRoutes","contractData","creditProductsService","currentBilletDataService","currentProductDetailsService","dataLayerFactory","dataLayerSendEventCode","datepickerManagerService","dataUpdateService","issueSingleBilletService","financialSituationCode","FileSaver","formatDateFactory","getPDFCreditService","mainProductCodes","modalHelpersService","obtainDataBilletAccordFactory","obtainDataBilletAccordService","productDetailService","sendBilletEmailService","simulateBilletFinancingAccordFactory","simulateBilletFinancingAccordService","simulateOnlyFinancingBilletService","userInfoService","userRoutes","obtainAdvisoryDataService","advisoryDataFactory","insuranceRefundService"],angular.module("internetBanking.credit").controller("BilletBillingController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){x.steps=m.getCurrent()[0],x.showSliderMenu=x.contracts[0].prazoMin!==x.contracts[0].prazoMax,b.$on("refresh-renegotiation-session",function(){e(function(){l.refresh(x.contractNumber)},1e4)}),e.cancel(b.refreshRenegCancel),w()}function p(){try{angular.merge(y,{vehicles:{model:x.contracts&&x.contracts[0].title}}),document.BVDatalayer.reneg||(document.BVDatalayer.reneg={}),angular.merge(document.BVDatalayer.reneg,y),f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|escolha-uma-de-nossas-recomendacoes"})}catch(a){}}function q(a){angular.merge(document.BVDatalayer.reneg,{prazoMin:x.contracts[0].prazoMin,prazoMax:x.contracts[0].prazoMax,valorPrincipal:a.valorPrincipal,prazo:a.listaCalculos[0].prazo,valorParcela:a.listaCalculos[0].valorParcela,valorTotalRenegociado:a.listaCalculos[0].valorTotalRenegociado,taxaCET:a.listaCalculos[0].taxaCET,taxaJurosDaOperacao:a.listaCalculos[0].taxaJurosDaOperacao,valorIOF:a.listaCalculos[0].valorIOF})}function r(){var a=_.find(x.contracts[0].listaOfertasSugeridas,{selected:!0});a&&(q(a),c.go(g.RENEGOTIATION_SUCCESS,{offer:a,contractNumber:x.contracts[0].contractNumber,contract:x.contracts[0],inputBillet:b.renegInputBillet,page:b.renegInputBillet?"input":"value"}))}function s(a,b){a.stopPropagation(),delete x.installmentSelected,x.contracts[0].listaOfertasSugeridas.map(function(a){a.selected=!1,a.$$hashKey===b.$$hashKey&&(a.selected=!0)}),b.selected=!0,x.installmentSelected=b,angular.element(".main_content__inner").animate({scrollTop:5e3},300)}function t(a){x.showDetails[a]=!x.showDetails[a]}function u(a,b,c){a.showDetails?a.showDetails=!1:a.showDetails=!0,x.installmentChecked=a.showDetails,c.stopPropagation()}function v(){var a=k.formatRequestSimulate(x.contracts[0],{carencia:x.contracts[0].carenciaMin});c.go(g.RENEGOTIATION_SLIDER,{contract:x.contracts[0],payloadSimulate:a}).then(function(a){})}function w(){!angular.isDefined(b.refreshRenegCount)||isNaN(b.refreshRenegCount)?b.refreshRenegCount=0:b.refreshRenegCount=b.refreshRenegCount+1,b.refreshRenegCount<8&&(b.refreshRenegCancel=e(function(){b.$emit("refresh-renegotiation-session"),e(w,1e3)},1e5+Math.floor(4e4*Math.random())))}var x=this,y={};if(x.checkIt=s,x.onChooseOffer=r,x.onToggleDetails=t,x.showDetails=u,x.gotoSlider=v,x.offerDetails=[],x.contracts=[],x.contractNumber=j.getCurrentProduct().data.contractNumber,!d.contract)return void c.go(g.RENEGOTIATION_CHOOSE);x.contracts.push(d.contract),p(),x.isLoaded=!0,o(),e(function(){b.$emit("change-sidebar-css")},0),b.$on("$locationChangeStart",function(){b.$emit("reset-sidebar-css")})}a.$inject=["$filter","$rootScope","$state","$stateParams","$timeout","dataLayerFactory","financingRoutes","obtainProductDetailsService","obtainProductDetailsFactory","productDetailService","renegotiationFactory","renegotiationService","renegotiationStepsFactory","userInfoService"],angular.module("internetBanking.credit").controller("RenegotiationController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){if(E.steps=n.getCurrent()[0],E.hasChangeValue=!0,E.hasExtendPayment=!0,E.hasChangeDueDate=!0,E.hasInputValue=!0,E.isPendingInstalments=!0,E.tapumeEnabled)try{f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|carregando-ofertas"})}catch(a){}}function r(){try{angular.merge(F,{amountContracts:E.contracts&&E.contracts.length,vehicles:{model:E.contracts&&E.contracts[0].title},vehicleName:E.contracts&&E.contracts[0].title,installmentPayment:E.contracts&&E.contracts[0].installmentsQuantity+";"+E.contracts[0].installmentValue,dueDate:E.contracts&&moment(E.contracts[0].nextDueDate.value).format("DD/MM/YYYY")}),F.contracts=E.contracts,document.BVDatalayer.reneg||(document.BVDatalayer.reneg={}),angular.merge(document.BVDatalayer.reneg,F),document.BVDatalayer.formInfo||(document.BVDatalayer.formInfo={})}catch(a){}f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|escolha-uma-opcao"})}function s(){setTimeout(function(){E.isLoaded||(E.isLoaded=!0,E.hasRenegOptions=E.isOverdue=!1,E.errorElegibility=!0)},12e4);var a=k.getCurrentProduct().data.contractNumber,b=_.find(o.getProductsListCache(),{contractNumber:a});return D={},m.search(a).then(function(c){var d=l.formatConsult(c.data);return angular.merge(D,b),angular.merge(D,d.contractStatusList[0]),m.getElegibility(a).then(function(a){var b=l.formatElegibility(a.data);angular.merge(D,b[0]),E.isLoaded=!0,E.hasRenegOptions=b&&"OK1"===b[0].codigoRetorno,E.isOverdue=!!(b&&E.hasRenegOptions&&b[0].listaParcelasEntrada.length&&b[0].listaParcelasEntrada[0]),t(b[0]);try{E.hasRenegOptions?f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|tapume-ha-ofertas-disponiveis"}):f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|tapume-nao-ha-ofertas-disponiveis"})}catch(c){}}).catch(function(a){E.isLoaded=!0,E.hasRenegOptions=E.isOverdue=!1,E.errorElegibility=!0;try{f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|tapume-servico-indisponivel"})}catch(b){}})}).catch(function(a){E.isLoaded=!0,E.hasRenegOptions=E.isOverdue=!1,E.errorElegibility=!0;try{f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|tapume-servico-indisponivel"})}catch(b){}})}function t(a){E.hasChangeValue=a.prazoMin!==a.prazoMax,E.hasExtendPayment=a.carenciaMax>=30,E.hasChangeDueDate=a.carenciaMin<30&&a.carenciaMax>=30}function u(){try{if(sessionStorage.getItem("reneg-simulator-campaign",!0)){var a=l.formatRequestSimulate(E.contracts[0],{carencia:E.contracts[0].carenciaMin});c.go(h.RENEGOTIATION_SLIDER,{contract:E.contracts[0],payloadSimulate:a})}else c.go(h.RENEGOTIATION_VALUE,{contract:E.contracts[0]})}catch(b){}}function v(){var a=l.formatRequestSimulate(E.contracts[0],{carencia:E.contracts[0].carenciaMin,prazoMin:E.contracts[0].prazoMin,prazoMax:E.contracts[0].prazoMin});c.go(h.RENEGOTIATION_EXTEND,{contract:E.contracts[0],payloadSimulate:a})}function w(){var a=l.formatRequestSimulate(E.contracts[0],{carencia:E.contracts[0].carenciaMin,prazoMin:E.contracts[0].prazoMin,prazoMax:E.contracts[0].prazoMin});c.go(h.RENEGOTIATION_DATE,{contract:E.contracts[0],payloadSimulate:a})}function x(){c.go(h.RENEGOTIATION_INPUT,{contract:E.contracts[0]})}function y(){b.tapumeRenegotiationCached=!0,E.tapumeEnabled=!1;try{f.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|escolha-uma-opcao"})}catch(a){}}function z(){return g.get().then(function(a){0===a.data.telefones.length&&0===a.data.enderecosEletronicos.length&&(E.blockedDataUpdate=!0,E.isLoaded=!0,E.hasRenegOptions=!1,b.$emit("open-modal-data-update-empty"))})}function A(){c.go(h.HOME)}function B(){E.tapumeEnabled=!1,A()}function C(){c.go(p.DATA_UPDATE)}var D,E=this,F={};E.tapumeEnabled=!b.tapumeRenegotiationCached,E.isLoaded=!1,E.hasRenegOptions=!0,E.isOverdue=!1,E.blockedDataUpdate=!1,E.changeValue=u,E.extendPayment=v,E.changeDueDate=w,E.goToInputValue=x,E.openRenegotiation=y,E.gotToHome=A,E.gotoDataUpdate=C,E.closeTapume=B,E.offerDetails=[],E.contracts=[],E.contractNumber=k.getCurrentProduct().data.contractNumber,z().finally(function(){E.blockedDataUpdate||s().then(function(){i.get(E.contractNumber).then(function(a){var b=j.APIToViewModel(a.data);angular.merge(D,b),E.contracts.push(D),r()})})}),q(),d(function(){b.$emit("change-sidebar-css")},0),b.$on("$locationChangeStart",function(){b.$emit("reset-sidebar-css")})}a.$inject=["$filter","$rootScope","$state","$timeout","$stateParams","dataLayerFactory","dataUpdateService","financingRoutes","obtainProductDetailsService","obtainProductDetailsFactory","productDetailService","renegotiationFactory","renegotiationService","renegotiationStepsFactory","userInfoService","userRoutes"],angular.module("internetBanking.credit").controller("RenegotiationChooseController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.go(i.RENEGOTIATION_CHOOSE)}function n(a,b){var d={prazoMin:y.contracts[0].prazoMin,prazoMax:y.contracts[0].prazoMin,carencia:a||y.contracts[0].carenciaMin};return c.$emit(e.SPINNING_START),p(d).then(function(){b&&o(),c.$emit(e.SPINNING_STOP)}).catch(function(){c.$emit(e.SPINNING_STOP)})}function o(){var c=angular.copy(y.contracts[0]);a.go(i.RENEGOTIATION_SUCCESS,{offer:y.dataSimulation.listaCalculos[0],contractNumber:y.contracts[0].contractNumber,contract:angular.merge(c,y.dataSimulation),page:b.page})}function p(a){var b=k.formatRequestSimulate(y.contracts[0],a);return l.simulate(b).then(function(a){var b=k.formatSimulate(a.data);y.dataSimulation=b,y.dueDate=moment(y.dataSimulation.dataPrimeiroVencimento,"YYYY-MM-DD").format("DD/MM/YYYY"),t()}).catch(function(){y.modalConfig.open=!0,y.modalConfig.error=!0})}function q(){y.modalConfig={dueDatesAnticipate:{open:!1,modifierClass:"-datepicker"},open:!1,error:!1}}function r(){a.go(i.HOME)}function s(){try{var a;a="date"===b.page?"BV|AL|campanha|renegociacao|segunda-fase|alterar-dia-pagamento-parcelas":"BV|AL|campanha|renegociacao|segunda-fase|prorrogar-pagamento",document.BVDatalayer.reneg||(document.BVDatalayer.reneg={}),angular.merge(document.BVDatalayer.reneg,{dueDate:y.dueDate}),document.BVDatalayer.internalCampaign=a,f.customPageView({pageName:a})}catch(c){}}function t(){angular.merge(document.BVDatalayer.reneg,{dataBaseCarencia:moment(y.contracts[0].dataBaseCarencia,"YYYY-MM-DD").format("DD/MM/YYYY"),dueDate:y.dueDate})}function u(){n(null,!1).then(function(){if(y.alternativeDueDates)return x(),y.datePickerOptions=h.datepickerOptions,y.openModal(y.modalConfig.dueDatesAnticipate),h.leftDisabled=!1,h.leftArrowDisabled=!1,h.rightArrowDisabled=!1,h.rightDisabled=!1,void c.$broadcast(e.CHECK_DATES,{maxDate:h.datepickerOptions.maxDate})})}function v(){if(y.selectedDateFlag=!0,!y.formattedSelectDate)return!1;n(_.findIndex(y.alternativeDueDates,{expiryDate:y.selectedDate})+y.contracts[0].carenciaMin,!0).then(function(){y.formattedSelectDate=moment(y.selectedDate).format("DD/MM/YYYY")}),y.closeModal(y.modalConfig.dueDatesAnticipate)}function w(a){if(y.alternativeDueDates){return!y.alternativeDueDates.filter(function(b){var c=moment(b.expiryDate).format("DD/MM/YYYY");return angular.equals(c,moment(a).format("DD/MM/YYYY"))}).length}}function x(){h.datepickerOptions.minDate=y.alternativeDueDates[0].expiryDate,h.datepickerOptions.maxDate=y.alternativeDueDates[y.alternativeDueDates.length-1].expiryDate,y.selectedDate=y.selectedDateFlag?y.selectedDate:y.alternativeDueDates[0].expiryDate,y.openDatePicker=!0,y.selectedDateFlag=!0}var y=this;if(y.showList=m,y.onChangeDate=n,y.goToSuccess=o,y.resetModal=q,y.gotoChoose=r,y.contracts=[],y.getDueDates=u,y.closeChooseDate=v,y.datePickerOptions=h.datepickerOptions,y.disableInvalidDates=w,h.datepickerOptions.minDate=moment(),h.datepickerOptions.maxDate=moment(),y.openModal=g.openModal,y.closeModal=g.closeModal,q(),y.contractNumber=j.getCurrentProduct().data.contractNumber,b.contract){y.contracts.push(b.contract),y.dataSimulation=b.simulateRenegotiation||{dataBaseCarencia:y.contracts[0].dataBaseCarencia},y.dueDate=moment(y.dataSimulation.dataBaseCarencia,"YYYY-MM-DD").format("DD/MM/YYYY"),y.alternativeDueDates=[];for(var z=y.contracts[0].carenciaMax-y.contracts[0].carenciaMin,A=0;A<=z;A++)y.alternativeDueDates.push({expiryDate:moment(y.contracts[0].dataCarenciaMin,"YYYY-MM-DD").add(A,"days").toDate()});y.alternativeDueDates.length||y.alternativeDueDates.push({expiryDate:moment(y.contracts[0].dataCarenciaMin,"YYYY-MM-DD").toDate()}),y.formattedSelectDate=moment(y.alternativeDueDates[0].expiryDate).format("DD/MM/YYYY"),s()}else console.log("Contrato não localizado",b),a.go(i.REGULARIZATION_CHOOSE);d(function(){c.$emit("change-sidebar-css")},0),c.$on("$locationChangeStart",function(){c.$emit("reset-sidebar-css")})}a.$inject=["$state","$stateParams","$rootScope","$timeout","commonEvents","dataLayerFactory","modalHelpersService","datepickerManagerService","financingRoutes","productDetailService","renegotiationFactory","renegotiationService"],angular.module("internetBanking.credit").controller("RenegotiationExtendController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(){q.modalConfig={alternativeDueDate:{open:!1,modifierClass:"-is-assessory"},open:!1,error:!1}}function l(){b.go(f.REGULARIZATION_CHOOSE)}function m(b){a.$emit(e.SPINNING_START);var c={numeroContrato:q.contractNumber,parcelas:b.map(function(a){return{numeroParcela:a.numeroParcela}}),dataVencimento:moment(q.dueDate,"DD/MM/YYYY").format("YYYY-MM-DD"),codigoSituacaoFinanceira:14};return i.post(c).then(function(a){q.billetDataSimulated=h.format(a.data);try{j.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|inadimplente|valor-da-entrada|sucesso-simulacao"})}catch(b){}}).catch(function(){k(),q.modalConfig.open=!0,q.modalConfig.error=!0;try{j.customPageView({pageName:"BV|AL|campanha|renegociacao|segunda-fase|inadimplente|valor-da-entrada|erro-simulacao"})}catch(a){}}).finally(function(){a.$emit(e.SPINNING_STOP)})}function n(){var c=angular.copy(q.contracts[0]);a.renegInputBillet=q.billetDataSimulated,a.renegInputPage=!0,b.go(f.RENEGOTIATION_VALUE,{contract:angular.merge(c,q.dataSimulation)})}function o(){return q.moreDetails=!q.moreDetails,!1}function p(){try{var a="BV|AL|campanha|renegociacao|segunda-fase|inadimplente|valor-da-entrada";document.BVDatalayer.reneg||(document.BVDatalayer.reneg={}),angular.merge(document.BVDatalayer.reneg,{installmentsLength:q.contracts[0].listaParcelasEntrada.length,dueDate:q.dueDate}),document.BVDatalayer.internalCampaign=a,j.customPageView({pageName:a})}catch(b){}}var q=this;q.showList=l,q.goToSuccess=n,q.showDetails=o,q.resetModal=k,q.contracts=[],q.moreDetails=!1,q.contractNumber=g.getCurrentProduct().data.contractNumber,q.dataSimulation=c.simulateRenegotiation,k(),c.contract&&q.contracts.push(c.contract),c.contract&&q.contracts[0].listaParcelasEntrada?(q.contracts.push(c.contract),q.dueDate=moment(q.contracts[0].dataVenciPagEntrada,"YYYY-MM-DD").format("DD/MM/YYYY"),p(),q.contracts[0].listaParcelasEntrada&&q.contracts[0].listaParcelasEntrada[0]&&m(q.contracts[0].listaParcelasEntrada)):l(),d(function(){a.$emit("change-sidebar-css")},0),a.$on("$locationChangeStart",function(){a.$emit("reset-sidebar-css")})}a.$inject=["$rootScope","$state","$stateParams","$timeout","commonEvents","financingRoutes","productDetailService","simulateBilletFinancingAccordFactory","simulateBilletFinancingAccordService","dataLayerFactory"],angular.module("internetBanking.credit").controller("RenegotiationInputController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){var b=k.formatRequestSimulate(E.contracts[0],a);return l.simulate(b).then(function(a){var b=k.formatSimulate(a.data);E.dataSimulation=b,s(),E.nextDatePayment=moment(E.dataSimulation.dataPrimeiroVencimento,"YYYY-MM-DD").format("DD/MM/YYYY"),E.dueDate=moment(E.dataSimulation.dataPrimeiroVencimento,"YYYY-MM-DD").format("DD"),t()}).catch(function(a){u()})}function n(){E.hasPaymentDetails=!E.hasPaymentDetails}function o(){E.contracts[0].prazoMax>E.simulation.chosenInstallment&&(E.simulation.chosenInstallment=E.simulation.chosenInstallment+1),s()}function p(){E.contracts[0].prazoMin<E.simulation.chosenInstallment&&(E.simulation.chosenInstallment=E.simulation.chosenInstallment-1),s()}function q(){if(E.offer){var c=E.contracts[0];y(),b.go(h.RENEGOTIATION_SUCCESS,{offer:E.offer,contractNumber:E.contracts[0].contractNumber,contract:angular.merge(c,E.dataSimulation),inputBillet:a.renegInputBillet,page:a.renegInputBillet?"input":"value"})}}function r(a){return m({carencia:a,prazoMin:E.contracts[0].prazoMin,prazoMax:E.contracts[0].prazoMax})}function s(){E.offer=_.find(E.dataSimulation.listaCalculos,{prazo:E.simulation.chosenInstallment})}function t(){E.isChangingDate=E.contracts[0].nextDueDate.dateLabel.slice(0,2)!==E.dueDate}function u(){b.go(h.REGULARIZATION_CHOOSE)}function v(){b.go(h.RENEGOTIATION_VALUE,{contract:E.contracts[0]})}function w(){!angular.isDefined(a.refreshRenegCount)||isNaN(a.refreshRenegCount)?a.refreshRenegCount=0:a.refreshRenegCount=a.refreshRenegCount+1,a.refreshRenegCount<8&&(a.refreshRenegCancel=d(function(){a.$emit("refresh-renegotiation-session"),d(w,1e3)},1e5+Math.floor(4e4*Math.random())))}function x(){try{var a="BV|AL|campanha|renegociacao|segunda-fase|escolha-do-seu-jeito";document.BVDatalayer.internalCampaign=a,f.customPageView({pageName:a})}catch(b){}}function y(){angular.merge(document.BVDatalayer.reneg,{prazo:E.offer.prazo,valorParcela:E.offer.valorParcela,prazoMin:E.contracts[0].prazoMin,prazoMax:E.contracts[0].prazoMax,totalSemReneg:E.dataSimulation.valorPrincipal,totalComReneg:E.offer.valorTotalRenegociado,taxaCET:E.offer.taxaCET,taxaJurosDaOperacao:E.offer.taxaJurosDaOperacao,valorIOF:E.offer.valorIOF,paymentDate:E.nextDatePayment})}function z(){if(E.alternativeDueDates)return C(),E.datePickerOptions=g.datepickerOptions,E.openModal(E.modalConfig.dueDatesAnticipate),g.leftDisabled=!1,g.leftArrowDisabled=!1,g.rightArrowDisabled=!1,g.rightDisabled=!1,void a.$broadcast(e.CHECK_DATES,{maxDate:g.datepickerOptions.maxDate})}function A(){if(E.selectedDateFlag=!0,!E.nextDatePayment)return!1;var b=_.findIndex(E.alternativeDueDates,{expiryDate:E.selectedDate}),c=b+E.contracts[0].carenciaMin;a.$emit(e.SPINNING_START),r(c).then(function(){E.closeModal(E.modalConfig.dueDatesAnticipate)}).finally(function(){a.$emit(e.SPINNING_STOP)})}function B(a){if(E.alternativeDueDates){return!E.alternativeDueDates.filter(function(b){var c=moment(b.expiryDate).format("DD/MM/YYYY");return angular.equals(c,moment(a).format("DD/MM/YYYY"))}).length}}function C(){g.datepickerOptions.minDate=E.alternativeDueDates[0].expiryDate,g.datepickerOptions.maxDate=E.alternativeDueDates[E.alternativeDueDates.length-1].expiryDate,E.selectedDate=E.selectedDateFlag?E.selectedDate:E.alternativeDueDates[0].expiryDate,E.openDatePicker=!0,E.selectedDateFlag=!0}function D(){E.alternativeDueDates=[];for(var a=E.contracts[0].carenciaMax-E.contracts[0].carenciaMin,b=0;b<=a;b++)E.alternativeDueDates.push({expiryDate:moment(E.contracts[0].dataCarenciaMin,"YYYY-MM-DD").add(b,"days").toDate()});E.alternativeDueDates||E.alternativeDueDates.push({expiryDate:moment(E.contracts[0].dataCarenciaMin,"YYYY-MM-DD").toDate()})}var E=this;E.simulation={},E.contracts=[],E.getDueDates=z,E.closeChooseDate=A,E.datePickerOptions=g.datepickerOptions,E.disableInvalidDates=B,g.datepickerOptions.minDate=moment(),g.datepickerOptions.maxDate=moment(),E.openModal=i.openModal,E.closeModal=i.closeModal,E.modalConfig={dueDatesAnticipate:{open:!1,modifierClass:"-datepicker"},open:!1},E.changeInstallment=s,E.handleToggle=n,E.gotoChoose=u,E.gotoValue=v,E.sliderIncrease=o,E.sliderDecrease=p,E.onChooseOffer=q,E.onChangeDate=r,E.hasPaymentDetails=!1,E.contractNumber=j.getCurrentProduct().data.contractNumber,E.dataSimulation=c.simulateRenegotiation,c.contract?(E.contracts.push(c.contract),E.nextDatePayment=moment(E.dataSimulation.dataPrimeiroVencimento,"YYYY-MM-DD").format("DD/MM/YYYY"),E.dueDate=moment(E.dataSimulation.dataPrimeiroVencimento,"YYYY-MM-DD").format("DD"),t(),D(),E.simulation={chosenInstallment:E.contracts[0].prazoMax},E.contracts[0].prazoMin===E.contracts[0].prazoMax&&u(),s(),d.cancel(a.refreshRenegCancel),w(),x()):u(),d(function(){a.$emit("change-sidebar-css")},0),a.$on("$locationChangeStart",function(){a.$emit("reset-sidebar-css")})}a.$inject=["$rootScope","$state","$stateParams","$timeout","commonEvents","dataLayerFactory","datepickerManagerService","financingRoutes","modalHelpersService","productDetailService","renegotiationFactory","renegotiationService"],angular.module("internetBanking.credit").controller("RenegotiationSliderController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){u.modalConfig={open:!1,success:!1,error:!1,canceledExpiredTime:!1,canceledNonPayment:!1,unmappedStatusCode:!1,nonCachedModal:!0}}function j(){var a=f.getCurrentProduct().data.contractNumber;g.search(a).then(function(a){var b=h.formatConsult(a.data);u.currentStatusCode=b.contractStatusList[0].statusCode,u.contract=b.contractStatusList[0],k(u.currentStatusCode),l(u.currentStatusCode)||m(u.currentStatusCode),p(u.currentStatusCode),u.contracts=[{isNewRenegotiation:!0,installmentsQuantity:u.contract.installmentsQuantity,installmentValue:u.contract.installmentValue,nextDueDate:u.contract.nextDueDate,title:f.getCurrentProduct().data.title,contractNumber:u.contract.contractNumber}],u.isAssessory=14===f.getCurrentProduct().data.paymentSituationCode,t()})}function k(a){switch(a){case 1:u.statusCode.chosenConditions=!0;break;case 2:u.statusCode.awaitingSignature=!0;break;case 3:u.statusCode.signed=!0;break;case 4:u.statusCode.renegotiated=!0;break;case 5:u.statusCode.canceledExpiredTime=!0,u.modalConfig.open=!0,u.modalConfig.canceledExpiredTime=!0;break;case 6:u.statusCode.renegotiationAlreadyStarted=!0;break;case 10:u.statusCode.signed=!0;break;case 13:u.statusCode.awaitingPayment=!0;break;case 14:u.statusCode.paid=!0;break;case 15:u.statusCode.canceledNonPayment=!0,u.modalConfig.open=!0,u.modalConfig.canceledNonPayment=!0;break;default:u.modalConfig.unmappedStatusCode=!0,u.modalConfig.open=!0}}function l(a){return[5,6,7,8,9,11,15].indexOf(a)>-1}function m(a){if(10===a&&(u.breadcrumb[2].stepId=10),13===a){var b={stepId:13,label:"Pagamento do boleto da entrada",currentStep:null};u.breadcrumb.splice(1,0,b)}if(14===a){var b={stepId:14,label:"Pagamento do boleto da entrada",currentStep:null};u.breadcrumb.splice(1,0,b)}for(var c=0;c<u.breadcrumb.length;c++){if(13===a)return void(u.breadcrumb[c].currentStep=!0);if(14===a)return u.breadcrumb[c].currentStep=!1,c++,void(u.breadcrumb[c].currentStep=!0);if(u.breadcrumb[c].stepId===a)return void(u.breadcrumb[c].currentStep=!0);u.breadcrumb[c].currentStep=!1}}function n(){try{sessionStorage.getItem(document.BVDatalayer.userInfo.profile.visitorId,!0)?u.hasDisclaimerCache=!0:u.hasDisclaimerCache=!1}catch(a){}}function o(){try{sessionStorage.setItem(document.BVDatalayer.userInfo.profile.visitorId,!0),u.hasDisclaimerCache=!0}catch(a){}}function p(a){var b="reneg-modal-"+a+"-"+document.BVDatalayer.userInfo.profile.visitorId;localStorage.getItem(b,!0)&&(u.modalConfig.nonCachedModal=!1)}function q(){var a="reneg-modal-"+u.currentStatusCode+"-"+document.BVDatalayer.userInfo.profile.visitorId;localStorage.setItem(a,!0),u.modalConfig.nonCachedModal=!1}function r(){q(),b.go(e.HOME)}function s(){q(),b.go(e.RENEGOTIATION_CHOOSE)}function t(){try{var a="BV|AL|campanha|renegociacao|segunda-fase|renegociacao-em-andamento";document.BVDatalayer.reneg||(document.BVDatalayer.reneg={}),angular.merge(document.BVDatalayer.reneg,{statusRequest:u.currentStatusCode}),document.BVDatalayer.internalCampaign=a,d.customPageView({pageName:a})}catch(b){}}var u=this;u.hasDisclaimerCache=!0,u.closeDisclaimer=o,u.goToHome=r,u.goToChoose=s,u.currentStatusCode=null,delete a.tapumeRenegotiationCached,delete a.renegInputBillet,delete a.renegInputPage,i(),j(),t(),u.statusCode={chosenConditions:!1,awaitingSignature:!1,signed:!1,renegotiated:!1,canceledExpiredTime:!1,renegotiationAlreadyStarted:!1,awaitingPayment:!1,paid:!1,canceledNonPayment:!1},u.breadcrumb=[{stepId:1,label:"Condições escolhidas",currentStep:null},{stepId:2,label:"Pedido enviado",currentStep:null},{stepId:3,label:"Pedido em andamento",currentStep:null},{stepId:4,label:"Renegociação concluída",currentStep:null}],c(function(){n()},4e3),c(function(){a.$emit("change-sidebar-css")},0),a.$on("$locationChangeStart",function(){a.$emit("reset-sidebar-css")})}a.$inject=["$rootScope","$state","$timeout","dataLayerFactory","financingRoutes","productDetailService","renegotiationService","renegotiationFactory"],angular.module("internetBanking.credit").controller("RenegotiationStatusController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){angular.element(".main_content__inner, .main_wrap").scrollTop(0),J.user=A(),C(),t(),u(),H(),J.statusForm={submit:!1,edit:!1,isEmailInvalid:!1,isPhoneInvalid:!1},J.contactsConfirmed=!1,J.loadedDataUpdateService=!1;try{c.current.data.breadcrumb[2].value="Seus dados"}catch(a){}J.phonePattern=m.PHONE_V2,l.type("spinner"),b.contract&&b.offer||c.go(j.RENEGOTIATION_CHOOSE),J.contracts=[],J.contracts.push(b.contract),J.contracts[0].idOfertaSimulacao=b.offer.idOfertaSimulacao,J.billetDataSimulated=b.inputBillet,J.dataVencimentoValorEntrada=moment(J.contracts[0].dataVenciPagEntrada,"YYYY-MM-DD").format("DD/MM/YYYY"),b.offer.listaCalculos?(J.contracts[0].installmentsQuantity=b.offer.listaCalculos[0].prazo,J.contracts[0].installmentValue=b.offer.listaCalculos[0].valorParcela,J.calculos={valorIOF:b.offer.listaCalculos[0].valorIOF,taxaCET:b.offer.listaCalculos[0].taxaCET},J.contracts[0].nextDueDate=moment(b.offer.dataPrimeiroVencimento,"YYYY-MM-DD").format("DD/MM/YYYY")):(J.contracts[0].installmentsQuantity=b.offer.prazo,J.contracts[0].installmentValue=b.offer.valorParcela,J.calculos={valorIOF:b.offer.valorIOF,taxaCET:b.offer.taxaCET},J.contracts[0].nextDueDate=J.contracts[0].dataPrimeiroVencimento.split("-").reverse().join("/")),J.diffActualInstallmentValue=Math.abs(J.contracts[0].installmentValue-J.contracts[0].listInstallments[0].installmentValue),J.contracts[0].isNewRenegotiation=!0,J.isValuePage=angular.equals(b.page,"value"),J.isDatePage=angular.equals(b.page,"date"),J.isExtendPage=angular.equals(b.page,"extend"),J.isInputPage=!!e.renegInputPage,J.isInputPage&&(b.page="input");try{angular.merge(K,{dueDateOption:J.contracts[0].nextDueDate,chooseOption:J.contracts[0].installmentsQuantity+";"+J.contracts[0].installmentValue,financingValue:b.offer.valorPrincipal,valorSaldoRenegociar:b.offer.valorSaldoRenegociar,valorIOF:J.calculos.valorIOF,
taxaCET:J.calculos.taxaCET,offer:b.offer}),document.BVDatalayer.reneg||(document.BVDatalayer.reneg={}),angular.merge(document.BVDatalayer.reneg,K),document.BVDatalayer.formInfo||(document.BVDatalayer.formInfo={}),i.customPageView({pageName:"bv|area-logada|campanha|renegociacao|finalize-sua-escolha"})}catch(a){}}function t(){J.notFoundContact=w,J.saveContacts=x,J.view={dataListForm:{phoneList:"",emailList:""}}}function u(){return J.errorDataUpdateService=!1,J.loadedDataUpdateService=!1,h.get().then(function(a){J.view.dataListForm.phoneList=J.phoneList=h.removeDuplicatedData(a.data.telefones,"CELULAR"),J.view.dataListForm.emailList=J.emailList=a.data.enderecosEletronicos,v(a.data),J.loadedDataUpdateService=!0,J.errorDataUpdateService=!1}).catch(function(){J.errorDataUpdateService=!0})}function v(a){J.isUpdated=a&&a.enderecosEletronicosAtualizados&&a.telefonesAtualizados}function w(a){"email"===a?J.emailList=[]:"phone"===a&&(J.phoneList=[])}function x(a){if(!a||!a.$valid)return void(J.statusForm.submit=!0);if(J.isUpdated&&J.emailList.length&&J.phoneList.length){i.customPageView({pageName:"bv|area-logada|campanha|renegociacao|contatos-confirmados"}),J.contactsConfirmed=!0;try{c.current.data.breadcrumb[2].value="Finalize sua escolha"}catch(b){}}else{i.customPageView({pageName:"bv|area-logada|campanha|renegociacao|redirecionando-atualizacao-cadastral"});z(y(a))}}function y(a){return{emailList:a.emailList&&a.emailList.$modelValue,email:a.email&&a.email.$modelValue,phoneList:a.phoneList&&a.phoneList.$modelValue,phone:a.phone&&a.phone.$modelValue}}function z(a){e.$emit(g.SPINNING_START),e.renegotiationService={params:b,stateCurrentName:c.current.name},c.go(k.DATA_UPDATE_EDIT,{contactsData:a,hideOptIn:!0,skipAddress:!0,callback:function(){c.go(e.renegotiationService.stateCurrentName,e.renegotiationService.params),i.customPageView({pageName:"bv|area-logada|campanha|renegociacao|dados-atualizados"})}}).then(function(){e.$emit(g.SPINNING_STOP)})}function A(){var a=r.getUserCached()||{};return a.phone=a.phone||r.phone,a.email=a.email||r.email,a}function B(){J.statusForm.edit=!0,J.statusForm.submit=!1}function C(){J.modalConfig={open:!1,success:!1,successInput:!1,error:!1}}function D(){i.customPageView({pageName:"bv|area-logada|campanha|renegociacao|acompanhar-meu-pedido-lightbox"}),c.go(j.RENEGOTIATION_STATUS)}function E(){c.go(j.HOME)}function F(a){if(!a||!a.$valid)return void(J.statusForm.submit=!0);l.add(),angular.merge(J.contracts[0],{idEmail:J.view.solicitationForm.emailList.id,idPhone:J.view.solicitationForm.phoneList.id,nomeUsuario:r.user&&r.user.user});var c=n.formatRequestSave(J.contracts[0]);b.offer.idOfertaSimulacao?c.idOfertaSimulacao=b.offer.idOfertaSimulacao:b.offer&&b.offer.listaCalculos&&(c.idOfertaSimulacao=b.offer.listaCalculos[0].idOfertaSimulacao,c.idOfertaSimulacao=b.offer.listaCalculos[0].idOfertaSimulacao,J.contracts[0].dataVenciPagEntrada&&!J.isInputPage||delete c.dataPrimeiroVencimento),o.save(c).then(function(a){J.protocolNumber=a.data&&a.data.numeroProtocolo,document.BVDatalayer.reneg.protocolo=J.protocolNumber?"ok":"null";try{document.BVDatalayer.reneg.serverResponse=!0}catch(c){}C(),J.isInputPage?(J.messageSuccess="boleto de entrada",J.modalConfig.open=!0,J.modalConfig.successInput=!0):(G(),J.modalConfig.open=!0,J.modalConfig.success=!0);var b;J.isValuePage&&(b="BV|AL|campanha|renegociacao|segunda-fase|sucesso-renegociacao"),J.isDatePage&&(b="BV|AL|campanha|renegociacao|segunda-fase|sucesso-alterar-dia-pagamento-parcelas"),J.isExtendPage&&(b="BV|AL|campanha|renegociacao|segunda-fase|sucesso-prorrogar-pagamento"),J.isInputPage&&(b="BV|AL|campanha|renegociacao|segunda-fase|sucesso-valor-da-entrada"),document.BVDatalayer.internalCampaign=b,i.customPageView({pageName:b})}).catch(function(){try{document.BVDatalayer.reneg.serverResponse=!1}catch(b){}J.modalConfig.open=!0,J.modalConfig.error=!0;var a;a=J.isValuePage?"BV|AL|campanha|renegociacao|segunda-fase|erro-renegociacao-lightbox":J.isDatePage?"BV|AL|campanha|renegociacao|segunda-fase|erro-alterar-dia-pagamento-parcelas-lightbox":J.isExtendPage?"BV|AL|campanha|renegociacao|segunda-fase|erro-prorrogar-pagamento-lightbox":J.isInputPage?"BV|AL|campanha|renegociacao|segunda-fase|erro-valor-da-entrada-lightbox":"BV|AL|campanha|renegociacao|segunda-fase|erro-outro-lightbox",document.BVDatalayer.internalCampaign=a,i.customPageView({pageName:a})}).finally(function(){l.remove()})}function G(){switch(b.page){case"value":J.messageSuccess="Boa escolha!";break;case"extend":J.messageSuccess="Tudo certo! Você escolheu uma nova data para continuar pagando suas parcelas";break;case"date":J.messageSuccess="Tudo certo! Você escolheu um novo dia de pagamento das suas parcelas";break;case"input":default:J.messageSuccess="Boa escolha!"}}function H(){!angular.isDefined(e.refreshRenegCount)||isNaN(e.refreshRenegCount)?e.refreshRenegCount=0:e.refreshRenegCount=e.refreshRenegCount+1,e.refreshRenegCount<8&&(e.refreshRenegCancel=d(function(){e.$emit("refresh-renegotiation-session"),d(H,1e3)},1e5+Math.floor(4e4*Math.random())))}function I(){e.$emit(g.SPINNING_START);var a=J.contracts[0].listaParcelasEntrada,b={numeroContrato:parseInt(J.contracts[0].contrato||J.contracts[0].contractNumber),parcelas:a.map(function(a){return{numeroParcela:a.numeroParcela}}),dataVencimento:moment(J.dataVencimentoValorEntrada,"DD/MM/YYYY").format("YYYY-MM-DD"),codigoSituacaoFinanceira:14};return p.post(b).then(function(a){J.billetDataSimulated=q.format(a.data),c.go(j.BILLET_DIGITAL_BILLING,{installments:J.billetDataSimulated.installments,selectedDate:moment(J.dataVencimentoValorEntrada,"DD/MM/YYYY").toDate(),isInsuranceLender:!1,isAntecipate:!1,autoGenerateBillet:!0,isAcquittance:!1,isRenegotiation:!0,hideChangeDate:!0,page:J.billetDataSimulated.accordType})}).catch(function(){C(),c.go(j.BILLET_DIGITAL_BILLING,{autoGenerateBillet:!0})}).finally(function(){e.$emit(g.SPINNING_STOP)})}var J=this,K={};J.onKeydown=B,J.onSubmit=F,J.resetModal=C,J.gotoStatus=D,J.gotoChoose=E,J.generateInputBillet=I,J.getDataUpdateService=u,s(),d(function(){e.$emit("change-sidebar-css")},0),e.$on("$locationChangeStart",function(){e.$emit("reset-sidebar-css")})}a.$inject=["$filter","$stateParams","$state","$timeout","$rootScope","$window","commonEvents","dataUpdateService","dataLayerFactory","financingRoutes","userRoutes","abstractLoadingFactory","formPatterns","renegotiationFactory","renegotiationService","simulateBilletFinancingAccordService","simulateBilletFinancingAccordFactory","userInfoService"],angular.module("internetBanking.credit").controller("RenegotiationSuccessController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){function A(){B(),I()}function B(){da.contractValues=g.get("contractValues"),da.currentBillet=g.get("currentBillet"),da.total=g.get("total"),da.dueDate=new Date(g.get("dueDate")),da.contractData=g.get("contractData"),da.contractItemsArray=g.get("installmentsActive"),da.currentProductDetailsService=j,da.isFinancing=angular.equals(s.getCurrentProduct().data.productCode,12),da.stateRoutes=j.currentProductRoutes,C(),da.generatedBillet=!0,da.linkBillet="#",da.loadingLinkBillet=!1,Y(),da.editData=V,da.editEmailDataUpdate=M,da.goToDataUpdate=X,da.goToHome=W,da.resetModalConfig=Y,da.sendDataEmail=S,da.isAcquittance=g.get("isAcquittance")||!1,da.isAntecipate=g.get("isAntecipate")||!1,da.userRoutes=v,da.closeModal=r.closeModal,da.onOpenPDF=Z,da.closePopupPdf=aa,da.popUp=[],aa()}function C(){da.isCopied=!1,da.copyHelperText=!1,da.inputIdonError=null,da.onSuccess=E,da.onError=F,da.actionOnCopy=G,da.notIsCopiedAndNotCopyHelperText=H,da.broadcastBlurEvent=D,a.$on(i.COPY,function(){da.copyHelperText&&da.actionOnCopy(da.inputIdonError)})}function D(b){a.$broadcast(i.BLUR,b)}function E(a){da.broadcastBlurEvent(a),da.isCopied=!0,c.cancel(),c(function(){da.isCopied=!1},2e3);var b=s.getCurrentProduct().data.productCode,d=l.BVF.OPEN_BILLET_DELAY_COPY_CODE.FINANCING;angular.equals(b,q.personalCredit)?d=l.BVF.OPEN_BILLET_DELAY_COPY_CODE.CREDIT:angular.equals(b,q.payroll)&&(d=l.BVF.OPEN_BILLET_DELAY_COPY_CODE.PAYROLL),k.sendEvent({ID:d})}function F(a){da.copyHelperText=!0,da.inputIdonError=a}function G(b){da.copyHelperText=!1,da.isCopied=!0,c.cancel(),c(function(){da.broadcastBlurEvent(b),da.isCopied=!1,da.inputIdonError=null},2e3),a.$digest()}function H(){return!da.isCopied&&!da.copyHelperText}function I(){if(da.onGenerateBillet=J,da.onSendBilletViaEmail=N,w.dataUpdateCallback&&!a.emailSent&&"function"==typeof w.sendEmailBillet){var b=w.sendEmailBillet();b.id=w.dataUpdateCallback.id,delete b.email,a.emailSent=!0,O().then(function(){}).finally(function(){S(b).then(function(){da.resetModalConfig(),c(function(){da.isUpdated?da.modalConfig.bankslipSent={open:!0}:da.isAllUpdated?da.modalConfig.emailAndBankslipSent={open:!0}:da.modalConfig.emailAndBankslipSentNotUpdated={open:!0}},1e3)})})}}function J(){function a(a){da.generatedBillet=!1,da.barBillet=!0;var c=f.APIToViewModel(a.data);da.codeBar=c&&c.codeBar,da.processingDate=c&&c.dateProcess,da.date=n.format(da.processingDate,"@SITE-BILLET-GENERATED-DAY-FORMAT"),da.time=n.format(da.processingDate,"@SITE-BILLET-GENERATED-TIME-FORMAT"),$({type:"boletos",hash:c&&c.codeHash});var d=s.getCurrentProduct().data.productCode;angular.equals(d,q.personalCredit)?b(da.isAcquittance?l.BVF.GENERATE_BILLET_ACQUITTANCE.CREDIT:da.isAntecipate?l.BVF.GENERATE_BILLET_ANTECIPATE.CREDIT:l.BVF.GENERATE_BILLET_DELAY.CREDIT):angular.equals(d,q.payroll)?b(da.isAcquittance?l.BVF.GENERATE_BILLET_ACQUITTANCE.PAYROLL:da.isAntecipate?l.BVF.GENERATE_BILLET_ANTECIPATE.PAYROLL:l.BVF.GENERATE_BILLET_DELAY.PAYROLL):angular.equals(d,q.vehicleFinancing)?b(da.isAcquittance?l.BVF.GENERATE_BILLET_ACQUITTANCE.FINANCING:da.isAntecipate?l.BVF.GENERATE_BILLET_ANTECIPATE.FINANCING:l.BVF.GENERATE_BILLET_DELAY.FINANCING):angular.equals(d,q.leasing)&&b(da.isAcquittance?l.BVF.GENERATE_BILLET_ACQUITTANCE.LEASING:l.BVF.GENERATE_BILLET_ANTECIPATE.LEASING)}function b(a){k.sendEvent({ID:a})}function c(a){a&&a.data&&a.data.messages?da.modalConfig.billet={open:!0,message:a.data.messages[1]}:da.modalConfig.error.open=!0;var b=da.contractData.contractNumber,c=a&&a.data&&a.data.messages;e.error([b,"erro issueSingleBilletService.issue",c].join(" - "))}T();var d=K();da.modalConfig.billet.open=!1,da.currentBillet.installmentNumber.length>1&&(d=L()),p.issue(d).then(a).catch(c).finally(function(){U()})}function K(){return{codigoContrato:da.contractData.contractNumber,parcelas:[{numeroParcela:da.currentBillet.installmentNumber}],dataVencimento:n.format(da.dueDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function L(){return{codigoContrato:da.contractData.contractNumber,parcelas:da.currentBillet.installmentNumber.map(function(a){return{numeroParcela:a.installmentNumber}}),dataVencimento:n.format(da.dueDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function M(){function c(){var c=angular.copy(w);angular.merge(c,{installments:Q().installments,selectedDate:moment(Q().dueDate).toDate(),autoGenerateBillet:!0,sendEmailBillet:function(){return Q()}}),a.emailSent=!1,b.go(v.DATA_UPDATE_EDIT,{showField:"email",hideOptIn:!0,isUpdated:da.isUpdated||!1,callback:function(a){c.dataUpdateCallback=a&&a.enderecosEletronicos&&a.enderecosEletronicos[0],b.go(x.ACQUITTANCE_VALUE,angular.copy(c))}}).then(function(){a.$emit(i.SPINNING_STOP)})}a.$emit(i.SPINNING_START),w.sendEmailBillet=null,w.dataUpdateCallback=null,c()}function N(){a.$emit(i.SPINNING_START),a.emailSent=!1,P();var b=s.getCurrentProduct().data.productCode,c=l.BVF.OPEN_BILLET_EMAIL_DELAY.FINANCING;angular.equals(b,q.personalCredit)?c=l.BVF.OPEN_BILLET_EMAIL_DELAY.CREDIT:angular.equals(b,q.payroll)&&(c=l.BVF.OPEN_BILLET_EMAIL_DELAY.PAYROLL),k.sendEvent({ID:c})}function O(){return P(!0)}function P(b){return a.$emit(i.SPINNING_START),da.isUpdated=!1,da.isAllUpdated=!0,m.get().then(function(c){function d(a){da.isUpdated=a&&a.enderecosEletronicosAtualizados}function e(a){da.isAllUpdated=a&&a.enderecosAtualizados&&a.enderecosEletronicosAtualizados&&a.telefonesAtualizados}function f(a,c){b||("object"==typeof c?da.modalConfig[a]={open:!0}:(da.modalConfig.open=!0,da.modalConfig[a]=!0),da.isLoaded=!0)}function g(a,b){var c=[];return a.reduce(function(a,d){return a.indexOf(d.infoMask)<0&&(a.push(d.infoMask),c.push({infoMask:d.infoMask,tipo:b,dataAtualizacao:d.dataAtualizacao,id:d.id})),a},[]),c}if(da.phoneList=g(c.data.telefones,"CELULAR"),da.emailList=c.data.enderecosEletronicos,b?e(c.data):d(c.data),!a.emailSent)if(0===da.phoneList.length&&0===da.emailList.length)f("emptyData",{});else{if(da.isUpdated)return da.isLoaded=!0,void f("emailConfirmation",{});f("contactsFound",{})}}).finally(function(){a.$emit(i.SPINNING_STOP)})}function Q(){return{contractNumber:da.contractData.contractNumber,sequenceContract:null,installments:[{numeroParcela:da.currentBillet.installmentNumber}],installmentValue:g.get("total"),id:da.emailList&&da.emailList[0]&&da.emailList[0].id,dueDate:n.format(g.get("formattedOverDueDate"),"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function R(){return{contractNumber:da.contractData.contractNumber,sequenceContract:null,installments:da.currentBillet.installmentNumber.map(function(a){return{numeroParcela:a.installmentNumber}}),installmentValue:g.get("total"),id:da.emailList&&da.emailList[0]&&da.emailList[0].id,dueDate:n.format(g.get("formattedOverDueDate"),"@SITE-COMMON-API-REQUEST-DATE-FORMAT")}}function S(b){function c(){da.resetModalConfig(),a.emailSent||O().then(function(){da.modalConfig.bankslipSent={open:!0}}),a.$emit(i.SPINNING_STOP)}function d(b){da.resetModalConfig(),da.modalConfig.notEmail.open=!0,da.modalConfig.notEmail.message=b&&b.data&&b.data.messages[1],a.$emit(i.SPINNING_STOP)}var e=b||Q();return da.currentBillet.installmentNumber.length>1&&(e=b||R()),a.$emit(i.SPINNING_START),t.send(e).then(c).catch(d)}function T(){a.$emit(i.SPINNING_START)}function U(){a.$emit(i.SPINNING_STOP)}function V(a){b.go(v.DATA_UPDATE_EDIT,{showField:a})}function W(){Y(),b.go(y.HOME)}function X(){b.go(v.DATA_UPDATE_EDIT)}function Y(){da.modalConfig={email:{open:!1,value:""},emailNotRegister:{open:!1},notEmail:{open:!1,message:""},error:{open:!1},billet:{open:!1},popup:{open:!1},contactsFound:{open:!1},emailConfirmation:{open:!1},bankslipSent:{open:!1},emailAndBankslipSent:{open:!1},emailAndBankslipSentNotUpdated:{open:!1},emptyData:{open:!1}}}function Z(){function a(a){if(h.IS_IE){var b=new Blob([a.data]);d.saveAs(b,"boleto-bv-"+e.hash+".pdf")}else{var c=URL.createObjectURL(a.data),i=0;ca.location=c,da.popUp.push({tela:ca}),da.popUp[da.popUp.length-1].tela&&angular.forEach(da.popUp,function(a){a.tela&&(i+=a.tela.closed?0:1)}),i||(da.modalConfig.open=!0,da.modalConfig.popup.open=!0)}angular.equals(f,q.personalCredit)?g=l.BVF.OPEN_BILLET.CREDIT:angular.equals(f,q.payroll)&&(g=l.BVF.OPEN_BILLET.PAYROLL),k.sendEvent({ID:g})}function b(){da.modalConfig.open=!0,da.modalConfig.error.open=!0}ca=z.nonBlockPopup("Aguarde, seu boleto está sendo gerado..."),da.loadingLinkBillet=!0;var e,f,g;c(function(){e=_()||{},f=s.getCurrentProduct().data.productCode,g=l.BVF.OPEN_BILLET.FINANCING,o.getPDF(e.type,e.hash).then(a).catch(b).finally(function(){da.loadingLinkBillet=!1})},500)}function $(a){ba=a}function _(){return ba}function aa(){da.modalConfig.popup.open=!1}var ba,ca,da=this;A()}a.$inject=["$rootScope","$state","$timeout","FileSaver","bvLogService","billetAcquittanceDataFactory","billetAcquittanceValueCurrentService","commonConstants","commonEvents","currentProductDetailsService","dataLayerFactory","dataLayerSendEventCode","dataUpdateService","formatDateFactory","getPDFCreditService","issueSingleBilletService","mainProductCodes","modalHelpersService","productDetailService","sendBilletEmailService","userInfoService","userRoutes","$stateParams","bvfRoutes","commonRoutes","windowOpenFactory"],angular.module("internetBanking.credit").controller("BilletAcquittanceValueController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J){function K(){ka.viewContentLoading();var b=["installment","total","fine","arrears","notification"];d.installment&&(ka.contractItemsArray=[],b.forEach(function(a,c){ka.contractItemsArray[c]={contractItem:b[c],contractItemDetails:ka.installmentValues[b[c]]}}),ka.isLateReceipt=moment(d.installment.dueDate).diff(d.installment.paymentDate,"days")<0),u.setInstallmentStatus(ka.installmentsList,w),-1!==[14].indexOf(C.paymentSituationCode)&&O(),ka.installmentsAmountPerType=u.installmentsAmountPerType(ka.installmentsList,w),ka.selectedInstallmentsQuantity=ka.installmentsList.length,d.installmentType||X(),angular.equals(c.current.name,ka.financingRoutes.STATEMENT)&&(ka.isReverseOrder=!1),ka.isEndorsed&&t.setInstallmentsPaysetInstallmentsEndorsed(ka.installmentsList),ka.chargeType={CARNE:ka.contractData&&ka.contractData.chargeType&&1===ka.contractData.chargeType.code,CHEQUE:ka.contractData&&ka.contractData.chargeType&&2===ka.contractData.chargeType.code,DESCONTO_EM_FOLHA:ka.contractData&&ka.contractData.chargeType&&6===ka.contractData.chargeType.code,DEBITO_EM_CONTA:ka.contractData&&ka.contractData.chargeType&&7===ka.contractData.chargeType.code},a.$emit("scroll-top")}function L(a){return ka.isEndorsed?!!a.isEndorsed:!ka.isAssessory&&(!!a.isOpen||!!a.isOverdue)}function M(b){T(),ka.modalConfig.open=!0,ka.modalConfig[b]=!0,a.isModal=!0}function N(b,d){function e(a){if("link_negociar"===(a=a&&a.toLowerCase()))return"NEGOCIAR"}var f,g;if(f=e(d)){g=o.BVF.BILLET_BILLING_OPEN_BUTTON[f];var h="financiamento";B.getCurrentProduct().data.productCode===x.personalCredit?h="credito pessoal":B.getCurrentProduct().data.productCode===x.payroll&&(h="consignado"),n.sendEvent({ID:g,parameters:h})}a.$emit(j.SPINNING_START);var k=c.go(i.BILLET_DIGITAL_BILLING);k&&k.then(function(){a.$emit(j.SPINNING_STOP)}).catch(function(){a.$emit(j.SPINNING_STOP)})}function O(){var a={numeroContrato:C.contractNumber,parcelas:ka.installmentsList.map(function(a){return{numeroParcela:a.installmentNumber}}),dataVencimento:r.format(ka.selectedDate,"@SITE-COMMON-API-REQUEST-DATE-FORMAT"),codigoSituacaoFinanceira:C.paymentSituationCode};return F.post(a).then(function(a){ka.billetDataSimulated=E.format(a.data),ka.installmentsList.forEach(function(a){var b=_.find(ka.billetDataSimulated.installments,{installmentNumber:a.installmentNumber});b&&b.installmentValue&&(a.totalValue=b.principalValue,a.recalculedValue=!0)})})}function P(){ka.modalConfig.open=!0,ka.modalConfig.antecipate=!0}function Q(){var a=o.BVF.BILLET_BILLING_OPEN_BUTTON.ANTECIPATE;n.sendEvent({ID:a,parameters:"financiamento"}),T()}function R(b,c){function d(a){m.assessoryData=h.APIToViewModel(a.data),m.assessoryData.contractNumber=C.contractNumber,ka.assessoryData=m.assessoryData,S(c),b?ka.showAdditional=!0:ka.modalConfig.isAssessory.open=!0}function e(){ka.assessoryData=null,ka.showAdditional=!1,b||(ka.modalConfig.open=!0,ka.modalConfig.notAssessory=!0)}z.get(C.contractNumber).then(d).catch(e).finally(function(){a.isModal=!0})}function S(a){var b="financiamento",c="FINANCING";if(B.getCurrentProduct().data.productCode===x.personalCredit?(b="credito pessoal",c="CREDIT"):B.getCurrentProduct().data.productCode===x.payroll&&(b="consignado",c="PAYROLL"),a){var d=a.origin&&a.origin.toUpperCase()||"MENUITEM",e=o.BVF.BILLET_BILLING_ASSESSORY[d];n.sendEvent({ID:e,parameters:b})}else n.sendEvent({ID:o.BVF.ASSESSORY[c],parameters:b})}function T(){ka.modalConfig={isAssessory:{open:!1,modifierClass:"-is-assessory"},antecipate:!1,open:!1,error:!1,demonstrativePDF:!1,declarationPDF:!1,secondWayPDF:!1,billet:!1,notAssessory:!1},a.isModal=!1}function U(){function b(){this.isActive=!this.isActive,a.isModal=!a.isModal}return{isActive:!1,toggle:b}}function V(){switch(!0){case angular.equals(c.current.name,i.INSTALLMENTS):$(1);break;case angular.equals(c.current.name,i.STATEMENT):$(2)}a.$broadcast(j.ANIMATE_INSTALLMENT_TABLE)}function W(){var b=0;ka.installmentsList.map(function(a){a.situation.code>2&&(b=a.numberDaysDelay>b?a.numberDaysDelay:b)}),ka.installmentInAssessory.daysOverdued=b,ka.modalConfig.isAssessory.open=!0,a.isModal=!0}function X(){angular.equals(d.installmentType,"all")?(ka.filterActive=w.ALL,ka.selectedInstallmentsQuantity=ka.installmentsList.length):angular.equals(d.installmentType,"paid")&&(ka.filterActive=w.PAID,ka.selectedInstallmentsQuantity=ka.installmentsAmountPerType.paid)}function Y(){ka.installmentsQuantity=ka.installmentsQuantity+7}function Z(a){return angular.equals(a,ka.tabActive)}function $(a){ka.installmentsQuantity=7,ka.isStatement=angular.equals(a,2),ka.tabActive=a,angular.equals(a,1)?c.go(i.INSTALLMENTS):c.go(i.STATEMENT)}function aa(a){return angular.equals(a,ka.filterActive)}function ba(){return ka.filterActive?angular.equals(ka.filterActive.code,4)?ka.installmentsList.filter(function(a){return angular.equals(a.situation.code,4)||angular.equals(a.situation.code,3)}):ka.installmentsList.filter(function(a){return angular.equals(a.situation.code,1)||angular.equals(a.situation.code,2)}):ka.installmentsList}function ca(b){switch(angular.equals(ka.filterActive,b)||a.$broadcast(j.ANIMATE_INSTALLMENT_TABLE),ka.filterActive=b,!0){case angular.equals(b,w.PAID):ka.isReverseOrder=!1,ka.selectedInstallmentsQuantity=ka.installmentsAmountPerType.paid;break;case angular.equals(b,w.OPEN):ka.isReverseOrder=!0,ka.selectedInstallmentsQuantity=ka.installmentsAmountPerType.open+ka.installmentsAmountPerType.overdue;break;case angular.equals(b,w.ALL):ka.isReverseOrder=!0,ka.selectedInstallmentsQuantity=ka.installmentsList.length}}function da(){return ka.installmentsQuantity<=ka.installmentsList.length}function ea(){ja(),1===m.currentProductDetails.contractStatus.code&&"/extrato"===c.current.url&&angular.element(document).triggerHandler("BVSendEvent",{ID:"0.03.2",parameters:!0}),1===m.currentProductDetails.contractStatus.code&&"/comprovante"===c.current.url&&angular.element(document).triggerHandler("BVSendEvent",{ID:"0.04.5",parameters:!0})}function fa(){var a=B.getCurrentProduct().data.contractNumber;s.get(a,0).then(function(a){ka.viewPdf=a.pdf}).catch(function(b){var c=b&&b.data&&b.data.messages;g.error([a,"erro getBilletFinancingService.get",c].join(" - "))})}function ga(){1===m.currentProductDetails.contractStatus.code&&"/extrato"===c.current.url&&angular.element(document).triggerHandler("BVSendEvent",{ID:"0.03.1",parameters:!0}),1===m.currentProductDetails.contractStatus.code&&"/comprovante"===c.current.url&&angular.element(document).triggerHandler("BVSendEvent",{ID:"0.04.4",parameters:!0})}function ha(){var a=o.BVF.PRINT_EXTRACT.FINANCING;if(!document.documentMode){var b=URL.createObjectURL(ka.productStatement.data);e.open(b,"_blank")}else{var c=new f([ka.productStatement.data]);q.saveAs(c,"Extrato-"+ka.productStatement.contractNumber+".pdf")}var d="financiamento";B.getCurrentProduct().data.productCode===x.personalCredit?(a=o.BVF.PRINT_EXTRACT.CREDIT,d="credito pessoal"):B.getCurrentProduct().data.productCode===x.payroll&&(a=o.BVF.PRINT_EXTRACT.PAYROLL,d="consignado"),n.sendEvent({ID:a,parameters:d})}function ia(){c.go(ka.financingRoutes.ANTICIPATE_INSTALLMENTS_LIST)}function ja(){a.$emit(j.SPINNING_START)}var ka=this;ka.loadingLink=!0,ka.link="#",ka.hiddenLink=!1,ka.loadingLinkBillet=!0,ka.productName=B.getCurrentProduct().data.title,ka.productCategory=B.getCurrentProduct().data.category,ka.installment=d.installment,ka.dateDifferenceInDays=p.dateDifferenceInDays,ka.installmentsList=m.contractData.listInstallments,ka.installmentValues=v.formatInstallmentReceipt(ka.installmentsList),ka.currentInstallment=m.getCurrentInstallment(ka.installmentsList),ka.contractData=B.getCurrentProduct().productDetail,ka.checkSecundVia=L,ka.antecipateInstallments=ia,A.get(B.getCurrentProduct().data.contractNumber).then(function(a){ka.loadingLink=!1,ka.link=a.config&&a.config.url||"",ka.productStatement={link:ka.link,data:a.data,contractNumber:B.getCurrentProduct().data.contractNumber}}).catch(function(){ka.loadingLink=!1,ka.hiddenLink=!0}),ka.productDetails=B.getCurrentProduct().productDetail,ka.productDetails.initDate=B.getCurrentProduct().data.initDate,ka.productDetails.endDate=B.getCurrentProduct().data.endDate,ka.productDetails.contractStatus={},ka.productDetails.contractStatus.description=B.getCurrentProduct().data.contractStatus&&B.getCurrentProduct().data.contractStatus.description||"",ka.seePDF=ha,ka.installmentsStatus=w,ka.isOverdueByOneDay=u.isOverdueByOneDay,ka.isOverdueBySeveralDays=u.isOverdueBySeveralDays,ka.stateRoutes=G,ka.loadMoreInstallments=Y,ka.openModal=y.openModal,ka.settled=!C.paymentSituationCode,ka.isTabActive=Z,ka.setTabActive=$,ka.installmentHistoryFooterCheck=da,ka.viewContentLoading=V,ka.isFilterActive=aa,ka.setFilterActive=ca,ka.openAssessory=W,ka.onOpenAssessory=R,ka.onNotDocumentPDF=M,ka.onOpenBilletBilling=N,ka.onCloseAntecipateModal=Q,ka.generateBillet=l.generateBillet,ka.contractNumber=B.getCurrentProduct().data.contractNumber,ka.financingRoutes=m.currentProductRoutes,ka.isStatement=!1,ka.isEndorsed=B.getCurrentProduct().productDetail.endorsed,ka.assessoryData=m.assessoryData,ka.tabActive=2,ka.isReverseOrder=!0,ka.installmentsQuantity=7,ka.selectedInstallmentsQuantity=7,ka.filterActive=a.setActiveTabHistoryPage?w.OPEN:w.ALL,ka.installmentsAmountPerType={},ka.mobileFilterPopup=U(),ka.filterInstallments=ba,ka.sendBilletViaEmail=ea,ka.showAntecipateModal=P,ka.openPDFDataLayerEvent=ga,ka.getReceiptPDF=fa,ka.isAssessory=angular.equals(B.getCurrentProduct().data.paymentSituationCode,3),ka.isFriendlyDelay=angular.equals(B.getCurrentProduct().data.paymentSituationCode,2);var la=D.mapsPaymentSituation(C.paymentSituationCode,{productCode:B.getCurrentProduct().data.productCode});angular.merge(ka,la),ka.hasContractMoreThan2Year=moment().diff(C.endDate,"days")>732,ka.isJustHired=angular.equals(k.firstDueDate.value,k.nextDueDate.value),ka.isLeasing=angular.equals(B.getCurrentProduct().data.productCode,14),ka.modalConfig={isAssessory:{open:!1,modifierClass:"-is-assessory"},email:{open:!1,value:""}},ka.installmentInAssessory={daysOverdued:null},K()}a.$inject=["$rootScope","$scope","$state","$stateParams","$window","Blob","bvLogService","advisoryDataFactory","bvfRoute","commonEvents","contractData","currentBilletDataService","currentProductDetailsService","dataLayerFactory","dataLayerSendEventCode","dateDifferenceFactory","FileSaver","formatDateFactory","getBilletFinancingService","homeInstallmentsFactory","installmentsHistoryFactory","installmentsParamFactory","installmentsStatus","mainProductCodes","modalHelpersService","obtainAdvisoryDataService","obtainProductStatementService","productDetailService","productDetails","rulesAccessFactory","simulateBilletFinancingAccordFactory","simulateBilletFinancingAccordService","tabHistory","biocatchFactory","biocatchService","renegotiationService"],angular.module("internetBanking.credit").controller("InstallmentsHistoryController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){t.dataView={email:null,confirmEmail:null,acceptTerms:!1,savedEmail:f.getCacheEmail()||null},t.modalConfig={open:!1,error:!1,secondWay:!1}}function o(){f.setCacheEmail(t.dataView.email),f.registryEmail(t.dataView.email).then(function(){m.go(a.AUTHORIZE_DIGITAL_BILL_SUCCESS)}).catch(function(){})}function p(){m.go(a.AUTHORIZE_DIGITAL_BILL)}function q(){d.sendEvent({ID:e.BVF.SECOND_WAY.DIGITAL_BILLET_ACCESS});var a=j.nonBlockPopup("Aguarde, seu carnê está sendo gerado..."),c=h.getCached();c?h.generatePdfSuccess(c,a).then(s):(t.modalConfig.open=!0,l.isModal=!0,r().then(function(c){function d(a){var c=[v,"pdfSecondWayFactory.generatePdf",a&&a.data&&a.data.messages];b.error(c.join(" - ")),t.modalConfig.open=!0,t.modalConfig.error=!0}if(209===c.statusCode||210===c.statusCode)return t.modalConfig.open=!1,l.isModal=!1,!1;h.generatePdf(c).then(function(b){u=h.generatePdfSuccess(b,a)}).catch(d).finally(function(){u.then(s)})}).catch(function(){t.modalConfig.open=!0,t.modalConfig.error=!0}))}function r(){function a(a){var b={type:"carnes",hash:a.data.codigoHash,statusCode:a.status};209!==a.status&&210!==a.status||(b.message=a.data.messages[1]),d.resolve(b)}function c(a){var e=e,f=c&&c.data&&c.data.messages;b.error([e,"erro obtainDataBilletService.post",f].join(" - ")),d.reject(a)}var d=k.defer();return g.post({codigoContrato:v,parcelas:[{numeroParcela:0}]}).then(a).catch(c),d.promise}function s(a){a.hasPopupBlocked&&(l.isModal=!0,t.modalConfig.open=!0,d.sendEvent({ID:"02.02.00.34.03"}))}var t=this,u=!1,v=i.getCurrentProduct().productDetail.contractNumber;i.getCurrentProduct().productDetail.isDigitalBill;t.onAuthorizeDigitalBill=o,t.onEditEmail=p,t.printBill=q,n()}a.$inject=["bvfRoute","bvLogService","commonEvents","dataLayerFactory","dataLayerSendEventCode","digitalBillService","obtainDataBilletService","pdfSecondWayFactory","productDetailService","windowOpenFactory","$q","$rootScope","$state"],angular.module("internetBanking.credit").controller("DigitalBillController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){a.get().then(function(a){var b=a.data;b.forEach(function(a,b,c){if(""==a.nome)return delete a[b];var d="001"==a.codigoBacen||"341"==a.codigoBacen||"033"==a.codigoBacen||"237"==a.codigoBacen||"745"==a.codigoBacen||"104"==a.codigoBacen;a.main=d?"":"Outros bancos"}),m.bankList=b})}function j(){c.go(b.BILLET_DIGITAL_BILLING,{installments:e.listInstallments,selectedDate:d.selectedDate,autoGenerateBillet:!1,isAcquittance:!0,page:h.translateAccordType("Q")})}function k(){function a(){c.go(b.BILLET_DIGITAL_BILLING,{installments:e.listInstallments,selectedDate:d.selectedDate,autoGenerateBillet:!0,isAcquittance:!0,isInsuranceLender:!0,page:h.translateAccordType("Q")})}document&&document.BVDatalayer&&(document.BVDatalayer.quitacao={status:"seguro-prestamista"});var i={numeroContrato:f.getCurrentProduct().productDetail.contractNumber,numeroBanco:m.refund.bank.codigoBacen,tipoConta:"CHECKING"==m.refund.account.type?"1":"2",numeroAgencia:(m.refund.agency.number+"-"+m.refund.agency.digit).replace(/-$/,""),numeroConta:(m.refund.account.number+"-"+m.refund.account.digit).replace(/-$/,"")};g.setDataBank(i),a()}function l(){}var m=this;m.growupUnitTests=l,m.refund={agency:{number:"",digit:""},account:{number:"",digit:"",type:"CHECKING"},bank:""},m.saveDataBank=k,m.historyBack=j,i()}a.$inject=["bankService","bvfRoute","$state","$stateParams","contractData","productDetailService","insuranceRefundService","simulateBilletFinancingAccordFactory"],angular.module("internetBanking.credit").controller("InsuranceRefundController",a)}();